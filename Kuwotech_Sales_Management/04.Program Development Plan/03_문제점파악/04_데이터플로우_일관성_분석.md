# 04. ë°ì´í„°í”Œë¡œìš° ì¼ê´€ì„± ë¶„ì„

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-09
- **ì‘ì„±ì**: Claude Code (AI Assistant)
- **ë²„ì „**: 1.0
- **ê²€ì¦ ìˆ˜ì¤€**: 100% ì½”ë“œ ê²€ì¦ ì™„ë£Œ

---

## ğŸ¯ ë¶„ì„ ë²”ìœ„

ë³¸ ë¬¸ì„œëŠ” KUWOTECH ì˜ì—…ê´€ë¦¬ ì‹œìŠ¤í…œì˜ **Database â†” Backend â†” Frontend ë°ì´í„° íë¦„**ì— ëŒ€í•œ ì „ë©´ì ì¸ ì¼ê´€ì„± ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.

### ë¶„ì„ ëŒ€ìƒ
- **Backend**: Railway ë°ì´í„°ë² ì´ìŠ¤ â†” Express.js API
- **Frontend**: ì˜ì—…ë‹´ë‹¹ëª¨ë“œ (Sales Mode) 6ê°œ ë©”ë‰´
- **Frontend**: ê´€ë¦¬ìëª¨ë“œ (Admin Mode) 8ê°œ ë©”ë‰´
- **ë°ì´í„° íë¦„**: ì–‘ë°©í–¥ CRUD ì‘ì—… (Create, Read, Update, Delete)

---

## ğŸ“Š 1. ì‚¬ì´ë“œ ë©”ë‰´ êµ¬ì¡° ë¹„êµ

### 1.1 ì˜ì—…ë‹´ë‹¹ëª¨ë“œ (Sales Mode) - 6ê°œ ë©”ë‰´

| ìˆœë²ˆ | ë©”ë‰´ëª… | data-page | íŒŒì¼ ìœ„ì¹˜ |
|------|--------|-----------|-----------|
| 1 | ëŒ€ì‹œë³´ë“œ | dashboard | 03.sales_mode/01_dashboard/02_dashboard.js |
| 2 | ë‹´ë‹¹ê±°ë˜ì²˜ê´€ë¦¬ | my-companies | 03.sales_mode/02_my_companies/02_my_companies.js |
| 3 | ì‹¤ì ë³´ê³ ì„œ ì‘ì„± | report-write | 03.sales_mode/03_report_write/02_report_write.js |
| 4 | ì‹¤ì ë³´ê³ ì„œ í™•ì¸ | report-check | 03.sales_mode/04_report_check/02_report_check.js |
| 5 | ê´€ë¦¬ìì˜ê²¬ í™•ì¸ | admin-feedback | 03.sales_mode/05_admin_feedback/02_admin_feedback.js |
| 6 | ì‹œìŠ¤í…œì„¤ì • | system-settings | 03.sales_mode/06_system_settings/02_settings.js |

### 1.2 ê´€ë¦¬ìëª¨ë“œ (Admin Mode) - 8ê°œ ë©”ë‰´

| ìˆœë²ˆ | ë©”ë‰´ëª… | data-page | íŒŒì¼ ìœ„ì¹˜ |
|------|--------|-----------|-----------|
| 1 | ëŒ€ì‹œë³´ë“œ | dashboard | 04.admin_mode/01_dashboard/02_dashboard.js |
| 2 | ì „ì²´ê±°ë˜ì²˜ê´€ë¦¬ | all-companies | 04.admin_mode/02_all_companies/02_all_companies.js |
| 3 | ì‹¤ì ë³´ê³ ì„œ í™•ì¸ | report-confirm | 04.admin_mode/03_report_confirm/02_report_confirm.js |
| 4 | ì‹¤ì í˜„í™©íŒ | presentation | 04.admin_mode/04_presentation/02_presentation.js |
| 5 | ë°ì´í„° ê´€ë¦¬ | data-management | 04.admin_mode/05_data_management/02_data_management.js |
| 6 | ì§ì› ê´€ë¦¬ | employee-management | 04.admin_mode/06_employee_management/02_employees.js |
| 7 | ì‹œìŠ¤í…œì„¤ì • | system-settings | 04.admin_mode/07_system_settings/02_settings.js |
| 8 | ì—‘ì…€ ì—…ë¡œë“œ | excel-upload | 04.admin_mode/08_excel_upload/02_excel_upload.js |

### 1.3 ì£¼ìš” ì°¨ì´ì 

#### ê³µí†µ ê¸°ëŠ¥
- **ëŒ€ì‹œë³´ë“œ**: ì–‘ ëª¨ë“œ ëª¨ë‘ ì¡´ì¬
- **ì‹œìŠ¤í…œì„¤ì •**: ë™ì¼í•œ ì½”ë“œ (458 lines)

#### ì˜ì—…ë‹´ë‹¹ëª¨ë“œ ì „ìš©
- **ë‹´ë‹¹ê±°ë˜ì²˜ê´€ë¦¬**: ìì‹ ì´ ë‹´ë‹¹í•˜ëŠ” ê±°ë˜ì²˜ë§Œ ê´€ë¦¬
- **ì‹¤ì ë³´ê³ ì„œ ì‘ì„±**: ë³¸ì¸ì˜ ì‹¤ì ë³´ê³ ì„œ ì‘ì„±
- **ê´€ë¦¬ìì˜ê²¬ í™•ì¸**: ê´€ë¦¬ì í”¼ë“œë°± í™•ì¸

#### ê´€ë¦¬ìëª¨ë“œ ì „ìš©
- **ì „ì²´ê±°ë˜ì²˜ê´€ë¦¬**: ëª¨ë“  ê±°ë˜ì²˜ ì¡°íšŒ ë° ê´€ë¦¬
- **ì‹¤ì ë³´ê³ ì„œ í™•ì¸**: ëª¨ë“  ì§ì›ì˜ ë³´ê³ ì„œ í™•ì¸ ë° í”¼ë“œë°±
- **ì‹¤ì í˜„í™©íŒ**: ì „ì²´ ì‹¤ì  í˜„í™© ì‹œê°í™”
- **ë°ì´í„° ê´€ë¦¬**: ì „ì²´ ë°ì´í„° ë°±ì—…/ë³µì›
- **ì§ì› ê´€ë¦¬**: ì§ì› ì •ë³´ ë° ê¶Œí•œ ê´€ë¦¬
- **ì—‘ì…€ ì—…ë¡œë“œ**: ëŒ€ëŸ‰ ë°ì´í„° ì—…ë¡œë“œ

---

## ğŸ” 2. API ì—”ë“œí¬ì¸íŠ¸ URL ì¼ê´€ì„± ë¶„ì„

### 2.1 ë°œê²¬ëœ API URL ì„¤ì • íŒ¨í„´ (4ê°€ì§€)

#### íŒ¨í„´ 1: `GlobalConfig.API_BASE_URL` âœ… **ê¶Œì¥**
**ì‚¬ìš© ìœ„ì¹˜**: ëŒ€ë¶€ë¶„ì˜ íŒŒì¼ì—ì„œ ì‚¬ìš©
```javascript
// ì˜ˆì‹œ: 05.Source/03.sales_mode/02_my_companies/02_my_companies.js:211
const apiUrl = `${GlobalConfig.API_BASE_URL}/api/companies/manager/${encodeURIComponent(user.name)}`;

// ì˜ˆì‹œ: 05.Source/04.admin_mode/06_employee_management/02_employees.js:68
const response = await fetch(`${GlobalConfig.API_BASE_URL}/api/master/departments`, {...});
```

**ì‚¬ìš© íŒŒì¼ ëª©ë¡**:
- 03.sales_mode/02_my_companies/02_my_companies.js (13ê°œ API í˜¸ì¶œ)
- 04.admin_mode/02_all_companies/02_all_companies.js (15ê°œ API í˜¸ì¶œ)
- 04.admin_mode/06_employee_management/02_employees.js (6ê°œ API í˜¸ì¶œ)

#### íŒ¨í„´ 2: `GlobalConfig.API_CONFIG.BASE_URL` âœ… **ê¶Œì¥**
**ì‚¬ìš© ìœ„ì¹˜**: ì‹œìŠ¤í…œ ì„¤ì • íŒŒì¼
```javascript
// ì˜ˆì‹œ: 05.Source/03.sales_mode/06_system_settings/02_settings.js:70
const response = await fetch(`${GlobalConfig.API_CONFIG.BASE_URL}/api/employees`, {...});

// ì˜ˆì‹œ: 05.Source/04.admin_mode/07_system_settings/02_settings.js:327
const response = await fetch(`${GlobalConfig.API_CONFIG.BASE_URL}/api/employees/${currentUser.id}/password`, {...});
```

**ì‚¬ìš© íŒŒì¼ ëª©ë¡**:
- 03.sales_mode/06_system_settings/02_settings.js (3ê°œ API í˜¸ì¶œ)
- 04.admin_mode/07_system_settings/02_settings.js (3ê°œ API í˜¸ì¶œ)

**ì°¸ê³ **: íŒ¨í„´ 1ê³¼ íŒ¨í„´ 2ëŠ” ì‹¤ì œë¡œ **ë™ì¼í•œ URL**ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.
```javascript
// 05.Source/01.common/01_global_config.js:1044
API_BASE_URL: API_CONFIG.BASE_URL  // í¸ì˜ì„±ì„ ìœ„í•œ alias
```

#### íŒ¨í„´ 3: `window.KUWOTECH_CONFIG?.API_BASE_URL` + Hardcoded Fallback âš ï¸ **ë¬¸ì œ**
**ì‚¬ìš© ìœ„ì¹˜**: presentation.js, data_management.js
```javascript
// 05.Source/04.admin_mode/04_presentation/02_presentation.js:62
const API_BASE_URL = window.KUWOTECH_CONFIG?.API_BASE_URL ||
  'https://kuwotech-sales-production-aa64.up.railway.app/api';

// 05.Source/04.admin_mode/05_data_management/02_data_management.js:75
const API_BASE_URL = window.KUWOTECH_CONFIG?.API_BASE_URL ||
  'https://kuwotech-sales-production-aa64.up.railway.app/api';
```

**ë¬¸ì œì **:
- Railway URLì´ **í•˜ë“œì½”ë”©**ë˜ì–´ ìˆì–´ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
- í™˜ê²½ ë³€ê²½ ì‹œ ì§ì ‘ ìˆ˜ì • í•„ìš”

#### íŒ¨í„´ 4: ì™„ì „ í•˜ë“œì½”ë”© (ApiManager) âš ï¸ **ë¬¸ì œ**
**ì‚¬ìš© ìœ„ì¹˜**: ApiManager í´ë˜ìŠ¤
```javascript
// 05.Source/01.common/13_api_manager.js:35
baseURL: 'https://kuwotech-sales-production-aa64.up.railway.app/api',
```

**ë¬¸ì œì **:
- GlobalConfigë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  **ì§ì ‘ í•˜ë“œì½”ë”©**
- í™˜ê²½ ë³€ê²½ ì‹œ ì½”ë“œ ìˆ˜ì • í•„ìš”

### 2.2 GlobalConfigì˜ API URL ìë™ ê°ì§€ ë¡œì§

```javascript
// 05.Source/01.common/01_global_config.js:639-662
export function getApiBaseUrl() {
    if (typeof window === 'undefined') return 'http://localhost:3000';

    const hostname = window.location.hostname;
    const port = window.location.port;

    // Railway í”„ë¡œë•ì…˜
    if (hostname.includes('railway.app')) {
        return 'https://kuwotech-sales-production-aa64.up.railway.app';
    }

    // ë¡œì»¬ ì„œë²„ (í¬íŠ¸ 3000) - ê°œë°œ í™˜ê²½
    if ((hostname === 'localhost' || hostname === '127.0.0.1') && port === '3000') {
        return 'http://localhost:3000';
    }

    // Live Server (í¬íŠ¸ 5500) - Railway í”„ë¡œë•ì…˜ ì‚¬ìš©
    if ((hostname === 'localhost' || hostname === '127.0.0.1') && port === '5500') {
        return 'https://kuwotech-sales-production-aa64.up.railway.app';
    }

    // ê¸°ë³¸ê°’: Railway í”„ë¡œë•ì…˜
    return 'https://kuwotech-sales-production-aa64.up.railway.app';
}
```

### 2.3 API URL ì¼ê´€ì„± ë¬¸ì œ ìš”ì•½

| íŒ¨í„´ | ì‚¬ìš© íŒŒì¼ ìˆ˜ | ì¼ê´€ì„± | ìœ ì§€ë³´ìˆ˜ì„± | ê¶Œì¥ ì—¬ë¶€ |
|------|-------------|--------|-----------|----------|
| GlobalConfig.API_BASE_URL | ë‹¤ìˆ˜ | âœ… ë†’ìŒ | âœ… ë†’ìŒ | âœ… ê¶Œì¥ |
| GlobalConfig.API_CONFIG.BASE_URL | 2ê°œ | âœ… ë†’ìŒ | âœ… ë†’ìŒ | âœ… ê¶Œì¥ |
| window.KUWOTECH_CONFIG + fallback | 2ê°œ | âš ï¸ ì¤‘ê°„ | âŒ ë‚®ìŒ | âš ï¸ ê°œì„  í•„ìš” |
| ì™„ì „ í•˜ë“œì½”ë”© | 1ê°œ | âŒ ë‚®ìŒ | âŒ ë‚®ìŒ | âŒ ê°œì„  í•„ìš” |

---

## ğŸ” 3. ì¸ì¦ í† í° ë° Storage ì¼ê´€ì„± ë¶„ì„

### 3.1 ë°œê²¬ëœ Storage íŒ¨í„´

#### localStorage ì‚¬ìš© íŒ¨í„´
```javascript
// ì¸ì¦ í† í°
localStorage.getItem('authToken')      // ê°€ì¥ ì¼ë°˜ì 
localStorage.getItem('user')           // ì‚¬ìš©ì ì •ë³´
localStorage.getItem('loginData')      // ë¡œê·¸ì¸ ë°ì´í„°
localStorage.getItem('userName')       // ì‚¬ìš©ì ì´ë¦„
localStorage.getItem('userId')         // ì‚¬ìš©ì ID

// ê¸°íƒ€
localStorage.getItem('theme-mode')     // í…Œë§ˆ ì„¤ì •
localStorage.getItem('full_backup_history')  // ë°±ì—… íˆìŠ¤í† ë¦¬
localStorage.getItem('autoBackupSettings')   // ë°±ì—… ì„¤ì •
```

#### sessionStorage ì‚¬ìš© íŒ¨í„´
```javascript
// ì¸ì¦ ê´€ë ¨
sessionStorage.getItem('token')        // âš ï¸ ì¼ë¶€ íŒŒì¼ì—ì„œë§Œ ì‚¬ìš©!
sessionStorage.getItem('user')         // ì‚¬ìš©ì ì •ë³´
sessionStorage.getItem('isLoggedIn')   // ë¡œê·¸ì¸ ìƒíƒœ
sessionStorage.getItem('userRole')     // ì‚¬ìš©ì ì—­í• 
sessionStorage.getItem('userName')     // ì‚¬ìš©ì ì´ë¦„

// ê¸°íƒ€
sessionStorage.getItem('sessionId')    // ì„¸ì…˜ ID
sessionStorage.getItem('scroll-position-${key}')  // ìŠ¤í¬ë¡¤ ìœ„ì¹˜
```

### 3.2 ğŸš¨ **CRITICAL**: Storage ì‚¬ìš© ë¶ˆì¼ì¹˜

#### ë¬¸ì œ 1: ë™ì¼ íŒŒì¼ ë‚´ í˜¼ìš© (employees.js)
```javascript
// 05.Source/04.admin_mode/06_employee_management/02_employees.js

// Line 66: localStorage ì‚¬ìš©
const token = localStorage.getItem('authToken');

// Line 112: localStorage ì‚¬ìš©
const token = localStorage.getItem('authToken');

// Line 180: localStorage ì‚¬ìš©
const token = localStorage.getItem('authToken');

// Line 1102: âš ï¸ sessionStorage ì‚¬ìš© (ë¶ˆì¼ì¹˜!)
const token = sessionStorage.getItem('token');

// Line 1131: âš ï¸ sessionStorage ì‚¬ìš© (ë¶ˆì¼ì¹˜!)
const token = sessionStorage.getItem('token');

// Line 1263: localStorage ì‚¬ìš©
const token = localStorage.getItem('authToken');
```

**ì‹¬ê°ë„**: ğŸ”´ **HIGH**
**ì˜í–¥**:
- í† í°ì´ ë‹¤ë¥¸ storageì— ì €ì¥ëœ ê²½ìš° ì¸ì¦ ì‹¤íŒ¨ ê°€ëŠ¥
- ì¼ë¶€ ê¸°ëŠ¥(ê±°ë˜ì²˜ ì´ê´€, lines 1102-1131)ì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í•  ìˆ˜ ìˆìŒ

#### ë¬¸ì œ 2: í† í° í‚¤ ì´ë¦„ ë¶ˆì¼ì¹˜
- `'authToken'` vs `'token'` - ì„œë¡œ ë‹¤ë¥¸ í‚¤ ì‚¬ìš©
- localStorageì™€ sessionStorage ê°„ ë°ì´í„° ê³µìœ  ë¶ˆê°€

#### ë¬¸ì œ 3: ì‚¬ìš©ì ì •ë³´ Storage ë¶ˆì¼ì¹˜
```javascript
// ëŒ€ë¶€ë¶„ì˜ íŒŒì¼
sessionStorage.getItem('user')         // Dashboard, downloads, layouts

// ì¼ë¶€ íŒŒì¼
localStorage.getItem('user')           // settings.js, database_manager.js

// í˜¼ìš©
sessionStorage.getItem('user') || localStorage.getItem('loginData')  // change_history.js
```

### 3.3 Storage ì¼ê´€ì„± ë¬¸ì œ ìš”ì•½

| ë°ì´í„° íƒ€ì… | localStorage í‚¤ | sessionStorage í‚¤ | ì¼ê´€ì„± | ê¶Œì¥ |
|-------------|-----------------|-------------------|--------|------|
| ì¸ì¦ í† í° | 'authToken' | 'token' | âŒ ë¶ˆì¼ì¹˜ | localStorage.getItem('authToken') |
| ì‚¬ìš©ì ì •ë³´ | 'user' | 'user' | âš ï¸ í˜¼ìš© | sessionStorage.getItem('user') |
| ì‚¬ìš©ì ì´ë¦„ | 'userName' | 'userName' | âš ï¸ í˜¼ìš© | sessionStorage.getItem('userName') |
| ì‚¬ìš©ì ì—­í•  | - | 'userRole' | âœ… ì¼ê´€ | sessionStorage.getItem('userRole') |
| ë¡œê·¸ì¸ ìƒíƒœ | - | 'isLoggedIn' | âœ… ì¼ê´€ | sessionStorage.getItem('isLoggedIn') |

---

## ğŸ”„ 4. ì–‘ë°©í–¥ ë°ì´í„° íë¦„ (CRUD) ë¶„ì„

### 4.1 ì˜ì—…ë‹´ë‹¹ëª¨ë“œ ë°ì´í„° íë¦„

#### 4.1.1 ëŒ€ì‹œë³´ë“œ (dashboard)
**ì½ê¸° (Read)**:
```javascript
// ì‚¬ìš©ì ì •ë³´
sessionStorage.getItem('user')
// KPI ë°ì´í„°ëŠ” IndexedDBì—ì„œ ì¡°íšŒ
```

**íŠ¹ì§•**:
- ì£¼ë¡œ IndexedDB ì‚¬ìš©
- Backend API í˜¸ì¶œ ì—†ìŒ (ë¡œì»¬ ë°ì´í„° ê¸°ë°˜)

#### 4.1.2 ë‹´ë‹¹ê±°ë˜ì²˜ê´€ë¦¬ (my-companies)
**ì½ê¸° (Read)**:
```javascript
// Line 104: ì œí’ˆ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/master/products`

// Line 121: ì§€ì—­ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/master/regions`

// Line 138: ë¶€ì„œ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/master/departments`

// Line 211: ë‹´ë‹¹ ê±°ë˜ì²˜ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/companies/manager/${encodeURIComponent(user.name)}`

// Line 1025: íŠ¹ì • ê±°ë˜ì²˜ ìƒì„¸
`${GlobalConfig.API_BASE_URL}/api/companies/${keyValue}`
```

**ìƒì„± (Create)**:
```javascript
// Line 981: ìƒˆ ê±°ë˜ì²˜ ë“±ë¡
POST `${GlobalConfig.API_BASE_URL}/api/companies`
Body: {
    companyNameERP, businessNumber, representative, phone,
    address, mainProducts, internalManager, region,
    businessType, notes
}
```

**ìˆ˜ì • (Update)**:
```javascript
// Line 1327: ê±°ë˜ì²˜ ì •ë³´ ìˆ˜ì •
PUT `${GlobalConfig.API_BASE_URL}/api/companies/${keyValue}`
Body: { [ìˆ˜ì •í•  í•„ë“œë“¤] }

// Line 492: ê±°ë˜ì²˜ ìƒíƒœ ì—…ë°ì´íŠ¸
PUT `${GlobalConfig.API_BASE_URL}/api/companies/${keyValue}`
```

**ì¸ì¦**: `Bearer ${localStorage.getItem('authToken')}`

#### 4.1.3 ì‹¤ì ë³´ê³ ì„œ ì‘ì„± (report-write)
**ì½ê¸° (Read)**:
```javascript
// Line 163: í˜„ì¬ ì‚¬ìš©ì ì •ë³´
state.currentUser = JSON.parse(sessionStorage.getItem('user'));
// ê±°ë˜ì²˜ ëª©ë¡ì€ IndexedDBì—ì„œ ì¡°íšŒ
```

**ìƒì„± (Create)**:
```javascript
// ApiManager ì‚¬ìš© (ê°„ì ‘ í˜¸ì¶œ)
apiManager.createReport(reportData)
â†’ POST /api/reports
Body: {
    employeeName, visitDate, companyName, visitPurpose,
    visitContent, salesAmount, nextPlan, submittedAt
}
```

**íŠ¹ì§•**:
- **ApiManager íŒ¨í„´** ì‚¬ìš©
- IndexedDBì™€ Backend API ë³‘í–‰ ì‚¬ìš©

#### 4.1.4 ì‹¤ì ë³´ê³ ì„œ í™•ì¸ (report-check)
**ì½ê¸° (Read)**:
```javascript
// ApiManager ì‚¬ìš©
apiManager.getReports({ submittedBy: state.currentUser.name })
â†’ GET /api/reports?submittedBy=${name}
```

**ìˆ˜ì • (Update)**:
```javascript
// ApiManager ì‚¬ìš©
apiManager.updateReport(reportId, updateData)
â†’ PUT /api/reports/${reportId}
```

**ì¸ì¦**: ApiManager ë‚´ë¶€ì—ì„œ ì²˜ë¦¬

#### 4.1.5 ê´€ë¦¬ìì˜ê²¬ í™•ì¸ (admin-feedback)
**ì½ê¸° (Read)**:
```javascript
// ApiManager ì‚¬ìš©
apiManager.getReports({ employeeName: currentUserName })
â†’ GET /api/reports?employeeName=${name}

// ì‘ë‹µ êµ¬ì¡° ë°©ì–´ ì½”ë“œ (lines 87-100)
const reportsArray = Array.isArray(result) ? result :
                    Array.isArray(result.data) ? result.data :
                    Array.isArray(result.reports) ? result.reports : [];
```

**íŠ¹ì§•**:
- ì½ê¸° ì „ìš© (Read-only)
- ì—¬ëŸ¬ API ì‘ë‹µ êµ¬ì¡° ë°©ì–´ (ì¼ê´€ì„± ë¶€ì¡± ì‹œì‚¬)

#### 4.1.6 ì‹œìŠ¤í…œì„¤ì • (system-settings)
**ì½ê¸° (Read)**:
```javascript
// Line 70: ë¶€ì„œ ëª©ë¡
`${GlobalConfig.API_CONFIG.BASE_URL}/api/employees`

// Line 116: í˜„ì¬ ì‚¬ìš©ì ì •ë³´
localStorage.getItem('user')
```

**ìˆ˜ì • (Update)**:
```javascript
// Line 224: ë³¸ì¸ ì •ë³´ ìˆ˜ì •
PUT `${GlobalConfig.API_CONFIG.BASE_URL}/api/employees/${currentUser.id}`
Body: { email, phone, department, role }

// Line 327: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
PUT `${GlobalConfig.API_CONFIG.BASE_URL}/api/employees/${currentUser.id}/password`
Body: { currentPassword, newPassword }
```

**ì¸ì¦**: `Bearer ${localStorage.getItem('authToken')}`

---

### 4.2 ê´€ë¦¬ìëª¨ë“œ ë°ì´í„° íë¦„

#### 4.2.1 ëŒ€ì‹œë³´ë“œ (dashboard)
**ì½ê¸° (Read)**:
```javascript
// ì‚¬ìš©ì ì •ë³´
sessionStorage.getItem('user')
// KPI ë°ì´í„°ëŠ” IndexedDBì—ì„œ ì¡°íšŒ
```

**íŠ¹ì§•**:
- ì˜ì—…ë‹´ë‹¹ëª¨ë“œì™€ ë™ì¼í•œ íŒ¨í„´

#### 4.2.2 ì „ì²´ê±°ë˜ì²˜ê´€ë¦¬ (all-companies)
**ì½ê¸° (Read)**:
```javascript
// Line 107: ì œí’ˆ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/master/products`

// Line 124: ì§€ì—­ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/master/regions`

// Line 141: ë¶€ì„œ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/master/departments`

// Line 159: ì§ì› ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/employees`

// Line 275: ì „ì²´ ê±°ë˜ì²˜ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/companies?limit=10000`

// Line 1146: íŠ¹ì • ê±°ë˜ì²˜ ìƒì„¸
`${GlobalConfig.API_BASE_URL}/api/companies/${keyValue}`
```

**ìƒì„± (Create)**:
```javascript
// Line 1102: ìƒˆ ê±°ë˜ì²˜ ë“±ë¡
POST `${GlobalConfig.API_BASE_URL}/api/companies`
Body: { [ëª¨ë“  ê±°ë˜ì²˜ í•„ë“œ] }
```

**ìˆ˜ì • (Update)**:
```javascript
// Line 1471: ê±°ë˜ì²˜ ì •ë³´ ìˆ˜ì •
PUT `${GlobalConfig.API_BASE_URL}/api/companies/${keyValue}`
```

**ì¸ì¦**: `Bearer ${localStorage.getItem('authToken')}`

**íŠ¹ì§•**:
- ì˜ì—…ë‹´ë‹¹ëª¨ë“œ 'my-companies'ì™€ ìœ ì‚¬í•˜ë‚˜ **ì „ì²´ ê±°ë˜ì²˜** ì¡°íšŒ
- limit=10000ìœ¼ë¡œ ëŒ€ëŸ‰ ë°ì´í„° ì¡°íšŒ

#### 4.2.3 ì‹¤ì ë³´ê³ ì„œ í™•ì¸ (report-confirm)
**ì½ê¸° (Read)**:
```javascript
// ApiManager ì‚¬ìš© (ì¶”ì •)
// ì „ì²´ ì§ì›ì˜ ë³´ê³ ì„œ ì¡°íšŒ
```

**ìˆ˜ì • (Update)**:
```javascript
// ê´€ë¦¬ì í”¼ë“œë°± ì‘ì„±/ìˆ˜ì •
// ApiManager ì‚¬ìš© (ì¶”ì •)
```

**íŠ¹ì§•**:
- ì „ì²´ ì§ì›ì˜ ë³´ê³ ì„œ ê´€ë¦¬
- í”¼ë“œë°± ì‘ì„± ê¸°ëŠ¥

#### 4.2.4 ì‹¤ì í˜„í™©íŒ (presentation)
**ì½ê¸° (Read)**:
```javascript
// Line 62: âš ï¸ í•˜ë“œì½”ë”© + fallback íŒ¨í„´
const API_BASE_URL = window.KUWOTECH_CONFIG?.API_BASE_URL ||
  'https://kuwotech-sales-production-aa64.up.railway.app/api';

// ì „ì²´ ì‹¤ì  ë°ì´í„° ì¡°íšŒ (ì¶”ì •)
```

**ì¸ì¦**: `Bearer ${localStorage.getItem('authToken')}`

**íŠ¹ì§•**:
- ì‹œê°í™” ì¤‘ì‹¬ (ì½ê¸° ì „ìš©)
- âš ï¸ API URL í•˜ë“œì½”ë”© ë¬¸ì œ

#### 4.2.5 ë°ì´í„° ê´€ë¦¬ (data-management)
**ì½ê¸° (Read)**:
```javascript
// Line 75: âš ï¸ í•˜ë“œì½”ë”© + fallback íŒ¨í„´
const API_BASE_URL = window.KUWOTECH_CONFIG?.API_BASE_URL ||
  'https://kuwotech-sales-production-aa64.up.railway.app/api';

// Line 79: ì „ì²´ ê±°ë˜ì²˜ ì¡°íšŒ
`${API_BASE_URL}/companies?limit=9999`
```

**ì¸ì¦**: `Bearer ${localStorage.getItem('authToken')}`

**íŠ¹ì§•**:
- ë°±ì—…/ë³µì› ê¸°ëŠ¥
- IndexedDB ì¤‘ì‹¬ ì‘ì—…
- âš ï¸ API URL í•˜ë“œì½”ë”© ë¬¸ì œ

#### 4.2.6 ì§ì› ê´€ë¦¬ (employee-management)
**ì½ê¸° (Read)**:
```javascript
// Line 68: ë¶€ì„œ ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/master/departments`

// Line 116: ì „ì²´ ì§ì› ëª©ë¡
`${GlobalConfig.API_BASE_URL}/api/employees?limit=9999`

// Line 183: ì „ì²´ ê±°ë˜ì²˜ ëª©ë¡ (ë‹´ë‹¹ ë°°ì •ìš©)
`${GlobalConfig.API_BASE_URL}/api/companies?limit=9999`
```

**ì½ê¸° (ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥)**:
```javascript
// Line 1103: âš ï¸ sessionStorage.getItem('token') ì‚¬ìš©!
const token = sessionStorage.getItem('token');
`${GlobalConfig.API_BASE_URL}/companies?limit=9999`
```

**ìˆ˜ì • (Update)**:
```javascript
// Line 1135: ê±°ë˜ì²˜ ë‹´ë‹¹ì ë³€ê²½
PUT `${GlobalConfig.API_BASE_URL}/companies/${keyValue}`
Body: { internalManager: targetName }

// Line 1264: ì§ì› ìƒíƒœ ë³€ê²½
PUT `${GlobalConfig.API_BASE_URL}/api/employees/${employeeId}`
Body: { status }
```

**ì¸ì¦**:
- Lines 66, 112, 180, 1263: `localStorage.getItem('authToken')`
- Lines 1102, 1131: `sessionStorage.getItem('token')` âš ï¸ **ë¶ˆì¼ì¹˜!**

**ğŸš¨ CRITICAL ë¬¸ì œ**:
- ë™ì¼ íŒŒì¼ ë‚´ **ì¸ì¦ í† í° storage í˜¼ìš©**
- ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥ì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í•  ìˆ˜ ìˆìŒ

#### 4.2.7 ì‹œìŠ¤í…œì„¤ì • (system-settings)
**ì˜ì—…ë‹´ë‹¹ëª¨ë“œì™€ ë™ì¼** (458 lines ì™„ì „ ë™ì¼)

#### 4.2.8 ì—‘ì…€ ì—…ë¡œë“œ (excel-upload)
**ì½ê¸° (Read)**:
```javascript
// IndexedDB ì „ìš©
const db = await getDB();
const tx = db.transaction(['companies'], 'readonly');
```

**ìƒì„± (Create)**:
```javascript
// Line 648: ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
excelLoader.loadExcelFile(selectedFile, {
    dataType: 'companies',
    createBackupFirst: true
});
// â†’ IndexedDBì— ì§ì ‘ ì €ì¥
```

**íŠ¹ì§•**:
- **Backend API í˜¸ì¶œ ì—†ìŒ**
- ì „ì²´ í”„ë¡œì„¸ìŠ¤ê°€ IndexedDBë¡œë§Œ ì²˜ë¦¬
- ExcelDataLoader íŒ¨í„´ ì‚¬ìš©

---

### 4.3 CRUD ì‘ì—… íŒ¨í„´ ìš”ì•½

| ê¸°ëŠ¥ | ì½ê¸° (R) | ìƒì„± (C) | ìˆ˜ì • (U) | ì‚­ì œ (D) | ì£¼ìš” íŒ¨í„´ |
|------|----------|----------|----------|----------|-----------|
| **ì˜ì—…ë‹´ë‹¹ëª¨ë“œ** |
| Dashboard | IndexedDB | - | - | - | ë¡œì»¬ ì „ìš© |
| My Companies | API (5ê°œ) | API | API (2ê°œ) | - | Direct Fetch |
| Report Write | IndexedDB | API | - | - | ApiManager |
| Report Check | API | - | API | - | ApiManager |
| Admin Feedback | API | - | - | - | ApiManager (Read-only) |
| System Settings | API (2ê°œ) | - | API (2ê°œ) | - | Direct Fetch |
| **ê´€ë¦¬ìëª¨ë“œ** |
| Dashboard | IndexedDB | - | - | - | ë¡œì»¬ ì „ìš© |
| All Companies | API (6ê°œ) | API | API | - | Direct Fetch |
| Report Confirm | API | - | API | - | ApiManager (ì¶”ì •) |
| Presentation | API | - | - | - | Direct Fetch |
| Data Management | API | - | - | - | Direct Fetch |
| Employee Mgmt | API (3ê°œ) | - | API (2ê°œ) | - | Direct Fetch (âš ï¸ í† í° ë¶ˆì¼ì¹˜) |
| System Settings | API (2ê°œ) | - | API (2ê°œ) | - | Direct Fetch |
| Excel Upload | IndexedDB | IndexedDB | - | - | ë¡œì»¬ ì „ìš© |

---

## ğŸ“ 5. API í˜¸ì¶œ íŒ¨í„´ ë¹„êµ

### 5.1 ApiManager íŒ¨í„´ (Sales Mode ì£¼ ì‚¬ìš©)

**ìœ„ì¹˜**: 05.Source/01.common/13_api_manager.js

**êµ¬ì¡°**:
```javascript
class ApiManager {
    constructor() {
        this.baseURL = 'https://kuwotech-sales-production-aa64.up.railway.app/api'; // âš ï¸ í•˜ë“œì½”ë”©
        this.timeout = 30000;
    }

    // ê³µí†µ ìš”ì²­ ë©”ì„œë“œ
    async request(endpoint, options = {}) {
        const url = `${this.baseURL}${endpoint}`;
        const token = localStorage.getItem('authToken');
        // ... ì—ëŸ¬ ì²˜ë¦¬, ì¬ì‹œë„ ë¡œì§ ë“±
    }

    // ì‹¤ì ë³´ê³ ì„œ ë©”ì„œë“œ
    async getReports(params) { ... }
    async createReport(data) { ... }
    async updateReport(id, data) { ... }
}
```

**ì¥ì **:
- âœ… ì¤‘ì•™í™”ëœ ì—ëŸ¬ ì²˜ë¦¬
- âœ… ìë™ ì¬ì‹œë„ ë¡œì§
- âœ… ì¼ê´€ëœ ì¸ì¦ í—¤ë” ì²˜ë¦¬
- âœ… ë¡œë”©/ì—ëŸ¬ ìƒíƒœ ê´€ë¦¬

**ë‹¨ì **:
- âŒ baseURL í•˜ë“œì½”ë”©
- âŒ GlobalConfig ë¯¸ì‚¬ìš©

**ì‚¬ìš© ìœ„ì¹˜**:
- 03.sales_mode/03_report_write/02_report_write.js
- 03.sales_mode/04_report_check/02_report_check.js
- 03.sales_mode/05_admin_feedback/02_admin_feedback.js

### 5.2 Direct Fetch íŒ¨í„´ (Admin Mode ì£¼ ì‚¬ìš©)

**êµ¬ì¡°**:
```javascript
// GlobalConfig ì‚¬ìš©
const response = await fetch(`${GlobalConfig.API_BASE_URL}/api/companies`, {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
    }
});

if (!response.ok) {
    throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
}

const data = await response.json();
```

**ì¥ì **:
- âœ… GlobalConfig í™œìš©
- âœ… ìœ ì—°í•œ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- âœ… íˆ¬ëª…í•œ ì—ëŸ¬ ì²˜ë¦¬

**ë‹¨ì **:
- âŒ ì—ëŸ¬ ì²˜ë¦¬ ì¤‘ë³µ ì½”ë“œ
- âŒ ì¬ì‹œë„ ë¡œì§ ì—†ìŒ
- âŒ ì¼ê´€ì„± ë¶€ì¡±

**ì‚¬ìš© ìœ„ì¹˜**:
- 03.sales_mode/02_my_companies/02_my_companies.js
- 04.admin_mode/02_all_companies/02_all_companies.js
- 04.admin_mode/06_employee_management/02_employees.js
- 03.sales_mode/06_system_settings/02_settings.js
- 04.admin_mode/07_system_settings/02_settings.js

### 5.3 íŒ¨í„´ ë¹„êµ ìš”ì•½

| íŠ¹ì„± | ApiManager | Direct Fetch |
|------|------------|--------------|
| **ì‚¬ìš© ëª¨ë“œ** | ì£¼ë¡œ Sales Mode | ì£¼ë¡œ Admin Mode |
| **GlobalConfig ì‚¬ìš©** | âŒ í•˜ë“œì½”ë”© | âœ… ì‚¬ìš© |
| **ì—ëŸ¬ ì²˜ë¦¬** | âœ… ì¤‘ì•™í™” | âš ï¸ ë¶„ì‚° |
| **ì¬ì‹œë„ ë¡œì§** | âœ… ìˆìŒ | âŒ ì—†ìŒ |
| **ì½”ë“œ ì¤‘ë³µ** | âœ… ì ìŒ | âš ï¸ ë§ìŒ |
| **ìœ ì—°ì„±** | âš ï¸ ì œí•œì  | âœ… ë†’ìŒ |
| **ìœ ì§€ë³´ìˆ˜ì„±** | âœ… ë†’ìŒ | âš ï¸ ì¤‘ê°„ |
| **ê¶Œì¥ ì—¬ë¶€** | âš ï¸ ê°œì„  í•„ìš” | âœ… ì¡°ê±´ë¶€ ê¶Œì¥ |

---

## âš ï¸ 6. ë°œê²¬ëœ ë¬¸ì œì  ë° ì‹¬ê°ë„

### 6.1 ğŸ”´ **HIGH** - Storage í˜¼ìš© (employees.js)

**íŒŒì¼**: 04.admin_mode/06_employee_management/02_employees.js

**ë¬¸ì œ**:
- ë™ì¼ íŒŒì¼ì—ì„œ `localStorage.getItem('authToken')`ê³¼ `sessionStorage.getItem('token')` í˜¼ìš©
- Lines 66, 112, 180, 1263: localStorage ì‚¬ìš©
- Lines 1102, 1131: sessionStorage ì‚¬ìš© (ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥)

**ì˜í–¥**:
- ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥ì—ì„œ í† í°ì„ ì°¾ì§€ ëª»í•´ **ì¸ì¦ ì‹¤íŒ¨** ê°€ëŠ¥
- ì¼ê´€ì„± ì—†ëŠ” ë™ì‘ìœ¼ë¡œ ì‚¬ìš©ì í˜¼ë€

**ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤**:
1. ê´€ë¦¬ìê°€ ë¡œê·¸ì¸ (authTokenì´ localStorageì— ì €ì¥ë¨)
2. ì§ì› ê´€ë¦¬ â†’ ê±°ë˜ì²˜ ì´ê´€ ì‹œë„
3. Line 1102ì—ì„œ `sessionStorage.getItem('token')` í˜¸ì¶œ
4. sessionStorageì— 'token' ì—†ìŒ â†’ **ì¸ì¦ ì‹¤íŒ¨**

**ìš°ì„ ìˆœìœ„**: ğŸ”´ **ì¦‰ì‹œ ìˆ˜ì • í•„ìš”**

### 6.2 ğŸŸ  **MEDIUM** - API URL í•˜ë“œì½”ë”©

**íŒŒì¼**:
- 04.admin_mode/04_presentation/02_presentation.js (line 62)
- 04.admin_mode/05_data_management/02_data_management.js (line 75)
- 01.common/13_api_manager.js (line 35)

**ë¬¸ì œ**:
- Railway URLì´ ì½”ë“œì— **ì§ì ‘ í•˜ë“œì½”ë”©**ë¨
- GlobalConfigì˜ ìë™ ê°ì§€ ë¡œì§ì„ ìš°íšŒ

**ì˜í–¥**:
- í™˜ê²½ ë³€ê²½ (ê°œë°œ/ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜) ì‹œ ì½”ë“œ ìˆ˜ì • í•„ìš”
- ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ì¦ê°€

**ìš°ì„ ìˆœìœ„**: ğŸŸ  **ì¡°ì†íˆ ê°œì„ **

### 6.3 ğŸŸ  **MEDIUM** - í† í° í‚¤ ì´ë¦„ ë¶ˆì¼ì¹˜

**ë¬¸ì œ**:
- `'authToken'` (í‘œì¤€) vs `'token'` (ì¼ë¶€ íŒŒì¼)
- localStorage vs sessionStorage ê°„ ë°ì´í„° ë¶ˆì¼ì¹˜

**ì˜í–¥**:
- ì„¸ì…˜ ê´€ë¦¬ í˜¼ë€
- ë””ë²„ê¹… ì–´ë ¤ì›€

**ìš°ì„ ìˆœìœ„**: ğŸŸ  **ì¡°ì†íˆ ê°œì„ **

### 6.4 ğŸŸ¡ **LOW** - API ì‘ë‹µ êµ¬ì¡° ë°©ì–´ ì½”ë“œ

**íŒŒì¼**: 03.sales_mode/05_admin_feedback/02_admin_feedback.js (lines 87-100)

**ë¬¸ì œ**:
```javascript
const reportsArray = Array.isArray(result) ? result :
                    Array.isArray(result.data) ? result.data :
                    Array.isArray(result.reports) ? result.reports : [];
```

**ì˜ë¯¸**:
- Backend API ì‘ë‹µ êµ¬ì¡°ê°€ **ì¼ê´€ë˜ì§€ ì•ŠìŒ**ì„ ì‹œì‚¬
- ì—¬ëŸ¬ ì‘ë‹µ í˜•ì‹ì— ëŒ€í•œ ë°©ì–´ ì½”ë“œ

**ì˜í–¥**:
- Frontendì™€ Backend ê°„ ê³„ì•½(contract) ë¶ˆëª…í™•
- ì˜ˆê¸°ì¹˜ ì•Šì€ ì‘ë‹µ êµ¬ì¡°ë¡œ ì¸í•œ ë²„ê·¸ ê°€ëŠ¥

**ìš°ì„ ìˆœìœ„**: ğŸŸ¡ **ê°œì„  ê¶Œì¥**

### 6.5 ğŸŸ¡ **LOW** - ApiManager baseURL í•˜ë“œì½”ë”©

**íŒŒì¼**: 01.common/13_api_manager.js (line 35)

**ë¬¸ì œ**:
- ApiManagerê°€ GlobalConfigë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- ì§ì ‘ í•˜ë“œì½”ë”©ëœ Railway URL ì‚¬ìš©

**ì˜í–¥**:
- ApiManagerë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ê¸°ëŠ¥ì— ì˜í–¥
- í™˜ê²½ ë³€ê²½ ì‹œ ìˆ˜ì • í•„ìš”

**ìš°ì„ ìˆœìœ„**: ğŸŸ¡ **ê°œì„  ê¶Œì¥**

---

## âœ… 7. ê°œì„  ë°©í–¥ ë° ê¶Œì¥ì‚¬í•­

### 7.1 ğŸ”´ **ì¦‰ì‹œ ìˆ˜ì •**: Storage ì¼ê´€ì„± í™•ë³´

#### 7.1.1 employees.js ìˆ˜ì •

**ìˆ˜ì • ëŒ€ìƒ**: 04.admin_mode/06_employee_management/02_employees.js

**ìˆ˜ì • ì „ (Lines 1102-1103)**:
```javascript
const token = sessionStorage.getItem('token');
const response = await fetch(`${GlobalConfig.API_BASE_URL}/companies?limit=9999`, {
```

**ìˆ˜ì • í›„**:
```javascript
const token = localStorage.getItem('authToken');  // ğŸ”§ ìˆ˜ì •
const response = await fetch(`${GlobalConfig.API_BASE_URL}/companies?limit=9999`, {
```

**ìˆ˜ì • ì „ (Lines 1131-1132)**:
```javascript
const token = sessionStorage.getItem('token');
const response = await fetch(`${GlobalConfig.API_BASE_URL}/companies/${keyValue}`, {
```

**ìˆ˜ì • í›„**:
```javascript
const token = localStorage.getItem('authToken');  // ğŸ”§ ìˆ˜ì •
const response = await fetch(`${GlobalConfig.API_BASE_URL}/companies/${keyValue}`, {
```

#### 7.1.2 ì „ì²´ ì‹œìŠ¤í…œ í‘œì¤€í™”

**ê¶Œì¥ í‘œì¤€**:

| ë°ì´í„° | Storage íƒ€ì… | í‚¤ ì´ë¦„ | ìš©ë„ |
|--------|-------------|---------|------|
| ì¸ì¦ í† í° | localStorage | 'authToken' | API ì¸ì¦ |
| ì‚¬ìš©ì ì •ë³´ | sessionStorage | 'user' | ì„¸ì…˜ ë™ì•ˆ ìœ ì§€ |
| ì‚¬ìš©ì ì´ë¦„ | sessionStorage | 'userName' | í‘œì‹œìš© |
| ì‚¬ìš©ì ì—­í•  | sessionStorage | 'userRole' | ê¶Œí•œ í™•ì¸ |
| ë¡œê·¸ì¸ ìƒíƒœ | sessionStorage | 'isLoggedIn' | ë¡œê·¸ì¸ ì—¬ë¶€ |

**ì´ìœ **:
- **authToken**: ë¸Œë¼ìš°ì € ì¬ì‹œì‘ í›„ì—ë„ ìœ ì§€ â†’ localStorage
- **user, userName, userRole**: ì„¸ì…˜ ì¢…ë£Œ ì‹œ ì‚­ì œ â†’ sessionStorage
- **ë³´ì•ˆ**: ë¯¼ê°í•œ í† í°ì€ localStorage, ì¼ë°˜ ì •ë³´ëŠ” sessionStorage

### 7.2 ğŸŸ  **ìš°ì„  ê°œì„ **: API URL ì¤‘ì•™í™”

#### 7.2.1 ApiManager ìˆ˜ì •

**ìˆ˜ì • ëŒ€ìƒ**: 01.common/13_api_manager.js

**ìˆ˜ì • ì „ (Lines 32-36)**:
```javascript
constructor() {
    this.baseURL = 'https://kuwotech-sales-production-aa64.up.railway.app/api';
    this.timeout = 30000;
    // ...
}
```

**ìˆ˜ì • í›„**:
```javascript
import GlobalConfig from './01_global_config.js';  // ğŸ”§ Import ì¶”ê°€

constructor() {
    this.baseURL = GlobalConfig.API_BASE_URL;  // ğŸ”§ ìˆ˜ì •
    this.timeout = 30000;
    // ...
}
```

#### 7.2.2 presentation.js ìˆ˜ì •

**ìˆ˜ì • ëŒ€ìƒ**: 04.admin_mode/04_presentation/02_presentation.js

**ìˆ˜ì • ì „ (Line 62)**:
```javascript
const API_BASE_URL = window.KUWOTECH_CONFIG?.API_BASE_URL ||
    'https://kuwotech-sales-production-aa64.up.railway.app/api';
```

**ìˆ˜ì • í›„**:
```javascript
import GlobalConfig from '../../01.common/01_global_config.js';  // ğŸ”§ Import ì¶”ê°€
// ...
const API_BASE_URL = GlobalConfig.API_BASE_URL;  // ğŸ”§ ìˆ˜ì •
```

#### 7.2.3 data_management.js ìˆ˜ì •

**ìˆ˜ì • ëŒ€ìƒ**: 04.admin_mode/05_data_management/02_data_management.js

**ìˆ˜ì • ì „ (Line 75)**:
```javascript
const API_BASE_URL = window.KUWOTECH_CONFIG?.API_BASE_URL ||
    'https://kuwotech-sales-production-aa64.up.railway.app/api';
```

**ìˆ˜ì • í›„**:
```javascript
import GlobalConfig from '../../01.common/01_global_config.js';  // ğŸ”§ Import ì¶”ê°€
// ...
const API_BASE_URL = GlobalConfig.API_BASE_URL;  // ğŸ”§ ìˆ˜ì •
```

### 7.3 ğŸŸ¡ **ì¥ê¸° ê°œì„ **: API íŒ¨í„´ í†µì¼

#### ì˜µì…˜ 1: ApiManager ì „ë©´ í™•ëŒ€ (ê¶Œì¥)

**ì¥ì **:
- âœ… ì¤‘ì•™í™”ëœ ì—ëŸ¬ ì²˜ë¦¬
- âœ… ì¬ì‹œë„ ë¡œì§
- âœ… ì¼ê´€ëœ ì¸ì¦
- âœ… ë¡œë”© ìƒíƒœ ê´€ë¦¬

**êµ¬í˜„**:
1. ApiManagerì— companies, employees ë©”ì„œë“œ ì¶”ê°€
```javascript
// 13_api_manager.jsì— ì¶”ê°€
class ApiManager {
    // ê¸°ì¡´ reports ë©”ì„œë“œë“¤...

    // ê±°ë˜ì²˜ ê´€ë ¨
    async getCompanies(params = {}) { ... }
    async getCompanyById(id) { ... }
    async createCompany(data) { ... }
    async updateCompany(id, data) { ... }

    // ì§ì› ê´€ë ¨
    async getEmployees(params = {}) { ... }
    async getEmployeeById(id) { ... }
    async updateEmployee(id, data) { ... }

    // ë§ˆìŠ¤í„° ë°ì´í„°
    async getMasterProducts() { ... }
    async getMasterRegions() { ... }
    async getMasterDepartments() { ... }
}
```

2. ëª¨ë“  íŒŒì¼ì—ì„œ ApiManager ì‚¬ìš©ìœ¼ë¡œ ì „í™˜

**ë§ˆì´ê·¸ë ˆì´ì…˜ ìš°ì„ ìˆœìœ„**:
1. ê±°ë˜ì²˜ ê´€ë¦¬ (my-companies, all-companies)
2. ì§ì› ê´€ë¦¬ (employee-management)
3. ì‹œìŠ¤í…œ ì„¤ì • (system-settings)

#### ì˜µì…˜ 2: Direct Fetch í‘œì¤€í™” (ëŒ€ì•ˆ)

**êµ¬í˜„**:
1. ê³µí†µ fetch wrapper í•¨ìˆ˜ ìƒì„±
```javascript
// 01.common/15_api_helper.js (ì‹ ê·œ ìƒì„±)
import GlobalConfig from './01_global_config.js';

export async function apiRequest(endpoint, options = {}) {
    const url = `${GlobalConfig.API_BASE_URL}${endpoint}`;
    const token = localStorage.getItem('authToken');

    const config = {
        ...options,
        headers: {
            'Content-Type': 'application/json',
            'Authorization': token ? `Bearer ${token}` : undefined,
            ...options.headers
        }
    };

    const response = await fetch(url, config);

    if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || 'API ìš”ì²­ ì‹¤íŒ¨');
    }

    return response.json();
}
```

2. ëª¨ë“  fetch í˜¸ì¶œì„ apiRequestë¡œ êµì²´

**ë¹„êµ**:
| í•­ëª© | ì˜µì…˜ 1 (ApiManager) | ì˜µì…˜ 2 (Helper) |
|------|-------------------|----------------|
| êµ¬í˜„ ë‚œì´ë„ | ë†’ìŒ | ë‚®ìŒ |
| ìœ ì§€ë³´ìˆ˜ì„± | ë§¤ìš° ë†’ìŒ | ë†’ìŒ |
| ì½”ë“œ ê°„ê²°ì„± | ë§¤ìš° ë†’ìŒ | ë†’ìŒ |
| ê¸°ì¡´ ì½”ë“œ ì˜í–¥ | í¼ | ì‘ìŒ |
| ê¶Œì¥ | âœ… ì¥ê¸°ì  ê¶Œì¥ | âš ï¸ ë‹¨ê¸°ì  ëŒ€ì•ˆ |

### 7.4 Backend API ì‘ë‹µ êµ¬ì¡° í‘œì¤€í™”

**í˜„ì¬ ë¬¸ì œ**:
```javascript
// admin_feedback.jsì—ì„œ ì—¬ëŸ¬ ì‘ë‹µ í˜•ì‹ ë°©ì–´
const reportsArray = Array.isArray(result) ? result :
                    Array.isArray(result.data) ? result.data :
                    Array.isArray(result.reports) ? result.reports : [];
```

**ê¶Œì¥ í‘œì¤€ ì‘ë‹µ êµ¬ì¡°**:
```json
{
    "success": true,
    "data": [...],
    "message": "ì„±ê³µ ë©”ì‹œì§€",
    "pagination": {
        "total": 100,
        "page": 1,
        "limit": 20
    }
}
```

**ì—ëŸ¬ ì‘ë‹µ êµ¬ì¡°**:
```json
{
    "success": false,
    "error": {
        "code": "INVALID_INPUT",
        "message": "ì—ëŸ¬ ë©”ì‹œì§€",
        "details": {...}
    }
}
```

**Backend ìˆ˜ì • ê¶Œì¥**:
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì¼ê´€ëœ ì‘ë‹µ êµ¬ì¡° ì‚¬ìš©
- Frontendì—ì„œ ë‹¨ì¼ íŒŒì‹± ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥

---

## ğŸ“Š 8. ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

### 8.1 ì „ì²´ ì•„í‚¤í…ì²˜ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Frontend (Browser)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ì˜ì—…ë‹´ë‹¹ëª¨ë“œ    â”‚         â”‚  ê´€ë¦¬ìëª¨ë“œ      â”‚           â”‚
â”‚  â”‚  (Sales Mode)   â”‚         â”‚  (Admin Mode)   â”‚           â”‚
â”‚  â”‚  6ê°œ ë©”ë‰´       â”‚         â”‚  8ê°œ ë©”ë‰´       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                           â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                      â”‚                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚   API Communication       â”‚                      â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚         â”‚ â€¢ ApiManager (ì¼ë¶€)       â”‚                      â”‚
â”‚         â”‚ â€¢ Direct Fetch (ëŒ€ë¶€ë¶„)   â”‚                      â”‚
â”‚         â”‚ â€¢ GlobalConfig.API_BASE_URLâ”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                      â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTPS
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Backend (Express.js on Railway)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  https://kuwotech-sales-production-aa64.up.railway.app      â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Companies  â”‚  â”‚   Reports   â”‚  â”‚  Employees  â”‚         â”‚
â”‚  â”‚    API      â”‚  â”‚     API     â”‚  â”‚     API     â”‚         â”‚
â”‚  â”‚  Routes     â”‚  â”‚   Routes    â”‚  â”‚   Routes    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                           â”‚                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚    Database Access        â”‚                  â”‚
â”‚              â”‚    (MySQL2 Driver)        â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ MySQL Protocol
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Railway MySQL Database                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tables:                                                     â”‚
â”‚  â€¢ companies (ê±°ë˜ì²˜)                                        â”‚
â”‚  â€¢ reports (ì‹¤ì ë³´ê³ ì„œ)                                      â”‚
â”‚  â€¢ employees (ì§ì›)                                          â”‚
â”‚  â€¢ master_products (ì œí’ˆ ë§ˆìŠ¤í„°)                             â”‚
â”‚  â€¢ master_regions (ì§€ì—­ ë§ˆìŠ¤í„°)                              â”‚
â”‚  â€¢ master_departments (ë¶€ì„œ ë§ˆìŠ¤í„°)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ì¸ì¦ í† í° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Login Process                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. User Login                                               â”‚
â”‚     â”œâ”€ POST /api/auth/login                                 â”‚
â”‚     â”œâ”€ { username, password }                               â”‚
â”‚     â”‚                                                        â”‚
â”‚  2. Backend Response                                         â”‚
â”‚     â”œâ”€ { success: true, token: "JWT_TOKEN", user: {...} }  â”‚
â”‚     â”‚                                                        â”‚
â”‚  3. Frontend Storage                                         â”‚
â”‚     â”œâ”€ localStorage.setItem('authToken', token)  âœ…         â”‚
â”‚     â”œâ”€ sessionStorage.setItem('user', JSON.stringify(user)) â”‚
â”‚     â””â”€ sessionStorage.setItem('userRole', user.role)        â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Request Process                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. Get Token                                                â”‚
â”‚     â”œâ”€ âœ… localStorage.getItem('authToken')  (ê¶Œì¥)         â”‚
â”‚     â””â”€ âš ï¸ sessionStorage.getItem('token')    (ë¬¸ì œ!)       â”‚
â”‚                                                               â”‚
â”‚  2. Add Authorization Header                                 â”‚
â”‚     â”œâ”€ headers: {                                           â”‚
â”‚     â”‚    'Authorization': `Bearer ${token}`,                â”‚
â”‚     â”‚    'Content-Type': 'application/json'                 â”‚
â”‚     â”‚  }                                                     â”‚
â”‚     â”‚                                                        â”‚
â”‚  3. Send Request                                             â”‚
â”‚     â”œâ”€ fetch(url, { method, headers, body })               â”‚
â”‚     â”‚                                                        â”‚
â”‚  4. Backend Verification                                     â”‚
â”‚     â”œâ”€ JWT í† í° ê²€ì¦                                         â”‚
â”‚     â”œâ”€ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸                                      â”‚
â”‚     â””â”€ ì‘ë‹µ ë°˜í™˜                                             â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 CRUD ì‘ì—… íë¦„ ì˜ˆì‹œ (ê±°ë˜ì²˜ ê´€ë¦¬)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Create Company (ê±°ë˜ì²˜ ìƒì„±)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Frontend (my-companies.js:981)                              â”‚
â”‚    â†“                                                         â”‚
â”‚  1. User Input                                               â”‚
â”‚     â””â”€ { companyName, businessNumber, address, ... }        â”‚
â”‚                                                               â”‚
â”‚  2. Validation                                               â”‚
â”‚     â””â”€ if (!companyName) â†’ showToast('error')              â”‚
â”‚                                                               â”‚
â”‚  3. API Call                                                 â”‚
â”‚     â””â”€ POST ${GlobalConfig.API_BASE_URL}/api/companies      â”‚
â”‚        Headers: Bearer ${localStorage.getItem('authToken')} â”‚
â”‚        Body: JSON.stringify(companyData)                     â”‚
â”‚                                                               â”‚
â”‚  Backend (/api/companies POST)                               â”‚
â”‚    â†“                                                         â”‚
â”‚  4. Authentication Check                                     â”‚
â”‚     â””â”€ JWT í† í° ê²€ì¦                                         â”‚
â”‚                                                               â”‚
â”‚  5. Authorization Check                                      â”‚
â”‚     â””â”€ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸ (ì˜ì—…ë‹´ë‹¹ or ê´€ë¦¬ì)                 â”‚
â”‚                                                               â”‚
â”‚  6. Data Validation                                          â”‚
â”‚     â””â”€ í•„ìˆ˜ í•„ë“œ ê²€ì¦, ì¤‘ë³µ ì²´í¬                             â”‚
â”‚                                                               â”‚
â”‚  7. Database Insert                                          â”‚
â”‚     â””â”€ INSERT INTO companies (...) VALUES (...)             â”‚
â”‚                                                               â”‚
â”‚  8. Response                                                 â”‚
â”‚     â””â”€ { success: true, company: {...} }                    â”‚
â”‚                                                               â”‚
â”‚  Frontend                                                    â”‚
â”‚    â†“                                                         â”‚
â”‚  9. Success Handling                                         â”‚
â”‚     â”œâ”€ showToast('ê±°ë˜ì²˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤', 'success')       â”‚
â”‚     â”œâ”€ Reload company list                                  â”‚
â”‚     â””â”€ Close modal                                           â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Read Companies (ê±°ë˜ì²˜ ì¡°íšŒ)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Frontend                                                    â”‚
â”‚    â†“                                                         â”‚
â”‚  1. Mode Check                                               â”‚
â”‚     â”œâ”€ Sales Mode â†’ /api/companies/manager/{name}          â”‚
â”‚     â””â”€ Admin Mode â†’ /api/companies?limit=10000             â”‚
â”‚                                                               â”‚
â”‚  2. API Call                                                 â”‚
â”‚     â””â”€ GET ${GlobalConfig.API_BASE_URL}${endpoint}          â”‚
â”‚        Headers: Bearer ${localStorage.getItem('authToken')} â”‚
â”‚                                                               â”‚
â”‚  Backend                                                     â”‚
â”‚    â†“                                                         â”‚
â”‚  3. Authentication & Authorization                           â”‚
â”‚     â””â”€ JWT ê²€ì¦ + ê¶Œí•œ í™•ì¸                                  â”‚
â”‚                                                               â”‚
â”‚  4. Query Execution                                          â”‚
â”‚     â”œâ”€ Sales: WHERE internalManager = ?                     â”‚
â”‚     â””â”€ Admin: SELECT * (ì „ì²´)                               â”‚
â”‚                                                               â”‚
â”‚  5. Data Transformation                                      â”‚
â”‚     â””â”€ Database rows â†’ JSON objects                         â”‚
â”‚                                                               â”‚
â”‚  6. Response                                                 â”‚
â”‚     â””â”€ { companies: [...] }                                 â”‚
â”‚                                                               â”‚
â”‚  Frontend                                                    â”‚
â”‚    â†“                                                         â”‚
â”‚  7. Data Processing                                          â”‚
â”‚     â”œâ”€ Map DB fields to display names                       â”‚
â”‚     â”œâ”€ Apply filters                                        â”‚
â”‚     â””â”€ Render table                                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Update Company (ê±°ë˜ì²˜ ìˆ˜ì •)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Frontend (my-companies.js:1327)                             â”‚
â”‚    â†“                                                         â”‚
â”‚  1. Get Current Data                                         â”‚
â”‚     â””â”€ Fetch company details                                â”‚
â”‚                                                               â”‚
â”‚  2. User Edits                                               â”‚
â”‚     â””â”€ Modify fields in form                                â”‚
â”‚                                                               â”‚
â”‚  3. API Call                                                 â”‚
â”‚     â””â”€ PUT ${GlobalConfig.API_BASE_URL}/api/companies/${id} â”‚
â”‚        Headers: Bearer ${localStorage.getItem('authToken')} â”‚
â”‚        Body: JSON.stringify(updatedFields)                   â”‚
â”‚                                                               â”‚
â”‚  Backend                                                     â”‚
â”‚    â†“                                                         â”‚
â”‚  4. Authentication & Authorization                           â”‚
â”‚     â”œâ”€ JWT ê²€ì¦                                              â”‚
â”‚     â””â”€ ìˆ˜ì • ê¶Œí•œ í™•ì¸ (ë‹´ë‹¹ì or ê´€ë¦¬ì)                     â”‚
â”‚                                                               â”‚
â”‚  5. Database Update                                          â”‚
â”‚     â””â”€ UPDATE companies SET ... WHERE id = ?                â”‚
â”‚                                                               â”‚
â”‚  6. Response                                                 â”‚
â”‚     â””â”€ { success: true, company: {...} }                    â”‚
â”‚                                                               â”‚
â”‚  Frontend                                                    â”‚
â”‚    â†“                                                         â”‚
â”‚  7. Success Handling                                         â”‚
â”‚     â”œâ”€ showToast('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success')                â”‚
â”‚     â””â”€ Refresh display                                      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ 9. ìˆ˜ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

### 9.1 ğŸ”´ ì¦‰ì‹œ ìˆ˜ì • (HIGH Priority)

- [ ] **employees.js Storage ë¶ˆì¼ì¹˜ ìˆ˜ì •**
  - [ ] Line 1102: `sessionStorage.getItem('token')` â†’ `localStorage.getItem('authToken')`
  - [ ] Line 1131: `sessionStorage.getItem('token')` â†’ `localStorage.getItem('authToken')`
  - [ ] í…ŒìŠ¤íŠ¸: ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥ ì •ìƒ ì‘ë™ í™•ì¸

### 9.2 ğŸŸ  ìš°ì„  ê°œì„  (MEDIUM Priority)

- [ ] **API URL ì¤‘ì•™í™”**
  - [ ] ApiManager.js: baseURL í•˜ë“œì½”ë”© â†’ GlobalConfig ì‚¬ìš©
  - [ ] presentation.js: í•˜ë“œì½”ë”© ì œê±° â†’ GlobalConfig ì‚¬ìš©
  - [ ] data_management.js: í•˜ë“œì½”ë”© ì œê±° â†’ GlobalConfig ì‚¬ìš©
  - [ ] Import ë¬¸ ì¶”ê°€: `import GlobalConfig from '...'`

- [ ] **í† í° í‚¤ ì´ë¦„ í‘œì¤€í™”**
  - [ ] ì „ì²´ ì½”ë“œë² ì´ìŠ¤ì—ì„œ `'token'` ê²€ìƒ‰
  - [ ] ëª¨ë‘ `'authToken'`ìœ¼ë¡œ í†µì¼
  - [ ] sessionStorage ì‚¬ìš©ì„ localStorageë¡œ ë³€ê²½ (authTokenë§Œ)

### 9.3 ğŸŸ¡ ì¥ê¸° ê°œì„  (LOW Priority)

- [ ] **ApiManager í™•ëŒ€ ì ìš©**
  - [ ] companies ë©”ì„œë“œ ì¶”ê°€
  - [ ] employees ë©”ì„œë“œ ì¶”ê°€
  - [ ] master data ë©”ì„œë“œ ì¶”ê°€
  - [ ] ê¸°ì¡´ Direct Fetchë¥¼ ApiManagerë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

- [ ] **Backend API ì‘ë‹µ êµ¬ì¡° í‘œì¤€í™”**
  - [ ] ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì¼ê´€ëœ ì‘ë‹µ í˜•ì‹ ì‚¬ìš©
  - [ ] Frontend íŒŒì‹± ë¡œì§ ë‹¨ì¼í™”
  - [ ] ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ í†µì¼

- [ ] **API Helper í•¨ìˆ˜ ìƒì„± (ëŒ€ì•ˆ)**
  - [ ] 15_api_helper.js ìƒì„±
  - [ ] apiRequest() í•¨ìˆ˜ êµ¬í˜„
  - [ ] ëª¨ë“  fetch í˜¸ì¶œì„ apiRequestë¡œ êµì²´

---

## ğŸ§ª 10. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 10.1 Storage ì¼ê´€ì„± í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥
```
1. ê´€ë¦¬ì ë¡œê·¸ì¸
   - í™•ì¸: localStorageì— 'authToken' ì €ì¥ë¨

2. ì§ì› ê´€ë¦¬ í˜ì´ì§€ ì ‘ì†
   - í™•ì¸: ì§ì› ëª©ë¡ ì •ìƒ ë¡œë“œ

3. ê±°ë˜ì²˜ ì´ê´€ ì‹œë„
   - ì‘ì—…: ì§ì› A â†’ ì§ì› Bë¡œ ê±°ë˜ì²˜ ì´ê´€
   - í™•ì¸: API í˜¸ì¶œ ì„±ê³µ (401 Unauthorized ë°œìƒí•˜ì§€ ì•ŠìŒ)
   - í™•ì¸: ê±°ë˜ì²˜ì˜ internalManager í•„ë“œ ë³€ê²½ë¨
   - í™•ì¸: Toast ë©”ì‹œì§€ "ì´ê´€ë˜ì—ˆìŠµë‹ˆë‹¤" í‘œì‹œ

4. ê²°ê³¼ í™•ì¸
   - í™•ì¸: ê±°ë˜ì²˜ ëª©ë¡ì—ì„œ ë‹´ë‹¹ì ë³€ê²½ ë°˜ì˜ë¨
   - í™•ì¸: ì§ì› Aì˜ ê±°ë˜ì²˜ ìˆ˜ ê°ì†Œ
   - í™•ì¸: ì§ì› Bì˜ ê±°ë˜ì²˜ ìˆ˜ ì¦ê°€
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ëª¨ë“  API í˜¸ì¶œ ì¸ì¦ í…ŒìŠ¤íŠ¸
```
1. ê° ì‚¬ì´ë“œ ë©”ë‰´ë³„ë¡œ ì ‘ì†
2. ë„¤íŠ¸ì›Œí¬ íƒ­ í™•ì¸
   - ëª¨ë“  API ìš”ì²­ì— Authorization í—¤ë” í¬í•¨ í™•ì¸
   - í—¤ë” í˜•ì‹: "Bearer [JWT_TOKEN]"
3. 401 Unauthorized ì—ëŸ¬ ì—†ìŒ í™•ì¸
```

### 10.2 API URL ì¼ê´€ì„± í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 3: í™˜ê²½ ë³€ê²½ ì‹œë®¬ë ˆì´ì…˜
```
1. GlobalConfigì˜ getApiBaseUrl() ìˆ˜ì •
   - í…ŒìŠ¤íŠ¸ URLë¡œ ë³€ê²½ (ì˜ˆ: http://test-server:3000)

2. ê° ëª¨ë“œë³„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
   - ì˜ì—…ë‹´ë‹¹ëª¨ë“œ: ë‹´ë‹¹ê±°ë˜ì²˜ê´€ë¦¬, ì‹¤ì ë³´ê³ ì„œ ì‘ì„±
   - ê´€ë¦¬ìëª¨ë“œ: ì „ì²´ê±°ë˜ì²˜ê´€ë¦¬, ì§ì› ê´€ë¦¬

3. ë„¤íŠ¸ì›Œí¬ íƒ­ í™•ì¸
   - ëª¨ë“  API ìš”ì²­ì´ í…ŒìŠ¤íŠ¸ URLë¡œ ì „ì†¡ë¨
   - í•˜ë“œì½”ë”©ëœ Railway URLë¡œ ìš”ì²­í•˜ëŠ” íŒŒì¼ ì—†ìŒ

4. GlobalConfig ì›ë³µ
   - ì •ìƒ Railway URLë¡œ ë³µêµ¬
   - ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ì‘ë™ í™•ì¸
```

### 10.3 ì–‘ë°©í–¥ ë°ì´í„° íë¦„ í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 4: ê±°ë˜ì²˜ CRUD ì „ì²´ í…ŒìŠ¤íŠ¸
```
[Create]
1. ì˜ì—…ë‹´ë‹¹ëª¨ë“œ â†’ ë‹´ë‹¹ê±°ë˜ì²˜ê´€ë¦¬
2. ìƒˆ ê±°ë˜ì²˜ ë“±ë¡
   - ì…ë ¥: ê±°ë˜ì²˜ëª…, ì‚¬ì—…ìë²ˆí˜¸, ì£¼ì†Œ ë“±
   - í™•ì¸: POST /api/companies í˜¸ì¶œ
   - í™•ì¸: Databaseì— ì €ì¥ë¨
   - í™•ì¸: ê±°ë˜ì²˜ ëª©ë¡ì— í‘œì‹œë¨

[Read]
3. ê±°ë˜ì²˜ ëª©ë¡ ì¡°íšŒ
   - í™•ì¸: GET /api/companies/manager/{name} í˜¸ì¶œ
   - í™•ì¸: ë³¸ì¸ ë‹´ë‹¹ ê±°ë˜ì²˜ë§Œ í‘œì‹œë¨

[Update]
4. ê±°ë˜ì²˜ ì •ë³´ ìˆ˜ì •
   - ìˆ˜ì •: ì „í™”ë²ˆí˜¸, ì£¼ì†Œ ë³€ê²½
   - í™•ì¸: PUT /api/companies/{id} í˜¸ì¶œ
   - í™•ì¸: Database ì—…ë°ì´íŠ¸ ë°˜ì˜
   - í™•ì¸: ë³€ê²½ ë‚´ì—­ í‘œì‹œë¨

[Read Again]
5. ê´€ë¦¬ìëª¨ë“œ â†’ ì „ì²´ê±°ë˜ì²˜ê´€ë¦¬
   - í™•ì¸: GET /api/companies?limit=10000 í˜¸ì¶œ
   - í™•ì¸: ë°©ê¸ˆ ë“±ë¡/ìˆ˜ì •í•œ ê±°ë˜ì²˜ í‘œì‹œë¨
   - í™•ì¸: ëª¨ë“  ê±°ë˜ì²˜ ì¡°íšŒ ê°€ëŠ¥

[Update by Admin]
6. ê´€ë¦¬ìê°€ ê±°ë˜ì²˜ ë‹´ë‹¹ì ë³€ê²½
   - í™•ì¸: PUT /api/companies/{id} í˜¸ì¶œ
   - í™•ì¸: internalManager í•„ë“œ ì—…ë°ì´íŠ¸
   - í™•ì¸: ì˜ì—…ë‹´ë‹¹ í™”ë©´ì—ì„œ ì‚¬ë¼ì§ (ë‹´ë‹¹ ë³€ê²½ë¨)
```

#### ì‹œë‚˜ë¦¬ì˜¤ 5: ì‹¤ì ë³´ê³ ì„œ íë¦„ í…ŒìŠ¤íŠ¸
```
[Create]
1. ì˜ì—…ë‹´ë‹¹ëª¨ë“œ â†’ ì‹¤ì ë³´ê³ ì„œ ì‘ì„±
2. ë³´ê³ ì„œ ì‘ì„±
   - ì…ë ¥: ë°©ë¬¸ì¼, ê±°ë˜ì²˜, ë°©ë¬¸ëª©ì , ë‚´ìš© ë“±
   - í™•ì¸: ApiManager.createReport() í˜¸ì¶œ
   - í™•ì¸: POST /api/reports ì „ì†¡
   - í™•ì¸: Database ì €ì¥

[Read by Writer]
3. ì‹¤ì ë³´ê³ ì„œ í™•ì¸
   - í™•ì¸: ApiManager.getReports({ submittedBy: name }) í˜¸ì¶œ
   - í™•ì¸: GET /api/reports?submittedBy={name}
   - í™•ì¸: ë³¸ì¸ ì‘ì„± ë³´ê³ ì„œë§Œ í‘œì‹œ

[Update]
4. ë³´ê³ ì„œ ìˆ˜ì •
   - ìˆ˜ì •: ë°©ë¬¸ë‚´ìš©, ë§¤ì¶œê¸ˆì•¡ ë³€ê²½
   - í™•ì¸: ApiManager.updateReport(id, data) í˜¸ì¶œ
   - í™•ì¸: PUT /api/reports/{id}
   - í™•ì¸: ë³€ê²½ì‚¬í•­ ë°˜ì˜

[Read by Admin]
5. ê´€ë¦¬ìëª¨ë“œ â†’ ì‹¤ì ë³´ê³ ì„œ í™•ì¸
   - í™•ì¸: ëª¨ë“  ì§ì›ì˜ ë³´ê³ ì„œ ì¡°íšŒ
   - í™•ì¸: GET /api/reports (ì „ì²´)

[Update by Admin]
6. ê´€ë¦¬ì í”¼ë“œë°± ì‘ì„±
   - ì…ë ¥: ê´€ë¦¬ì ì˜ê²¬ ì¶”ê°€
   - í™•ì¸: PUT /api/reports/{id}
   - í™•ì¸: feedback í•„ë“œ ì—…ë°ì´íŠ¸

[Read Feedback]
7. ì˜ì—…ë‹´ë‹¹ëª¨ë“œ â†’ ê´€ë¦¬ìì˜ê²¬ í™•ì¸
   - í™•ì¸: ApiManager.getReports({ employeeName: name })
   - í™•ì¸: í”¼ë“œë°±ì´ ìˆëŠ” ë³´ê³ ì„œ í‘œì‹œ
```

---

## ğŸ“ˆ 11. ì„±ëŠ¥ ë° íš¨ìœ¨ì„± ë¶„ì„

### 11.1 API í˜¸ì¶œ ë¹ˆë„

**ì˜ì—…ë‹´ë‹¹ëª¨ë“œ í‰ê·  API í˜¸ì¶œ**:
- Dashboard ì§„ì…: 0íšŒ (IndexedDBë§Œ ì‚¬ìš©)
- ë‹´ë‹¹ê±°ë˜ì²˜ê´€ë¦¬: 5íšŒ (master data + companies)
- ì‹¤ì ë³´ê³ ì„œ ì‘ì„±: 1íšŒ (submit ì‹œ)
- ì‹¤ì ë³´ê³ ì„œ í™•ì¸: 1íšŒ (page load ì‹œ)
- ê´€ë¦¬ìì˜ê²¬ í™•ì¸: 1íšŒ (page load ì‹œ)
- ì‹œìŠ¤í…œì„¤ì •: 2íšŒ (page load + departments)

**ê´€ë¦¬ìëª¨ë“œ í‰ê·  API í˜¸ì¶œ**:
- Dashboard ì§„ì…: 0íšŒ (IndexedDBë§Œ ì‚¬ìš©)
- ì „ì²´ê±°ë˜ì²˜ê´€ë¦¬: 6íšŒ (master data + companies + employees)
- ì‹¤ì ë³´ê³ ì„œ í™•ì¸: 1íšŒ (ì „ì²´ reports)
- ì‹¤ì í˜„í™©íŒ: ë‹¤ìˆ˜ (ì‹¤ì  ë°ì´í„°)
- ë°ì´í„° ê´€ë¦¬: 1íšŒ (companies for backup)
- ì§ì› ê´€ë¦¬: 3íšŒ (departments + employees + companies)
- ì‹œìŠ¤í…œì„¤ì •: 2íšŒ (ë™ì¼)
- ì—‘ì…€ ì—…ë¡œë“œ: 0íšŒ (IndexedDBë§Œ)

### 11.2 ëŒ€ëŸ‰ ë°ì´í„° ì¡°íšŒ ë¶„ì„

**âš ï¸ ì ì¬ì  ì„±ëŠ¥ ë¬¸ì œ**:

```javascript
// Admin Mode - all_companies.js:275
`${GlobalConfig.API_BASE_URL}/api/companies?limit=10000`

// Admin Mode - employees.js:116
`${GlobalConfig.API_BASE_URL}/api/employees?limit=9999`

// Admin Mode - data_management.js:79
`${API_BASE_URL}/companies?limit=9999`
```

**ë¬¸ì œì **:
- í•œ ë²ˆì— ìµœëŒ€ 10,000ê°œ ë ˆì½”ë“œ ì¡°íšŒ
- ë„¤íŠ¸ì›Œí¬ ì „ì†¡ ì‹œê°„ ì¦ê°€
- ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ ì‚¬ìš© ì¦ê°€
- ì´ˆê¸° ë¡œë”© ì‹œê°„ ì§€ì—°

**ê¶Œì¥ ê°œì„ **:
1. **Pagination (í˜ì´ì§€ë„¤ì´ì…˜)**
   ```javascript
   // ì˜ˆì‹œ
   GET /api/companies?page=1&limit=50
   GET /api/companies?page=2&limit=50
   ```

2. **Lazy Loading (ì§€ì—° ë¡œë”©)**
   - ìŠ¤í¬ë¡¤ ì‹œ ì¶”ê°€ ë°ì´í„° ë¡œë“œ
   - ì´ˆê¸°ì—ëŠ” 50-100ê°œë§Œ ë¡œë“œ

3. **Server-Side Search (ì„œë²„ ì¸¡ ê²€ìƒ‰)**
   ```javascript
   GET /api/companies?search=keyword&limit=50
   ```

4. **IndexedDB í™œìš© ê°•í™”**
   - ì „ì²´ ë°ì´í„°ë¥¼ IndexedDBì— ìºì‹±
   - ì£¼ê¸°ì ìœ¼ë¡œ ë™ê¸°í™”
   - ë¡œì»¬ì—ì„œ í•„í„°ë§/ì •ë ¬

### 11.3 IndexedDB vs Backend API ì‚¬ìš© ë¹„ìœ¨

| ê¸°ëŠ¥ | IndexedDB | Backend API | ê¶Œì¥ |
|------|-----------|-------------|------|
| Dashboard | 100% | 0% | âœ… ìµœì  |
| ê±°ë˜ì²˜ ì¡°íšŒ | 0% | 100% | âš ï¸ ìºì‹± ê¶Œì¥ |
| ì‹¤ì ë³´ê³ ì„œ ì¡°íšŒ | 0% | 100% | âœ… ì ì ˆ |
| ì—‘ì…€ ì—…ë¡œë“œ | 100% | 0% | âœ… ìµœì  |
| ì‹œìŠ¤í…œì„¤ì • | 20% | 80% | âœ… ì ì ˆ |

**ê°œì„  ì œì•ˆ**:
- ê±°ë˜ì²˜ ë°ì´í„°ë¥¼ IndexedDBì— ìºì‹±
- 30ë¶„ë§ˆë‹¤ ë˜ëŠ” CRUD ì‘ì—… ì‹œ ë™ê¸°í™”
- ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ ê°ì†Œ

---

## ğŸ”’ 12. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 12.1 í† í° ì €ì¥ ë³´ì•ˆ

**í˜„ì¬ ë°©ì‹**:
```javascript
localStorage.setItem('authToken', token);  // ì˜êµ¬ ì €ì¥
```

**ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**:
- âœ… XSS ê³µê²©ì— ì·¨ì•½ (í•˜ì§€ë§Œ JWT í† í°ì€ ì¼ë°˜ì ìœ¼ë¡œ localStorage ì‚¬ìš©)
- âœ… HTTPS ì‚¬ìš© ì‹œ ì•ˆì „
- âœ… HttpOnly ì¿ í‚¤ë³´ë‹¤ëŠ” ëœ ì•ˆì „í•˜ì§€ë§Œ, SPAì—ì„œ ì¼ë°˜ì ì¸ íŒ¨í„´

**ê¶Œì¥ ë³´ì•ˆ ê°•í™”**:
1. **Token Expiration (í† í° ë§Œë£Œ)**
   - JWTì— ì§§ì€ ë§Œë£Œ ì‹œê°„ ì„¤ì • (ì˜ˆ: 1ì‹œê°„)
   - Refresh token êµ¬í˜„

2. **Token Rotation (í† í° íšŒì „)**
   - ì •ê¸°ì ìœ¼ë¡œ í† í° ê°±ì‹ 
   - ì´ì „ í† í° ë¬´íš¨í™”

3. **XSS ë°©ì–´**
   - Content Security Policy (CSP) ì„¤ì •
   - ì…ë ¥ sanitization
   - ìœ„í—˜í•œ DOM ì¡°ì‘ ì œê±°

### 12.2 API ìš”ì²­ ë³´ì•ˆ

**í˜„ì¬ êµ¬í˜„**:
```javascript
headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
}
```

**ê¶Œì¥ ì¶”ê°€ ë³´ì•ˆ**:
1. **CORS ì„¤ì • í™•ì¸**
   - Backendì—ì„œ í—ˆìš©ëœ originë§Œ ì ‘ê·¼
   - ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ë³„ ì„¤ì •

2. **Rate Limiting**
   - API í˜¸ì¶œ ë¹ˆë„ ì œí•œ
   - DDoS ê³µê²© ë°©ì–´

3. **Input Validation**
   - Frontendì—ì„œ 1ì°¨ ê²€ì¦
   - Backendì—ì„œ 2ì°¨ ê²€ì¦ (í•„ìˆ˜)

### 12.3 ë¯¼ê° ì •ë³´ ì²˜ë¦¬

**í˜„ì¬ ì €ì¥ë˜ëŠ” ë¯¼ê° ì •ë³´**:
- authToken (localStorage)
- user ê°ì²´ (sessionStorage)
  - name, email, role, department ë“±

**ê¶Œì¥ ì‚¬í•­**:
- âœ… ë¹„ë°€ë²ˆí˜¸ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ (í˜„ì¬ êµ¬í˜„ OK)
- âš ï¸ ì‚¬ìš©ì ì •ë³´ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥ (ì„ íƒì  ê°•í™”)
- âœ… sessionStorage ì‚¬ìš©ìœ¼ë¡œ íƒ­ ì¢…ë£Œ ì‹œ ìë™ ì‚­ì œ

---

## ğŸ¯ 13. ë°ì´í„° ê´€ë¦¬ ì „ëµ ë° ì •ì±…

### 13.1 ë‹¨ì¼ Source of Truth (SSOT) ëª…ì‹œ

#### 13.1.1 ë°ì´í„° ì†ŒìŠ¤ ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ğŸ† Single Source of Truth                    â”‚
â”‚              Railway MySQL Database (Production)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Tables:                                                     â”‚
â”‚  â€¢ companies      (ê±°ë˜ì²˜ ë§ˆìŠ¤í„°)        PRIMARY SOURCE     â”‚
â”‚  â€¢ employees      (ì§ì› ë§ˆìŠ¤í„°)          PRIMARY SOURCE     â”‚
â”‚  â€¢ reports        (ì‹¤ì ë³´ê³ ì„œ)           PRIMARY SOURCE     â”‚
â”‚  â€¢ master_*       (ë§ˆìŠ¤í„° ë°ì´í„°)        PRIMARY SOURCE     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ REST API (READ/WRITE)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ“¦ Backend API Layer (Express.js)               â”‚
â”‚                    Data Access & Business Logic              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Authentication & Authorization                            â”‚
â”‚  â€¢ Data Validation & Transformation                          â”‚
â”‚  â€¢ CRUD Operations                                           â”‚
â”‚  â€¢ Response Normalization                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTPS/JSON
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ’¾ Frontend Cache Layers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Layer 1: Memory Cache (KPICache)       TTL: 5ë¶„            â”‚
â”‚  â””â”€ ìš©ë„: KPI ê³„ì‚° ê²°ê³¼ ìºì‹±                                â”‚
â”‚  â””â”€ ì •ì±…: LRU ì¶•ì¶œ, ìµœëŒ€ 100ê°œ í•­ëª©                         â”‚
â”‚  â””â”€ ë¬´íš¨í™”: CRUD ì‘ì—… ì‹œ ìë™                               â”‚
â”‚                                                               â”‚
â”‚  Layer 2: localStorage (Persistent)     TTL: ë¬´ì œí•œ         â”‚
â”‚  â””â”€ ìš©ë„: ì¸ì¦ í† í°, ì„¤ì •, ë°±ì—… íˆìŠ¤í† ë¦¬                    â”‚
â”‚  â””â”€ ì •ì±…: ë¸Œë¼ìš°ì € ì¢…ë£Œ í›„ì—ë„ ìœ ì§€                         â”‚
â”‚  â””â”€ ë¬´íš¨í™”: ëª…ì‹œì  ì‚­ì œ ë˜ëŠ” ë¡œê·¸ì•„ì›ƒ                       â”‚
â”‚                                                               â”‚
â”‚  Layer 3: sessionStorage (Session)      TTL: ì„¸ì…˜ ì¢…ë£Œ ì‹œ   â”‚
â”‚  â””â”€ ìš©ë„: ì‚¬ìš©ì ì •ë³´, ì„ì‹œ ìƒíƒœ                            â”‚
â”‚  â””â”€ ì •ì±…: íƒ­ ë‹«ìœ¼ë©´ ìë™ ì‚­ì œ                               â”‚
â”‚  â””â”€ ë¬´íš¨í™”: ì„¸ì…˜ ì¢…ë£Œ ì‹œ                                    â”‚
â”‚                                                               â”‚
â”‚  Layer 4: IndexedDB (Local Database)    TTL: ìˆ˜ë™ ê´€ë¦¬      â”‚
â”‚  â””â”€ ìš©ë„: ê±°ë˜ì²˜/ë³´ê³ ì„œ ëŒ€ëŸ‰ ë°ì´í„°                         â”‚
â”‚  â””â”€ ì •ì±…: ì—‘ì…€ ì—…ë¡œë“œ, ë°±ì—…/ë³µì›                            â”‚
â”‚  â””â”€ ë¬´íš¨í™”: ë°±ì—… ìƒì„± ì‹œ ë˜ëŠ” ìˆ˜ë™                          â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 13.1.2 ë°ì´í„° ì†ŒìŠ¤ë³„ ì—­í• 

| ì†ŒìŠ¤ | ì—­í•  | ì½ê¸° ë¹ˆë„ | ì“°ê¸° ë¹ˆë„ | ì¼ê´€ì„± ë³´ì¥ |
|------|------|----------|----------|------------|
| **Railway DB** | Primary Source | API ìš”ì²­ ì‹œ | CRUD ì‘ì—… ì‹œ | âœ… Strong Consistency |
| **Backend API** | Access Layer | ëª¨ë“  ì½ê¸° | ëª¨ë“  ì“°ê¸° | âœ… Transactional |
| **Memory Cache** | Hot Data | ì´ˆë‹¹ ìˆ˜íšŒ | 5ë¶„ë§ˆë‹¤ | âš ï¸ Eventually Consistent |
| **localStorage** | Auth & Config | í˜ì´ì§€ ë¡œë“œ ì‹œ | ë¡œê·¸ì¸/ì„¤ì • ë³€ê²½ | âœ… Client-Side Persistent |
| **sessionStorage** | Temp Data | í˜ì´ì§€ ë¡œë“œ ì‹œ | ì„¸ì…˜ ì¤‘ | âš ï¸ Session-Scoped |
| **IndexedDB** | Bulk Data | í˜ì´ì§€ ë¡œë“œ ì‹œ | ì—‘ì…€ ì—…ë¡œë“œ ì‹œ | âš ï¸ Manual Sync |

#### 13.1.3 ë°ì´í„° ì¶©ëŒ í•´ê²° ê·œì¹™

**ìš°ì„ ìˆœìœ„ (ë†’ìŒ â†’ ë‚®ìŒ)**:
1. ğŸ† **Railway Database** - Always wins (Primary Source)
2. ğŸ“¦ **Backend API Response** - Authoritative
3. ğŸ’¾ **Memory Cache** - Short-lived, invalidate on conflict
4. ğŸ’¾ **localStorage** - User-specific settings
5. ğŸ’¾ **sessionStorage** - Temporary state
6. ğŸ’¾ **IndexedDB** - Bulk cache, sync required

**ì¶©ëŒ ì‹œë‚˜ë¦¬ì˜¤**:
```javascript
// ì‹œë‚˜ë¦¬ì˜¤ 1: Cache vs API ì¶©ëŒ
if (cachedData && !isStale(cachedData)) {
    return cachedData;  // ìºì‹œ ìš°ì„  (TTL ë‚´)
} else {
    const freshData = await apiManager.get(endpoint);
    cache.set(key, freshData);  // API ë°ì´í„°ë¡œ ê°±ì‹ 
    return freshData;
}

// ì‹œë‚˜ë¦¬ì˜¤ 2: IndexedDB vs Backend ì¶©ëŒ
const localData = await indexedDB.get(key);
const remoteData = await apiManager.get(endpoint);

if (localData.lastModified < remoteData.lastModified) {
    await indexedDB.update(key, remoteData);  // Backend ìš°ì„ 
    return remoteData;
}
```

---

### 13.2 ë°ì´í„° ìˆ˜ëª…ì£¼ê¸° (Data Lifecycle)

#### 13.2.1 ì „ì²´ ìˆ˜ëª…ì£¼ê¸° ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ë°ì´í„° ìˆ˜ëª…ì£¼ê¸°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ LOAD (ë°ì´í„° ë¡œë“œ)
   â”œâ”€ API Request â†’ Backend
   â”œâ”€ Database Query
   â””â”€ Response with Raw Data

2ï¸âƒ£ NORMALIZE (ë°ì´í„° ì •ê·œí™”)
   â”œâ”€ Field Mapping (DB â†’ Frontend)
   â”‚   â€¢ businessStatus â†’ ê±°ë˜ìƒíƒœ
   â”‚   â€¢ accumulatedSales â†’ ëˆ„ì ë§¤ì¶œê¸ˆì•¡
   â”œâ”€ Type Conversion
   â”‚   â€¢ String â†’ Number (ê¸ˆì•¡)
   â”‚   â€¢ String â†’ Date (ë‚ ì§œ)
   â””â”€ Validation & Sanitization

3ï¸âƒ£ CACHE (ìºì‹±)
   â”œâ”€ Memory Cache (KPICache)
   â”‚   â””â”€ withCache(type, calculateFn, userId)
   â”œâ”€ localStorage (ì„¤ì •/í† í°)
   â”‚   â””â”€ localStorage.setItem('authToken', token)
   â””â”€ IndexedDB (ëŒ€ëŸ‰ ë°ì´í„°)
       â””â”€ db.transaction(['companies']).put(data)

4ï¸âƒ£ RENDER (ë Œë”ë§)
   â”œâ”€ UI Update
   â”‚   â””â”€ document.querySelector(selector).innerHTML = html
   â”œâ”€ Table Rendering
   â”‚   â””â”€ companies.map(c => renderRow(c))
   â””â”€ Chart Rendering
       â””â”€ new Chart(ctx, config)

5ï¸âƒ£ MUTATE (ë°ì´í„° ë³€ê²½)
   â”œâ”€ User Input
   â”‚   â””â”€ form.addEventListener('submit', handleSubmit)
   â”œâ”€ Validation
   â”‚   â””â”€ if (!validateEmail(email)) return
   â””â”€ API Call
       â””â”€ await apiManager.put(\`/companies/\${id}\`, data)

6ï¸âƒ£ SYNC (ë™ê¸°í™”)
   â”œâ”€ Backend Update
   â”‚   â””â”€ UPDATE companies SET ... WHERE id = ?
   â”œâ”€ Cache Invalidation
   â”‚   â””â”€ kpiCache.clear('sales_kpi_*')
   â””â”€ UI Refresh
       â””â”€ loadCompanyList()

7ï¸âƒ£ INVALIDATE (ìºì‹œ ë¬´íš¨í™”)
   â”œâ”€ TTL Expiration (ì‹œê°„ ê¸°ë°˜)
   â”‚   â””â”€ if (age > this.TTL) cache.delete(key)
   â”œâ”€ Manual Invalidation (ì‘ì—… ê¸°ë°˜)
   â”‚   â””â”€ invalidateKPICache()
   â””â”€ Pattern-based (íŒ¨í„´ ë§¤ì¹­)
       â””â”€ clearByPattern('sales_*')
```

#### 13.2.2 ìˆ˜ëª…ì£¼ê¸° ë‹¨ê³„ë³„ ìƒì„¸

**1ï¸âƒ£ LOAD Phase (ë°ì´í„° ë¡œë“œ)**
```javascript
// ì˜ˆì‹œ: ê±°ë˜ì²˜ ëª©ë¡ ë¡œë“œ
async function loadCompanies() {
    const response = await fetch(`${GlobalConfig.API_BASE_URL}/api/companies?limit=10000`, {
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
        }
    });

    const rawData = await response.json();  // Raw API Response
    return rawData.companies;  // Array<Company>
}
```

**2ï¸âƒ£ NORMALIZE Phase (ë°ì´í„° ì •ê·œí™”)**
```javascript
// ì˜ˆì‹œ: DB í•„ë“œ â†’ Frontend í•„ë“œ ë§¤í•‘
function normalizeCompany(rawCompany) {
    return {
        // ì›ë³¸ í•„ë“œ ìœ ì§€
        ...rawCompany,

        // í•œê¸€ í•„ë“œ ë§¤í•‘
        ê±°ë˜ìƒíƒœ: rawCompany.businessStatus,
        ëˆ„ì ë§¤ì¶œê¸ˆì•¡: Number(rawCompany.accumulatedSales) || 0,
        ëˆ„ì ìˆ˜ê¸ˆê¸ˆì•¡: Number(rawCompany.accumulatedCollection) || 0,
        ë§¤ì¶œì±„ê¶Œì”ì•¡: Number(rawCompany.accountsReceivable) || 0,
        ê±°ë˜ì²˜ëª…: rawCompany.finalCompanyName || rawCompany.companyNameERP,

        // ê³„ì‚°ëœ í•„ë“œ
        ìˆ˜ê¸ˆë¥ : calculateCollectionRate(rawCompany),
        ê±°ë˜ê¸°ê°„: calculateBusinessPeriod(rawCompany.createdAt)
    };
}
```

**3ï¸âƒ£ CACHE Phase (ìºì‹±)**
```javascript
// KPICache ì‚¬ìš© (ì‹¤ì œ êµ¬í˜„: 05.kpi/05_cache.js)
export async function getSalesKPIWithCache(userId) {
    return await withCache('sales_kpi',
        () => calculateSalesKPI(userId),  // ê³„ì‚° í•¨ìˆ˜
        userId  // ìºì‹œ í‚¤ì— í¬í•¨
    );
    // TTL: 5ë¶„
    // LRU ì¶•ì¶œ: ìµœëŒ€ 100ê°œ
}
```

**4ï¸âƒ£ RENDER Phase (ë Œë”ë§)**
```javascript
// ì˜ˆì‹œ: í…Œì´ë¸” ë Œë”ë§
function renderCompanyTable(companies) {
    const tbody = document.querySelector('#companyTable tbody');
    tbody.innerHTML = companies.map(company => `
        <tr>
            <td>${company.ê±°ë˜ì²˜ëª…}</td>
            <td>${formatCurrency(company.ëˆ„ì ë§¤ì¶œê¸ˆì•¡)}</td>
            <td>${company.ê±°ë˜ìƒíƒœ}</td>
        </tr>
    `).join('');
}
```

**5ï¸âƒ£ MUTATE Phase (ë°ì´í„° ë³€ê²½)**
```javascript
// ì˜ˆì‹œ: ê±°ë˜ì²˜ ì •ë³´ ìˆ˜ì •
async function updateCompany(id, updates) {
    // 1. í´ë¼ì´ì–¸íŠ¸ ê²€ì¦
    if (!validateCompanyData(updates)) {
        showToast('ì…ë ¥ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
        return;
    }

    // 2. API ìš”ì²­
    const response = await fetch(`${GlobalConfig.API_BASE_URL}/api/companies/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`
        },
        body: JSON.stringify(updates)
    });

    // 3. ì‘ë‹µ ì²˜ë¦¬
    if (response.ok) {
        const updated = await response.json();
        return updated;
    }
}
```

**6ï¸âƒ£ SYNC Phase (ë™ê¸°í™”)**
```javascript
// ì˜ˆì‹œ: ë°ì´í„° ë³€ê²½ í›„ ë™ê¸°í™”
async function saveCompanyAndSync(id, data) {
    // 1. Backend ì—…ë°ì´íŠ¸
    await updateCompany(id, data);

    // 2. ìºì‹œ ë¬´íš¨í™”
    kpiCache.clear('sales_kpi_*');  // ì˜ì—… KPI ìºì‹œ ì‚­ì œ
    kpiCache.clear('admin_kpi');    // ê´€ë¦¬ì KPI ìºì‹œ ì‚­ì œ

    // 3. UI ìƒˆë¡œê³ ì¹¨
    await loadCompanyList();  // ìµœì‹  ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ

    // 4. IndexedDB ë™ê¸°í™” (í•„ìš” ì‹œ)
    const freshData = await apiManager.getCompanies();
    await syncToIndexedDB(freshData);
}
```

**7ï¸âƒ£ INVALIDATE Phase (ìºì‹œ ë¬´íš¨í™”)**
```javascript
// ì‹¤ì œ êµ¬í˜„: 05.kpi/05_cache.js

// TTL ê¸°ë°˜ ìë™ ë¬´íš¨í™”
class KPICache {
    get(type, userId = null) {
        const cached = this.cache.get(key);
        const age = Date.now() - cached.timestamp;

        if (age > this.TTL) {  // 5ë¶„ ì´ˆê³¼
            this.cache.delete(key);
            return null;  // ìºì‹œ ë§Œë£Œ
        }

        return cached.data;
    }
}

// ìˆ˜ë™ ë¬´íš¨í™”
export function invalidateKPICache() {
    kpiCache.clear();  // ì „ì²´ ì‚­ì œ
}

export function invalidateUserKPICache(userId) {
    kpiCache.clearByPattern(`.*_${userId}`);  // íŒ¨í„´ ê¸°ë°˜ ì‚­ì œ
}
```

---

### 13.3 í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê³„ì¸µ ì •ì˜

#### 13.3.1 ìƒíƒœ ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê³„ì¸µ (3-Layer Architecture)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Layer 1: Local State (ë¡œì»¬ ìƒíƒœ)                           â”‚
â”‚  â”œâ”€ ì •ì˜: ì»´í¬ë„ŒíŠ¸/í˜ì´ì§€ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” UI ìƒíƒœ       â”‚
â”‚  â”œâ”€ ì €ì¥ì†Œ: JavaScript ë³€ìˆ˜, DOM ìƒíƒœ                       â”‚
â”‚  â”œâ”€ ìˆ˜ëª…: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”                         â”‚
â”‚  â””â”€ ì˜ˆì‹œ:                                                    â”‚
â”‚      â€¢ ëª¨ë‹¬ ì—´ë¦¼/ë‹«í˜ ìƒíƒœ                                   â”‚
â”‚      â€¢ í•„í„°ë§/ì •ë ¬ ì¡°ê±´                                      â”‚
â”‚      â€¢ ì„ íƒëœ í–‰/í•­ëª©                                        â”‚
â”‚      â€¢ í¼ ì…ë ¥ ê°’                                            â”‚
â”‚                                                               â”‚
â”‚  Layer 2: Derived State (íŒŒìƒ ìƒíƒœ)                         â”‚
â”‚  â”œâ”€ ì •ì˜: ë‹¤ë¥¸ ìƒíƒœë¡œë¶€í„° ê³„ì‚°ëœ ì½ê¸° ì „ìš© ìƒíƒœ              â”‚
â”‚  â”œâ”€ ì €ì¥ì†Œ: ì‹¤ì‹œê°„ ê³„ì‚° (ë©”ëª¨ì´ì œì´ì…˜ ì„ íƒì )               â”‚
â”‚  â”œâ”€ ìˆ˜ëª…: ì›ë³¸ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ì¬ê³„ì‚°                   â”‚
â”‚  â””â”€ ì˜ˆì‹œ:                                                    â”‚
â”‚      â€¢ ì´ ë§¤ì¶œì•¡ (companies ë°°ì—´ë¡œë¶€í„° ê³„ì‚°)                â”‚
â”‚      â€¢ ìˆ˜ê¸ˆë¥  (ëˆ„ì ë§¤ì¶œ / ëˆ„ì ìˆ˜ê¸ˆ)                         â”‚
â”‚      â€¢ í•„í„°ë§ëœ ëª©ë¡ (ì›ë³¸ + í•„í„° ì¡°ê±´)                     â”‚
â”‚      â€¢ KPI ì§€í‘œ (ë³µìˆ˜ ë°ì´í„° ì†ŒìŠ¤ ì§‘ê³„)                     â”‚
â”‚                                                               â”‚
â”‚  Layer 3: Remote Shadow (ì›ê²© ë°ì´í„° ì„€ë„ìš°)                â”‚
â”‚  â”œâ”€ ì •ì˜: Backend ë°ì´í„°ì˜ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ìºì‹œ           â”‚
â”‚  â”œâ”€ ì €ì¥ì†Œ: Memory, localStorage, sessionStorage, IndexedDB â”‚
â”‚  â”œâ”€ ìˆ˜ëª…: TTL ë˜ëŠ” ëª…ì‹œì  ë¬´íš¨í™”                            â”‚
â”‚  â””â”€ ì˜ˆì‹œ:                                                    â”‚
â”‚      â€¢ ê±°ë˜ì²˜ ëª©ë¡ ìºì‹œ (IndexedDB)                         â”‚
â”‚      â€¢ KPI ê³„ì‚° ê²°ê³¼ (Memory Cache, TTL: 5ë¶„)              â”‚
â”‚      â€¢ ì‚¬ìš©ì ì •ë³´ (sessionStorage, ì„¸ì…˜ ë™ì•ˆ)              â”‚
â”‚      â€¢ ì¸ì¦ í† í° (localStorage, ì˜êµ¬)                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 13.3.2 ìƒíƒœ ê³„ì¸µë³„ ì½”ë“œ ì˜ˆì‹œ

**Layer 1: Local State**
```javascript
// ì˜ˆì‹œ: ë‹´ë‹¹ê±°ë˜ì²˜ê´€ë¦¬ í˜ì´ì§€ (my-companies.js)
let state = {
    // UI ìƒíƒœ
    selectedCompany: null,
    isModalOpen: false,
    currentFilter: 'all',
    sortColumn: 'companyName',
    sortDirection: 'asc',

    // í˜ì´ì§€ë„¤ì´ì…˜
    currentPage: 1,
    itemsPerPage: 20,

    // ê²€ìƒ‰
    searchKeyword: '',

    // í¼
    formErrors: {}
};

// ìƒíƒœ ë³€ê²½ í•¨ìˆ˜
function selectCompany(company) {
    state.selectedCompany = company;
    renderCompanyDetail(company);
}

function toggleModal() {
    state.isModalOpen = !state.isModalOpen;
    updateModalDisplay();
}
```

**Layer 2: Derived State**
```javascript
// ì˜ˆì‹œ: KPI ê³„ì‚° (derived from companies data)
function calculateDerivedKPIs(companies) {
    return {
        // ì´ ê±°ë˜ì²˜ ìˆ˜
        totalCompanies: companies.length,

        // í™œì„± ê±°ë˜ì²˜ ìˆ˜
        activeCompanies: companies.filter(c => c.businessStatus === 'í™œì„±').length,

        // ì´ ë§¤ì¶œì•¡
        totalSales: companies.reduce((sum, c) => sum + (Number(c.accumulatedSales) || 0), 0),

        // ì´ ìˆ˜ê¸ˆì•¡
        totalCollection: companies.reduce((sum, c) => sum + (Number(c.accumulatedCollection) || 0), 0),

        // í‰ê·  ìˆ˜ê¸ˆë¥ 
        avgCollectionRate: (() => {
            const rates = companies
                .map(c => calculateCollectionRate(c))
                .filter(r => !isNaN(r));
            return rates.length > 0 ?
                rates.reduce((a, b) => a + b) / rates.length : 0;
        })(),

        // ì£¼ìš” ì œí’ˆë³„ ê±°ë˜ì²˜ ìˆ˜
        mainProductCounts: countByMainProduct(companies)
    };
}

// íŒŒìƒ ìƒíƒœëŠ” ì›ë³¸ ë°ì´í„° ë³€ê²½ ì‹œ ìë™ ì¬ê³„ì‚°
function updateCompaniesAndRecalculate(newCompanies) {
    state.companies = newCompanies;  // Layer 3 (Remote Shadow)
    state.kpi = calculateDerivedKPIs(newCompanies);  // Layer 2 (Derived)
    renderDashboard(state.kpi);  // UI Update
}
```

**Layer 3: Remote Shadow**
```javascript
// ì˜ˆì‹œ 1: Memory Cache (KPICache)
export async function getSalesKPIWithCache(userId) {
    // 1. ìºì‹œ í™•ì¸ (Remote Shadow)
    const cached = kpiCache.get('sales_kpi', userId);
    if (cached) {
        console.log('[Remote Shadow] ìºì‹œ íˆíŠ¸');
        return cached;  // Layer 3ì—ì„œ ë°˜í™˜
    }

    // 2. Backendì—ì„œ ì¡°íšŒ (Primary Source)
    const freshData = await calculateSalesKPI(userId);

    // 3. ìºì‹œì— ì €ì¥ (Remote Shadow ì—…ë°ì´íŠ¸)
    kpiCache.set('sales_kpi', freshData, userId);

    return freshData;
}

// ì˜ˆì‹œ 2: IndexedDB Cache
async function loadCompaniesFromCache() {
    const db = await getDB();
    const tx = db.transaction(['companies'], 'readonly');
    const store = tx.objectStore('companies');
    const companies = await store.getAll();

    console.log('[Remote Shadow] IndexedDBì—ì„œ ë¡œë“œ:', companies.length);
    return companies;  // Layer 3
}

// ì˜ˆì‹œ 3: localStorage (User Settings)
function getUserSettings() {
    const settings = localStorage.getItem('userSettings');
    return settings ? JSON.parse(settings) : defaultSettings;  // Layer 3
}
```

#### 13.3.3 ìƒíƒœ ë™ê¸°í™” ê·œì¹™

```javascript
// ê·œì¹™ 1: Local State â†’ Remote Shadow (ì“°ê¸°)
async function saveCompanyEdit(updates) {
    // 1. Local State ì—…ë°ì´íŠ¸ (Optimistic UI)
    const oldValue = state.selectedCompany;
    state.selectedCompany = { ...oldValue, ...updates };
    renderCompanyDetail(state.selectedCompany);

    try {
        // 2. Remote (Backend) ì—…ë°ì´íŠ¸
        const result = await apiManager.updateCompany(oldValue.id, updates);

        // 3. Remote Shadow ë¬´íš¨í™”
        kpiCache.clear();  // KPI ì¬ê³„ì‚° í•„ìš”

        // 4. UI ì„±ê³µ í‘œì‹œ
        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');

    } catch (error) {
        // 5. ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
        state.selectedCompany = oldValue;
        renderCompanyDetail(oldValue);
        showToast('ì €ì¥ ì‹¤íŒ¨', 'error');
    }
}

// ê·œì¹™ 2: Remote Shadow â†’ Local State (ì½ê¸°)
async function loadCompanyData() {
    // 1. Remote Shadow (Cache) í™•ì¸
    let companies = loadCompaniesFromCache();

    // 2. ìºì‹œ ì—†ê±°ë‚˜ staleí•˜ë©´ Backend ì¡°íšŒ
    if (!companies || isStale(companies)) {
        companies = await apiManager.getCompanies();
        await saveToCache(companies);  // Shadow ì—…ë°ì´íŠ¸
    }

    // 3. Local State ì„¤ì •
    state.companies = companies;  // Layer 3 â†’ Layer 1
    state.kpi = calculateDerivedKPIs(companies);  // Layer 2

    // 4. UI ë Œë”ë§
    renderCompanyList(companies);
}

// ê·œì¹™ 3: Derived StateëŠ” í•­ìƒ ì½ê¸° ì „ìš©
// âŒ ì˜ëª»ëœ íŒ¨í„´
state.kpi.totalSales = 10000000;  // ì§ì ‘ ìˆ˜ì • ê¸ˆì§€!

// âœ… ì˜¬ë°”ë¥¸ íŒ¨í„´
state.companies = updatedCompanies;  // ì›ë³¸ ìˆ˜ì •
state.kpi = calculateDerivedKPIs(state.companies);  // íŒŒìƒ ìƒíƒœ ì¬ê³„ì‚°
```

---

### 13.4 ìºì‹± ì „ëµ ë° ë™ê¸°í™” ì •ì±…

#### 13.4.1 ìºì‹± ê³„ì¸µë³„ ì „ëµ

**Memory Cache (KPICache)**
```javascript
// ì‹¤ì œ êµ¬í˜„: 05.kpi/05_cache.js
{
    storage: 'Memory (Map)',
    ttl: '5ë¶„ (300ì´ˆ)',
    maxSize: '100ê°œ í•­ëª©',
    evictionPolicy: 'LRU (Least Recently Used)',
    invalidationTriggers: [
        'TTL ë§Œë£Œ',
        'CRUD ì‘ì—… (ìˆ˜ë™ í˜¸ì¶œ)',
        'íˆíŠ¸ìœ¨ 50% ë¯¸ë§Œ (ìë™ ê°±ì‹ )'
    ],
    usage: 'KPI ê³„ì‚° ê²°ê³¼ ìºì‹±'
}
```

**localStorage Cache**
```javascript
{
    storage: 'Browser localStorage',
    ttl: 'ë¬´ì œí•œ (ìˆ˜ë™ ì‚­ì œ)',
    maxSize: 'ë¸Œë¼ìš°ì € ì œí•œ (ë³´í†µ 5-10MB)',
    evictionPolicy: 'Manual',
    invalidationTriggers: [
        'ë¡œê·¸ì•„ì›ƒ',
        'ëª…ì‹œì  ì‚­ì œ',
        'ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ'
    ],
    usage: 'ì¸ì¦ í† í°, ì‚¬ìš©ì ì„¤ì •, ë°±ì—… íˆìŠ¤í† ë¦¬'
}
```

**sessionStorage Cache**
```javascript
{
    storage: 'Browser sessionStorage',
    ttl: 'ì„¸ì…˜ ì¢…ë£Œ ì‹œ (íƒ­ ë‹«ê¸°)',
    maxSize: 'ë¸Œë¼ìš°ì € ì œí•œ (ë³´í†µ 5-10MB)',
    evictionPolicy: 'Automatic (session end)',
    invalidationTriggers: [
        'íƒ­ ë‹«ê¸°',
        'ë¸Œë¼ìš°ì € ì¢…ë£Œ',
        'ëª…ì‹œì  ì‚­ì œ'
    ],
    usage: 'ì‚¬ìš©ì ì •ë³´, ì„ì‹œ UI ìƒíƒœ'
}
```

**IndexedDB Cache**
```javascript
{
    storage: 'Browser IndexedDB',
    ttl: 'ìˆ˜ë™ ê´€ë¦¬',
    maxSize: 'ë¸Œë¼ìš°ì € ì œí•œ (ìˆ˜ë°± MB ~ GB)',
    evictionPolicy: 'Manual or Automatic Backup',
    invalidationTriggers: [
        'ì—‘ì…€ ì—…ë¡œë“œ',
        'ë°±ì—… ìƒì„±',
        'ìˆ˜ë™ ì‚­ì œ'
    ],
    usage: 'ê±°ë˜ì²˜/ë³´ê³ ì„œ ëŒ€ëŸ‰ ë°ì´í„°, ë°±ì—…'
}
```

#### 13.4.2 TTL ì •ì±… ë§¤íŠ¸ë¦­ìŠ¤

| ë°ì´í„° íƒ€ì… | TTL | ì €ì¥ì†Œ | ê°±ì‹  ì¡°ê±´ | ë¬´íš¨í™” ì¡°ê±´ |
|------------|-----|--------|----------|------------|
| **KPI ê³„ì‚° ê²°ê³¼** | 5ë¶„ | Memory | TTL ë§Œë£Œ | CRUD ì‘ì—… |
| **ê±°ë˜ì²˜ ëª©ë¡** | 30ë¶„ | IndexedDB | í˜ì´ì§€ ë¡œë“œ ì‹œ | ì—‘ì…€ ì—…ë¡œë“œ |
| **ì‹¤ì ë³´ê³ ì„œ** | 5ë¶„ | Memory | API ìš”ì²­ ì‹œ | ë³´ê³ ì„œ ì‘ì„±/ìˆ˜ì • |
| **ì‚¬ìš©ì ì •ë³´** | ì„¸ì…˜ | sessionStorage | ë¡œê·¸ì¸ ì‹œ | ë¡œê·¸ì•„ì›ƒ |
| **ì¸ì¦ í† í°** | JWT ë§Œë£Œ ì‹œ | localStorage | ê°±ì‹  ì‹œ | ë¡œê·¸ì•„ì›ƒ |
| **Master Data** | 1ì‹œê°„ | Memory | í˜ì´ì§€ ë¡œë“œ ì‹œ | ìˆ˜ë™ |

#### 13.4.3 ë™ê¸°í™” íŠ¸ë¦¬ê±° ë° ì „ëµ

**ìë™ ë™ê¸°í™” íŠ¸ë¦¬ê±°**:
```javascript
// 1. í¬ì»¤ìŠ¤ ë³µê·€ ì‹œ ë°ì´í„° ê°±ì‹ 
window.addEventListener('focus', async () => {
    console.log('[ë™ê¸°í™”] í¬ì»¤ìŠ¤ ë³µê·€ ê°ì§€');

    // ìºì‹œ ë‚˜ì´ í™•ì¸
    const cacheAge = Date.now() - lastFetchTime;
    if (cacheAge > 5 * 60 * 1000) {  // 5ë¶„ ì´ìƒ
        console.log('[ë™ê¸°í™”] ë°ì´í„° ì¬ë¡œë“œ ì¤‘...');
        await loadCompanyData();
    }
});

// 2. ì£¼ê¸°ì  ìë™ ê°±ì‹  (KPICache)
export function startCacheRefresh(interval = 300) {
    setInterval(() => {
        console.log('[ìë™ ê°±ì‹ ] KPI ìºì‹œ ê°±ì‹  ì‹œì‘');

        const stats = kpiCache.getStats();

        // íˆíŠ¸ìœ¨ 50% ë¯¸ë§Œ ì‹œ ì „ì²´ ì‚­ì œ
        if (parseFloat(stats.hitRate) < 50) {
            kpiCache.clear();
            console.log('[ìë™ ê°±ì‹ ] íˆíŠ¸ìœ¨ ë‚®ìŒ â†’ ì „ì²´ ì‚­ì œ');
        }
    }, interval * 1000);  // 300ì´ˆ = 5ë¶„
}

// 3. CRUD ì‘ì—… í›„ ìë™ ë¬´íš¨í™”
async function createCompany(data) {
    const result = await apiManager.createCompany(data);

    // ìë™ ìºì‹œ ë¬´íš¨í™”
    kpiCache.clear('sales_kpi_*');  // ì˜ì—… KPI
    kpiCache.clear('admin_kpi');    // ê´€ë¦¬ì KPI

    // UI ê°±ì‹ 
    await loadCompanyList();

    return result;
}
```

**ìˆ˜ë™ ë™ê¸°í™” íŠ¸ë¦¬ê±°**:
```javascript
// ì‚¬ìš©ì ëª…ì‹œì  ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
async function handleRefreshClick() {
    console.log('[ë™ê¸°í™”] ì‚¬ìš©ì ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨');

    // ëª¨ë“  ìºì‹œ ë¬´íš¨í™”
    kpiCache.clear();

    // Backendì—ì„œ ìµœì‹  ë°ì´í„° ì¡°íšŒ
    const companies = await apiManager.getCompanies();
    const reports = await apiManager.getReports();

    // IndexedDB ë™ê¸°í™”
    await syncToIndexedDB({ companies, reports });

    // UI ê°±ì‹ 
    await loadAllData();

    showToast('ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤', 'success');
}
```

---

### 13.5 ì—ëŸ¬ ë° ì¬ì‹œë„ ì „ëµ

#### 13.5.1 ì—ëŸ¬ ë¶„ë¥˜ ì²´ê³„

```javascript
// ì‹¤ì œ êµ¬í˜„: 01.common/13_api_manager.js

const ERROR_TYPES = {
    // 1. ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ (ì¬ì‹œë„ ê°€ëŠ¥)
    NETWORK_ERROR: {
        patterns: ['Failed to fetch', 'TypeError'],
        severity: 'HIGH',
        retryable: true,
        maxRetries: 3,
        backoffStrategy: 'exponential',
        userMessage: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”'
    },

    // 2. íƒ€ì„ì•„ì›ƒ ì—ëŸ¬ (ì¬ì‹œë„ ê°€ëŠ¥)
    TIMEOUT_ERROR: {
        patterns: ['AbortError', 'timeout'],
        severity: 'MEDIUM',
        retryable: true,
        maxRetries: 2,
        backoffStrategy: 'linear',
        userMessage: 'ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤'
    },

    // 3. ì‚¬ìš©ì ì…ë ¥ ì—ëŸ¬ (ì¬ì‹œë„ ë¶ˆê°€)
    CLIENT_ERROR_4XX: {
        patterns: [400, 401, 403, 404, 422],
        severity: 'LOW',
        retryable: false,
        maxRetries: 0,
        backoffStrategy: null,
        userMessage: 'ì…ë ¥ ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”'
    },

    // 4. ì„œë²„ ì—ëŸ¬ (ì¬ì‹œë„ ê°€ëŠ¥)
    SERVER_ERROR_5XX: {
        patterns: [500, 502, 503, 504],
        severity: 'HIGH',
        retryable: true,
        maxRetries: 3,
        backoffStrategy: 'exponential',
        userMessage: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”'
    }
};
```

#### 13.5.2 ì¬ì‹œë„ ë¡œì§ (Exponential Backoff)

```javascript
// ì‹¤ì œ êµ¬í˜„: 01.common/13_api_manager.js lines 460-517

class ApiManager {
    constructor() {
        this.retryConfig = {
            maxRetries: 3,           // ìµœëŒ€ 3íšŒ ì¬ì‹œë„
            retryDelay: 1000,        // ì´ˆê¸° ì§€ì—°: 1ì´ˆ
            retryMultiplier: 2       // ì§€ìˆ˜ ë°±ì˜¤í”„ ê³„ìˆ˜
        };
    }

    async request(endpoint, options = {}) {
        let lastError;

        for (let attempt = 0; attempt <= this.retryConfig.maxRetries; attempt++) {
            try {
                const response = await fetch(url, config);
                return await this.handleResponse(response);

            } catch (error) {
                lastError = error;

                // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ë§Œ ì¬ì‹œë„
                if (error.name === 'TypeError' && error.message === 'Failed to fetch') {
                    if (attempt < this.retryConfig.maxRetries) {
                        // Exponential Backoff ê³„ì‚°
                        const delay = this.retryConfig.retryDelay * Math.pow(
                            this.retryConfig.retryMultiplier,
                            attempt
                        );
                        // ì¬ì‹œë„ ê°„ê²©: 1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ

                        console.warn(`[ì¬ì‹œë„] ${attempt + 1}/${this.retryConfig.maxRetries} (${delay}ms í›„)`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;  // ë‹¤ìŒ ì‹œë„
                    }
                }

                // ì¬ì‹œë„ ë¶ˆê°€ ì—ëŸ¬ëŠ” ì¦‰ì‹œ throw
                break;
            }
        }

        throw lastError;  // ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨
    }
}
```

#### 13.5.3 ì—ëŸ¬ ì²˜ë¦¬ í”Œë¡œìš°ì°¨íŠ¸

```
API ìš”ì²­
   â”‚
   â”œâ”€ ì„±ê³µ â†’ ì‘ë‹µ ë°˜í™˜
   â”‚
   â””â”€ ì‹¤íŒ¨
      â”‚
      â”œâ”€ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ (Failed to fetch)
      â”‚  â””â”€ Exponential Backoff ì¬ì‹œë„
      â”‚     â”œâ”€ 1ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 1
      â”‚     â”œâ”€ 2ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 2
      â”‚     â”œâ”€ 4ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 3
      â”‚     â””â”€ ì‹¤íŒ¨ â†’ ì—°ê²° ì—ëŸ¬ UI í‘œì‹œ
      â”‚
      â”œâ”€ íƒ€ì„ì•„ì›ƒ ì—ëŸ¬ (AbortError)
      â”‚  â””â”€ Linear Backoff ì¬ì‹œë„
      â”‚     â”œâ”€ 1ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 1
      â”‚     â”œâ”€ 1ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 2
      â”‚     â””â”€ ì‹¤íŒ¨ â†’ íƒ€ì„ì•„ì›ƒ ì—ëŸ¬
      â”‚
      â”œâ”€ 400ë²ˆëŒ€ ì—ëŸ¬ (í´ë¼ì´ì–¸íŠ¸)
      â”‚  â”œâ”€ 400 Bad Request â†’ ì…ë ¥ ê²€ì¦ ë©”ì‹œì§€
      â”‚  â”œâ”€ 401 Unauthorized â†’ ë¡œê·¸ì¸ í™”ë©´ ì´ë™
      â”‚  â”œâ”€ 403 Forbidden â†’ ê¶Œí•œ ì—†ìŒ ë©”ì‹œì§€
      â”‚  â””â”€ 404 Not Found â†’ ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€
      â”‚
      â””â”€ 500ë²ˆëŒ€ ì—ëŸ¬ (ì„œë²„)
         â””â”€ Exponential Backoff ì¬ì‹œë„
            â”œâ”€ 1ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 1
            â”œâ”€ 2ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 2
            â”œâ”€ 4ì´ˆ ëŒ€ê¸° â†’ ì¬ì‹œë„ 3
            â””â”€ ì‹¤íŒ¨ â†’ ì„œë²„ ì˜¤ë¥˜ ë©”ì‹œì§€
```

#### 13.5.4 ì—ëŸ¬ ë³„ ì‚¬ìš©ì í”¼ë“œë°±

```javascript
function handleApiError(error) {
    switch(true) {
        // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬
        case error.message === 'Failed to fetch':
            showModal({
                title: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜',
                content: `
                    <p>ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    <ul>
                        <li>ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</li>
                        <li>ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”</li>
                        <li>URL: ${apiManager.config.baseURL}</li>
                    </ul>
                `,
                buttons: [
                    { text: 'ì¬ì‹œë„', onClick: () => retryRequest() },
                    { text: 'ë‹«ê¸°', type: 'secondary' }
                ]
            });
            break;

        // ì¸ì¦ ì—ëŸ¬
        case error.status === 401:
            showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
            setTimeout(() => {
                window.location.href = '/02.login/01_login.html';
            }, 2000);
            break;

        // ê¶Œí•œ ì—ëŸ¬
        case error.status === 403:
            showToast('ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤', 'error');
            break;

        // ê²€ì¦ ì—ëŸ¬
        case error.status === 400:
        case error.status === 422:
            const errorDetails = error.data?.details || [];
            const errorList = errorDetails.map(d => `â€¢ ${d.message}`).join('<br>');
            showToast(`ì…ë ¥ ì˜¤ë¥˜:<br>${errorList}`, 'error');
            break;

        // ì„œë²„ ì—ëŸ¬
        case error.status >= 500:
            showToast('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”', 'error');
            console.error('[ì„œë²„ ì—ëŸ¬]', error.data);
            break;

        default:
            showToast('ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
    }
}
```

---

## ğŸ“„ 13. ê²°ë¡  ë° ìš”ì•½

### 13.1 ë¶„ì„ ê²°ê³¼ ìš”ì•½

ë³¸ ë¶„ì„ì„ í†µí•´ KUWOTECH ì˜ì—…ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ë°ì´í„° íë¦„ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì‚¬í•­ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤:

âœ… **ì˜ êµ¬í˜„ëœ ë¶€ë¶„**:
1. GlobalConfigë¥¼ í†µí•œ ì¤‘ì•™í™”ëœ ì„¤ì • ê´€ë¦¬
2. í™˜ê²½ë³„ ìë™ API URL ê°ì§€ ë¡œì§
3. ì–‘ë°©í–¥ CRUD ì‘ì—…ì˜ ê¸°ë³¸ êµ¬ì¡°
4. IndexedDBë¥¼ í™œìš©í•œ ë¡œì»¬ ë°ì´í„° ìºì‹±
5. ëª¨ë“œë³„(Sales/Admin) ëª…í™•í•œ ê¶Œí•œ ë¶„ë¦¬

âš ï¸ **ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„**:
1. ğŸ”´ **HIGH**: Storage í˜¼ìš© (employees.js)
2. ğŸŸ  **MEDIUM**: API URL í•˜ë“œì½”ë”© (3ê°œ íŒŒì¼)
3. ğŸŸ  **MEDIUM**: í† í° í‚¤ ì´ë¦„ ë¶ˆì¼ì¹˜
4. ğŸŸ¡ **LOW**: API ì‘ë‹µ êµ¬ì¡° ë¹„í‘œì¤€í™”
5. ğŸŸ¡ **LOW**: ApiManager baseURL í•˜ë“œì½”ë”©

### 13.2 ì£¼ìš” ê¶Œì¥ì‚¬í•­

#### ì¦‰ì‹œ ì‹¤í–‰ (ì´ë²ˆ ì£¼ ë‚´)
1. **employees.js ìˆ˜ì •** (2ê³³)
   - Line 1102, 1131: sessionStorage â†’ localStorage ë³€ê²½
   - í† í° í‚¤: 'token' â†’ 'authToken' ë³€ê²½
   - **ì˜ˆìƒ ì†Œìš”**: 5ë¶„
   - **í…ŒìŠ¤íŠ¸**: ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥ ë™ì‘ í™•ì¸

#### ë‹¨ê¸° ì‹¤í–‰ (1-2ì£¼ ë‚´)
2. **API URL ì¤‘ì•™í™”**
   - ApiManager.js: GlobalConfig ì‚¬ìš©
   - presentation.js, data_management.js: í•˜ë“œì½”ë”© ì œê±°
   - **ì˜ˆìƒ ì†Œìš”**: 30ë¶„
   - **í…ŒìŠ¤íŠ¸**: ì „ì²´ API í˜¸ì¶œ ì •ìƒ ì‘ë™ í™•ì¸

3. **Storage í‘œì¤€ ë¬¸ì„œí™”**
   - localStorage vs sessionStorage ì‚¬ìš© ê¸°ì¤€ ëª…í™•í™”
   - íŒ€ ë‚´ ê³µìœ  ë° ì¤€ìˆ˜

#### ì¤‘ê¸° ì‹¤í–‰ (1-2ê°œì›” ë‚´)
4. **ApiManager í™•ëŒ€ ë˜ëŠ” API Helper ë„ì…**
   - ì˜µì…˜ 1: ApiManagerì— companies, employees ë©”ì„œë“œ ì¶”ê°€
   - ì˜µì…˜ 2: ê³µí†µ API Helper í•¨ìˆ˜ ìƒì„±
   - **ì˜ˆìƒ ì†Œìš”**: 1-2ì¼ (ë©”ì„œë“œ ì¶”ê°€) ë˜ëŠ” 4ì‹œê°„ (Helper ìƒì„±)
   - **íš¨ê³¼**: ì½”ë“œ ì¤‘ë³µ ì œê±°, ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬

5. **Backend API ì‘ë‹µ êµ¬ì¡° í‘œì¤€í™”**
   - ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì¼ê´€ëœ JSON í˜•ì‹ ì‚¬ìš©
   - Frontend íŒŒì‹± ë¡œì§ ë‹¨ìˆœí™”

#### ì¥ê¸° ìµœì í™” (3-6ê°œì›” ë‚´)
6. **Pagination ë„ì…**
   - limit=10000 ì œê±°
   - í˜ì´ì§€ ë‹¨ìœ„ ì¡°íšŒë¡œ ì „í™˜
   - ì„±ëŠ¥ ë° ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

7. **ìºì‹± ì „ëµ ê°•í™”**
   - ê±°ë˜ì²˜ ë°ì´í„° IndexedDB ìºì‹±
   - ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„
   - ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ ê°ì†Œ

### 13.3 ìš°ì„ ìˆœìœ„ ë§¤íŠ¸ë¦­ìŠ¤

```
ë†’ì€ ì˜í–¥ â”‚ ğŸ”´ employees.js ìˆ˜ì •     â”‚ ğŸŸ  API URL ì¤‘ì•™í™”
         â”‚ (ì¦‰ì‹œ ì‹¤í–‰)              â”‚ (ë‹¨ê¸° ì‹¤í–‰)
         â”‚                          â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â”‚ ğŸŸ¡ ApiManager í™•ëŒ€       â”‚ ğŸŸ¡ Pagination
ë‚®ì€ ì˜í–¥ â”‚ (ì¤‘ê¸° ì‹¤í–‰)              â”‚ (ì¥ê¸° ìµœì í™”)
         â”‚                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ë‚®ì€ ë‚œì´ë„              ë†’ì€ ë‚œì´ë„
```

### 13.4 ìµœì¢… ì˜ê²¬

í˜„ì¬ ì‹œìŠ¤í…œì€ **ê¸°ë³¸ì ì¸ ë°ì´í„° íë¦„ì´ ì˜ êµ¬í˜„**ë˜ì–´ ìˆìœ¼ë©°, ì–‘ë°©í–¥ CRUD ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. ë‹¤ë§Œ, **ì¼ë¶€ ì¼ê´€ì„± ë¬¸ì œ**ì™€ **ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ **ì´ í•„ìš”í•©ë‹ˆë‹¤.

**ê°€ì¥ ì¤‘ìš”í•œ ê°œì„ ì‚¬í•­**ì€ `employees.js`ì˜ Storage ë¶ˆì¼ì¹˜ ìˆ˜ì •ì…ë‹ˆë‹¤. ì´ëŠ” **ê±°ë˜ì²˜ ì´ê´€ ê¸°ëŠ¥ì˜ ì¸ì¦ ì‹¤íŒ¨**ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆëŠ” **HIGH ìš°ì„ ìˆœìœ„** ë¬¸ì œì…ë‹ˆë‹¤.

ê·¸ ì™¸ API URL í•˜ë“œì½”ë”©ê³¼ íŒ¨í„´ ë¶ˆì¼ì¹˜ëŠ” **ìœ ì§€ë³´ìˆ˜ì„±**ì— ì˜í–¥ì„ ë¯¸ì¹˜ë¯€ë¡œ **ë‹¨ê¸°ì ìœ¼ë¡œ ê°œì„ **í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

---

## ğŸ“š 14. ì°¸ê³  ìë£Œ

### 14.1 ê´€ë ¨ íŒŒì¼ ëª©ë¡

**Frontend - ì˜ì—…ë‹´ë‹¹ëª¨ë“œ**:
- `03.sales_mode/00_layouts/01_sales_layout.html` (100 lines)
- `03.sales_mode/01_dashboard/02_dashboard.js` (718 lines)
- `03.sales_mode/02_my_companies/02_my_companies.js` (1,520 lines)
- `03.sales_mode/03_report_write/02_report_write.js` (867 lines)
- `03.sales_mode/04_report_check/02_report_check.js` (1,978 lines)
- `03.sales_mode/05_admin_feedback/02_admin_feedback.js` (469 lines)
- `03.sales_mode/06_system_settings/02_settings.js` (458 lines)

**Frontend - ê´€ë¦¬ìëª¨ë“œ**:
- `04.admin_mode/00_layouts/01_admin_layout.html` (109 lines)
- `04.admin_mode/01_dashboard/02_dashboard.js` (721 lines)
- `04.admin_mode/02_all_companies/02_all_companies.js` (1,639 lines)
- `04.admin_mode/03_report_confirm/02_report_confirm.js` (959 lines)
- `04.admin_mode/04_presentation/02_presentation.js` (671 lines)
- `04.admin_mode/05_data_management/02_data_management.js` (534 lines)
- `04.admin_mode/06_employee_management/02_employees.js` (1,295 lines) âš ï¸
- `04.admin_mode/07_system_settings/02_settings.js` (458 lines)
- `04.admin_mode/08_excel_upload/02_excel_upload.js` (1,140 lines)

**Frontend - ê³µí†µ**:
- `01.common/01_global_config.js` (1,049 lines)
- `01.common/13_api_manager.js` (ì•½ 200 lines)

**Backend**:
- `06.Source/06.backend/routes/companies.js`
- `06.Source/06.backend/routes/reports.js`
- `06.Source/06.backend/routes/employees.js`

### 14.2 ìš©ì–´ ì„¤ëª…

- **CRUD**: Create (ìƒì„±), Read (ì¡°íšŒ), Update (ìˆ˜ì •), Delete (ì‚­ì œ)
- **JWT**: JSON Web Token - ì¸ì¦ í† í° ë°©ì‹
- **localStorage**: ë¸Œë¼ìš°ì € ì˜êµ¬ ì €ì¥ì†Œ (íƒ­ ë‹«ì•„ë„ ìœ ì§€)
- **sessionStorage**: ë¸Œë¼ìš°ì € ì„¸ì…˜ ì €ì¥ì†Œ (íƒ­ ë‹«ìœ¼ë©´ ì‚­ì œ)
- **IndexedDB**: ë¸Œë¼ìš°ì € ë‚´ì¥ ë°ì´í„°ë² ì´ìŠ¤ (ëŒ€ìš©ëŸ‰ ë°ì´í„° ì €ì¥)
- **ApiManager**: API í˜¸ì¶œì„ ì¤‘ì•™í™”í•œ í´ë˜ìŠ¤
- **Direct Fetch**: fetch APIë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë°©ì‹
- **GlobalConfig**: ì „ì—­ ì„¤ì • ê´€ë¦¬ ëª¨ë“ˆ
- **Railway**: í´ë¼ìš°ë“œ ë°°í¬ í”Œë«í¼

### 14.3 ê²€ì¦ ì™„ë£Œ í•­ëª©

âœ… **100% ì½”ë“œ ê²€ì¦ ì™„ë£Œ**:
- [x] Backend API ë¼ìš°íŠ¸ ì „ì²´ ë¶„ì„
- [x] Sales Mode 6ê°œ ë©”ë‰´ ì „ì²´ ë¶„ì„
- [x] Admin Mode 8ê°œ ë©”ë‰´ ì „ì²´ ë¶„ì„
- [x] API URL íŒ¨í„´ 4ê°€ì§€ ì‹ë³„
- [x] Storage ì‚¬ìš© íŒ¨í„´ ì „ìˆ˜ ì¡°ì‚¬
- [x] CRUD ì‘ì—… íë¦„ ë§¤í•‘
- [x] ë¬¸ì œì  ìš°ì„ ìˆœìœ„ ë¶„ë¥˜
- [x] ê°œì„ ë°©ì•ˆ êµ¬ì²´í™”

**ë¶„ì„ ë°©ë²•**:
- Glob íŒ¨í„´ìœ¼ë¡œ ì „ì²´ íŒŒì¼ ê²€ìƒ‰
- Grepìœ¼ë¡œ íŠ¹ì • íŒ¨í„´ ì¶”ì¶œ
- Readë¡œ ê°œë³„ íŒŒì¼ ìƒì„¸ ë¶„ì„
- ì‹¤ì œ ì½”ë“œ ë¼ì¸ ë²ˆí˜¸ ëª…ì‹œ

---

## ğŸ“§ ë¬¸ì˜ ë° í”¼ë“œë°±

ë³¸ ë¬¸ì„œì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ ì¶”ê°€ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš°:
- **ì‘ì„±ì**: Claude Code (AI Assistant)
- **ë¶„ì„ ì¼ì‹œ**: 2025-10-09
- **ê²€ì¦ ìˆ˜ì¤€**: 100% ì‹¤ì œ ì½”ë“œ ê¸°ë°˜ ë¶„ì„

---

**ë¬¸ì„œ ë**
