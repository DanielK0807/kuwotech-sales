# 13. 다운로드 시스템 통합 구현 계획

## 📋 문서 정보

| 항목 | 내용 |
|------|------|
| **문서명** | 다운로드 시스템 통합 구현 계획 |
| **버전** | 1.0 |
| **작성일** | 2025-09-30 |
| **작성자** | System |
| **문서번호** | KW-SALES-00-13 |
| **상태** | 📝 작성완료 |

---

## 🎯 1. 개요

### 1.1 목적
영업담당모드와 관리자모드의 모든 사이드메뉴에서 체계적이고 일관된 다운로드 기능을 제공하여 사용자가 필요한 데이터를 언제든지 엑셀 형태로 받을 수 있도록 구현

### 1.2 범위

#### 영업담당모드 (6개 메뉴)
1. ✅ **대시보드** - KPI 실적 다운로드
2. ✅ **담당거래처관리** - 내 거래처 정보 다운로드
3. ✅ **실적보고서 작성** - 작성한 보고서 다운로드
4. ✅ **실적보고서 확인** - 내 보고서 이력 다운로드
5. ✅ **데이터관리** - 통합 데이터 다운로드
6. ❌ **시스템설정** - 다운로드 불필요

#### 관리자모드 (7개 메뉴)
1. ✅ **대시보드** - 전사 KPI 다운로드
2. ✅ **전체거래처 관리** - 전체 거래처 정보 다운로드
3. ✅ **실적보고서 확인** - 전체 보고서 다운로드
4. ✅ **보고서 발표** - PPT 생성 다운로드
5. ✅ **데이터 관리** - 전체 백업 다운로드
6. ✅ **직원 관리** - 직원 정보 다운로드
7. ✅ **시스템 설정** - 설정 백업 다운로드

**총 구현 대상**: 12개 메뉴 중 11개 메뉴

---

## 📂 2. 파일 구조

### 2.1 신규 생성 파일 목록

```
05.Source/
├── 06.database/
│   ├── 12_download_manager.js          ⭐ 통합 다운로드 매니저 (핵심)
│   └── 13_download_progress.js         🆕 다운로드 진행 UI
│
├── 03.sales_mode/
│   ├── 01_dashboard/
│   │   ├── 01_dashboard.html           (기존)
│   │   ├── 02_dashboard.js             (기존 - 수정)
│   │   └── 03_download_kpi.js          🆕
│   │
│   ├── 02_my_companies/
│   │   ├── 01_my_companies.html        (기존)
│   │   ├── 02_my_companies.js          (기존 - 수정)
│   │   └── 03_download.js              🆕
│   │
│   ├── 03_report_write/
│   │   ├── 01_report_write.html        (기존)
│   │   ├── 02_report_write.js          (기존 - 수정)
│   │   └── 03_download.js              🆕
│   │
│   ├── 04_report_check/
│   │   ├── 01_report_check.html        (기존)
│   │   ├── 02_report_check.js          (기존 - 수정)
│   │   └── 03_download.js              🆕
│   │
│   └── 05_data_management/
│       ├── 01_data_management.html     (기존)
│       ├── 02_data_management.js       (기존 - 수정)
│       └── 03_download_all.js          🆕
│
└── 04.admin_mode/
    ├── 01_dashboard/
    │   ├── 01_dashboard.html           (기존)
    │   ├── 02_dashboard.js             (기존 - 수정)
    │   └── 03_download_kpi.js          🆕
    │
    ├── 02_all_companies/
    │   ├── 01_all_companies.html       (기존)
    │   ├── 02_all_companies.js         (기존 - 수정)
    │   └── 03_download.js              🆕
    │
    ├── 03_report_confirm/
    │   ├── 01_report_confirm.html      (기존)
    │   ├── 02_report_confirm.js        (기존 - 수정)
    │   └── 03_download.js              🆕
    │
    ├── 04_presentation/
    │   ├── 01_presentation.html        (기존)
    │   ├── 02_presentation.js          (기존 - 수정)
    │   └── 03_download_ppt.js          🆕
    │
    ├── 05_data_management/
    │   ├── 01_data_management.html     (기존)
    │   ├── 02_data_management.js       (기존 - 수정)
    │   └── 03_download_all.js          🆕
    │
    ├── 06_employee_management/
    │   ├── 01_employees.html           (기존)
    │   ├── 02_employees.js             (기존 - 수정)
    │   └── 03_download.js              🆕
    │
    └── 07_system_settings/
        ├── 01_settings.html            (기존)
        ├── 02_settings.js              (기존 - 수정)
        └── 03_download.js              🆕
```

**총 신규 파일**: 13개  
**수정 대상 파일**: 11개

---

## 🎨 3. 사이드메뉴별 다운로드 상세

### 📘 영업담당모드

#### 3.1 [1번 메뉴] 대시보드 → KPI 실적 다운로드

**📍 위치**: `03.sales_mode/01_dashboard/`

**🎯 버튼 배치**
```html
<!-- 우측 상단 헤더 영역 -->
<div class="dashboard-header glass-panel">
    <h2>📊 나의 영업 대시보드</h2>
    <div class="header-actions">
        <button id="btn-download-kpi" class="glass-button primary">
            <i class="icon">📥</i>
            <span>실적 다운로드</span>
        </button>
    </div>
</div>
```

**📊 다운로드 파일**
```
파일명: 영업실적_홍길동_2025-09.xlsx

[영업실적] 시트
├─ 담당자: 홍길동
├─ 기간: 2025-09
├─ 담당거래처수: 25
├─ 총 매출액: 125,000,000
├─ 총 수금액: 98,000,000
├─ 수금률: 78.4%
├─ 방문건수: 42
└─ 평균수금액: 2,333,333

[거래처별 상세] 시트
└─ 거래처별 매출 내역
```

**💻 구현 코드**
```javascript
// 03_download_kpi.js
import DownloadManager, { DOWNLOAD_TYPES } from '../../../06.database/12_download_manager.js';

export async function downloadSalesKPI(dateRange = null) {
    const userName = sessionStorage.getItem('userName');
    const userRole = sessionStorage.getItem('userRole');
    
    if (!dateRange) {
        const now = new Date();
        dateRange = {
            start: `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-01`,
            end: `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-31`
        };
    }
    
    await DownloadManager.download({
        downloadType: DOWNLOAD_TYPES.SALES_KPI,
        userRole: userRole,
        userName: userName,
        includeSheets: ['영업실적', '거래처별상세'],
        dateRange: dateRange,
        format: 'excel'
    });
}
```

---

#### 3.2 [2번 메뉴] 담당거래처관리 → 거래처 정보 다운로드

**📍 위치**: `03.sales_mode/02_my_companies/`

**🎯 버튼 배치**
```html
<!-- 테이블 상단 액션 바 -->
<div class="action-bar">
    <div class="action-right">
        <button id="btn-download" class="glass-button primary">
            <i class="icon">💾</i>
            <span>내 거래처 다운로드</span>
        </button>
    </div>
</div>
```

**📊 다운로드 파일**
```
파일명: 거래처정보_홍길동_2025-09-30.xlsx

[기본정보] 시트 (19개 컬럼)
└─ 내부담당자 = '홍길동'인 거래처만

[입사일자] 시트
└─ 전체 직원 정보
```

---

#### 3.3 [3번 메뉴] 실적보고서 작성 → 작성 보고서 다운로드

**📍 위치**: `03.sales_mode/03_report_write/`

**🎯 버튼 배치**
```html
<!-- 보고서 목록 상단 -->
<div class="my-reports glass-panel">
    <div class="reports-header">
        <h3>📋 내가 작성한 보고서</h3>
        <button id="btn-download-reports" class="glass-button primary">
            <i class="icon">📥</i>
            <span>보고서 다운로드</span>
        </button>
    </div>
</div>
```

**📊 다운로드 파일**
```
파일명: 방문보고서_홍길동_2025.xlsx

[방문보고서] 시트 (12개 컬럼)
└─ 작성자 = '홍길동'인 보고서만
```

---

#### 3.4 [4번 메뉴] 실적보고서 확인 → 보고서 이력 다운로드

**📍 위치**: `03.sales_mode/04_report_check/`

**🎯 버튼 배치**
```html
<div class="reports-header">
    <h2>📋 내 보고서 확인</h2>
    <button id="btn-download-reports" class="glass-button primary">
        <i class="icon">📥</i>
        <span>보고서 다운로드</span>
    </button>
</div>
```

**📊 다운로드 파일**: 3번 메뉴와 동일

---

#### 3.5 [5번 메뉴] 데이터관리 → 통합 데이터 다운로드

**📍 위치**: `03.sales_mode/05_data_management/`

**🎯 버튼 배치**
```html
<!-- 빠른 다운로드 카드 -->
<div class="download-grid">
    <button class="download-card" data-type="companies">
        <i class="icon">🏢</i>
        <h4>내 거래처</h4>
    </button>
    <button class="download-card" data-type="reports">
        <i class="icon">📋</i>
        <h4>내 보고서</h4>
    </button>
    <button class="download-card" data-type="kpi">
        <i class="icon">📊</i>
        <h4>내 실적</h4>
    </button>
</div>

<!-- 통합 다운로드 -->
<button id="btn-download-all" class="glass-button primary large">
    <i class="icon">💾</i>
    <span>전체 데이터 다운로드</span>
</button>
```

**📊 다운로드 파일**
```
파일명: 영업데이터_홍길동_2025-09-30.xlsx

[기본정보] 시트
[방문보고서] 시트
[영업실적] 시트
```

---

### 📕 관리자모드

#### 3.6 [1번 메뉴] 대시보드 → 전사 KPI 다운로드

**📍 위치**: `04.admin_mode/01_dashboard/`

**🎯 버튼 배치**
```html
<div class="admin-dashboard-header glass-panel">
    <h2>📈 전사 영업 대시보드</h2>
    <div class="header-actions">
        <button id="btn-download-company-kpi" class="glass-button admin-accent">
            <i class="icon">📥</i>
            <span>전사 실적 다운로드</span>
        </button>
    </div>
</div>
```

**📊 다운로드 파일**
```
파일명: 전사실적_2025-09.xlsx

[전사실적] 시트 (15개 컬럼)
├─ 담당자별 KPI
└─ 마지막 행: 전체 합계

[월별추이] 시트
[Top거래처] 시트
```

---

#### 3.7 [2번 메뉴] 전체거래처 관리 → 전체 거래처 다운로드

**📍 위치**: `04.admin_mode/02_all_companies/`

**🎯 버튼 배치**
```html
<div class="action-bar">
    <button id="btn-download" class="glass-button admin-primary">
        <i class="icon">💾</i>
        <span>전체 거래처 다운로드</span>
    </button>
</div>
```

**📊 다운로드 파일**
```
파일명: 전체거래처_2025-09-30.xlsx

[기본정보] 시트
└─ 전체 거래처 (필터링 없음)

[입사일자] 시트
└─ 전체 직원

[거래처통계] 시트
└─ 담당자별 통계
```

---

#### 3.8 [3번 메뉴] 실적보고서 확인 → 전체 보고서 다운로드

**📍 위치**: `04.admin_mode/03_report_confirm/`

**🎯 버튼 배치**
```html
<div class="reports-header glass-panel">
    <h2>✅ 실적보고서 확인</h2>
    <div class="header-actions">
        <button id="btn-download-all-reports" class="glass-button admin-accent">
            <i class="icon">📥</i>
            <span>전체 보고서 다운로드</span>
        </button>
        <button id="btn-download-selected" class="glass-button">
            <i class="icon">☑️</i>
            <span>선택 다운로드</span>
        </button>
    </div>
</div>
```

**📊 다운로드 파일**
```
파일명: 방문보고서_전체_2025.xlsx

[방문보고서_전체] 시트
└─ 전체 보고서 (필터링 없음)

[담당자별통계] 시트
```

---

#### 3.9 [4번 메뉴] 보고서 발표 → PPT 생성 ⭐

**📍 위치**: `04.admin_mode/04_presentation/`

**🎯 버튼 배치**
```html
<div class="ppt-generator-section glass-panel">
    <h2>📺 보고서 발표 자료 생성</h2>
    
    <!-- 보고서 선택 -->
    <div class="report-selector">
        <!-- 선택 UI -->
    </div>
    
    <!-- 생성 버튼 -->
    <button id="btn-generate-ppt" class="glass-button admin-accent large">
        <i class="icon">🎬</i>
        <span>PPT 생성하기</span>
    </button>
</div>
```

**📊 다운로드 파일**
```
파일명: 영업보고_2025-09-30.pptx

슬라이드 1: 표지
슬라이드 2: 전사 실적 요약
슬라이드 3-N: 선택한 보고서별
슬라이드 N+1: 향후 계획
```

**💻 구현 코드 (PPT 생성)**
```javascript
// 03_download_ppt.js
import { PptxGenJS } from 'pptxgenjs';

export async function generatePresentationPPT(reportIds, options = {}) {
    const pptx = new PptxGenJS();
    pptx.layout = 'LAYOUT_16x9';
    
    // 표지 슬라이드
    const coverSlide = pptx.addSlide();
    coverSlide.background = { color: '0097A7' };
    coverSlide.addText('영업 실적 보고', {
        x: 1, y: 2.5, w: 8, h: 1.5,
        fontSize: 48, bold: true, color: 'FFFFFF', align: 'center'
    });
    
    // 보고서별 슬라이드 생성
    const reports = await getReportsByIds(reportIds);
    for (const report of reports) {
        const slide = pptx.addSlide();
        slide.addText(report.companyName, {
            x: 0.5, y: 0.5, fontSize: 28, bold: true
        });
        // ... 보고서 내용 추가
    }
    
    // 파일 저장
    await pptx.writeFile({ fileName: `영업보고_${new Date().toISOString().split('T')[0]}.pptx` });
}
```

---

#### 3.10 [5번 메뉴] 데이터 관리 → 전체 백업

**📍 위치**: `04.admin_mode/05_data_management/`

**📊 다운로드 파일**
```
파일명: 영업관리_전체백업_2025-09-30.xlsx

[기본정보] 시트
[방문보고서_전체] 시트
[직원정보] 시트
[변경이력] 시트
[전사실적] 시트
[메타정보] 시트
```

---

#### 3.11 [6번 메뉴] 직원 관리 → 직원 정보 다운로드

**📍 위치**: `04.admin_mode/06_employee_management/`

**📊 다운로드 파일**
```
파일명: 직원정보_2025-09-30.xlsx

[직원정보] 시트
├─ 이름, 사번, 입사일자
├─ 부서, 직급, 역할
└─ 이메일, 연락처, 상태
```

---

#### 3.12 [7번 메뉴] 시스템 설정 → 설정 백업

**📍 위치**: `04.admin_mode/07_system_settings/`

**📊 다운로드 파일**
```
파일명: 시스템설정_2025-09-30.xlsx

[시스템설정] 시트
├─ 설정항목, 설정값
└─ 설명, 수정일, 수정자
```

---

## 🎨 4. UI 디자인 시스템

### 4.1 다운로드 버튼 스타일

#### 영업담당 테마
```css
/* 03.sales_mode/00_layouts/03_sales_theme.css */

.sales-mode .btn-download {
    background: linear-gradient(135deg, #0097A7 0%, #00ACC1 100%);
    color: #FFFFFF;
    border: 2px solid rgba(0, 151, 167, 0.3);
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0, 151, 167, 0.4);
    transition: all 0.3s ease;
}

.sales-mode .btn-download:hover {
    background: linear-gradient(135deg, #00ACC1 0%, #00BCD4 100%);
    box-shadow: 0 6px 20px rgba(0, 151, 167, 0.6);
    transform: translateY(-2px);
}

.sales-mode .btn-download.accent {
    background: linear-gradient(135deg, #FF7043 0%, #FF8A65 100%);
}
```

#### 관리자 테마
```css
/* 04.admin_mode/00_layouts/03_admin_theme.css */

.admin-mode .btn-download {
    background: linear-gradient(135deg, #64B5F6 0%, #90CAF9 100%);
    color: #212121;
    border: 2px solid rgba(100, 181, 246, 0.3);
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(100, 181, 246, 0.4);
}

.admin-mode .btn-download.accent {
    background: linear-gradient(135deg, #00E676 0%, #69F0AE 100%);
}
```

### 4.2 다운로드 진행 모달

```html
<div class="download-progress-modal glass-modal">
    <div class="modal-content glass-panel">
        <div class="modal-header">
            <h3>📥 데이터 다운로드 중...</h3>
        </div>
        
        <div class="modal-body">
            <!-- 진행 바 -->
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 45%"></div>
            </div>
            
            <!-- 진행 정보 -->
            <div class="progress-info">
                <span class="progress-message">데이터 수집 중...</span>
                <span class="progress-percent">45%</span>
            </div>
            
            <!-- 진행 단계 -->
            <div class="progress-steps">
                <div class="step complete">
                    <div class="step-icon">⏳</div>
                    <div class="step-label">초기화</div>
                </div>
                <div class="step active">
                    <div class="step-icon">📊</div>
                    <div class="step-label">수집</div>
                </div>
                <div class="step">
                    <div class="step-icon">⚙️</div>
                    <div class="step-label">생성</div>
                </div>
                <div class="step">
                    <div class="step-icon">✅</div>
                    <div class="step-label">완료</div>
                </div>
            </div>
        </div>
    </div>
</div>
```

---

## 🗓️ 5. 구현 일정

### Phase 1: 핵심 기능 (1주)
- **Day 1-2**: 통합 다운로드 매니저
- **Day 3-4**: 영업담당 다운로드
- **Day 5-7**: 관리자 다운로드

### Phase 2: UI/UX (3일)
- **Day 8**: 버튼 디자인
- **Day 9**: 진행 모달
- **Day 10**: 옵션 모달

### Phase 3: 고급 기능 (4일)
- **Day 11**: PPT 생성
- **Day 12**: 데이터 최적화
- **Day 13**: 다운로드 이력
- **Day 14**: 테스트 및 버그 수정

**총 소요 예상**: 약 2-3주

---

## ✅ 6. 테스트 체크리스트

### 6.1 기능 테스트

#### 영업담당 모드
- [ ] 대시보드 KPI 다운로드
- [ ] 담당거래처 다운로드
- [ ] 보고서 다운로드
- [ ] 통합 데이터 다운로드

#### 관리자 모드
- [ ] 전사 KPI 다운로드
- [ ] 전체거래처 다운로드
- [ ] 전체보고서 다운로드
- [ ] PPT 생성
- [ ] 전체백업 다운로드
- [ ] 직원정보 다운로드
- [ ] 시스템설정 다운로드

### 6.2 권한 테스트
- [ ] 영업담당 권한 제한
  - [ ] 다른 담당자 데이터 접근 불가
  - [ ] 전사 KPI 다운로드 불가
- [ ] 관리자 권한 확인
  - [ ] 모든 데이터 접근 가능

### 6.3 데이터 무결성
- [ ] 컬럼 순서 확인
- [ ] 데이터 타입 확인
- [ ] NULL 값 처리
- [ ] 한글 인코딩
- [ ] 수식 제거

### 6.4 성능 테스트
- [ ] 소규모 데이터 (< 100행): < 2초
- [ ] 중규모 데이터 (100-1000행): < 10초
- [ ] 대규모 데이터 (1000+ 행): < 30초

### 6.5 크로스 브라우저
- [ ] Chrome
- [ ] Edge
- [ ] Firefox
- [ ] Safari

---

## 📝 7. 구현 우선순위

### 🔴 1순위 (필수 - 즉시)
1. ✅ 통합 다운로드 매니저
2. [ ] 영업담당: 담당거래처 다운로드
3. [ ] 관리자: 전체거래처 다운로드
4. [ ] 다운로드 진행 UI

### 🟡 2순위 (권장 - 1주 내)
5. [ ] 영업담당: KPI 다운로드
6. [ ] 관리자: 전사 KPI 다운로드
7. [ ] 보고서 다운로드

### 🟢 3순위 (선택 - 2주 내)
8. [ ] 데이터관리: 통합 다운로드
9. [ ] 관리자: PPT 생성
10. [ ] 다운로드 이력 관리

---

## 📊 8. 진행 상황 추적

| 항목 | 상태 | 완료일 | 비고 |
|------|------|--------|------|
| 통합 다운로드 매니저 | ✅ 완료 | 2025-09-30 | 12_download_manager.js |
| 다운로드 진행 UI | ✅ 완료 | 2025-09-30 | 13_download_progress.js |
| 영업: 담당거래처 | ⏳ 대기 | - | |
| 영업: KPI | ⏳ 대기 | - | |
| 영업: 보고서 | ⏳ 대기 | - | |
| 영업: 통합 | ⏳ 대기 | - | |
| 관리자: 전사 KPI | ⏳ 대기 | - | |
| 관리자: 전체거래처 | ⏳ 대기 | - | |
| 관리자: 전체보고서 | ⏳ 대기 | - | |
| 관리자: PPT 생성 | ⏳ 대기 | - | |
| 관리자: 전체백업 | ⏳ 대기 | - | |
| 관리자: 직원정보 | ⏳ 대기 | - | |
| 관리자: 시스템설정 | ⏳ 대기 | - | |

**전체 진행률**: 25% (3/13 완료)

---

## 📚 9. 엑셀 시트 구조 요약

| 시트명 | 컬럼 수 | 권한 | 비고 |
|--------|---------|------|------|
| 기본정보 | 19 | 영업/관리자 | 거래처 정보 |
| 방문보고서 | 12 | 영업/관리자 | 보고서 정보 |
| 입사일자 | 5 | 영업/관리자 | 직원 정보 |
| 영업실적 | 8 | 영업/관리자 | 개인 KPI |
| 전사실적 | 15 | 관리자만 | 전사 KPI |
| 변경이력 | 8 | 관리자만 | 변경 로그 |
| 메타정보 | 6 | 관리자만 | 시스템 정보 |
| 직원정보 | 9 | 관리자만 | 전체 직원 |
| 시스템설정 | 6 | 관리자만 | 설정 정보 |

---

## 🔧 10. 파일명 규칙

### 영업담당
```
영업실적_홍길동_2025-09.xlsx
거래처정보_홍길동_2025-09-30.xlsx
방문보고서_홍길동_2025.xlsx
영업데이터_홍길동_2025-09-30.xlsx
```

### 관리자
```
전사실적_2025-09.xlsx
전체거래처_2025-09-30.xlsx
방문보고서_전체_2025.xlsx
영업관리_전체백업_2025-09-30.xlsx
직원정보_2025-09-30.xlsx
시스템설정_2025-09-30.xlsx
영업보고_2025-09-30.pptx
```

---

## 📖 11. 참고 문서

### 내부 문서
- `10_핵심_공통_기능_구현_가이드.md` - 공통 기능 사용법
- `11_핵심_기능_구현_예제.md` - 구현 예제
- `04_테마색_차별화_가이드.md` - 테마 색상
- `08_공통_컴포넌트_가이드.md` - UI 컴포넌트

### 외부 라이브러리
- **SheetJS (xlsx)**: https://docs.sheetjs.com/
- **PptxGenJS**: https://gitbrent.github.io/PptxGenJS/
- **Chart.js**: https://www.chartjs.org/

---

## 📝 12. 구현 상세 코드

### 12.1 통합 다운로드 매니저 사용법

#### 영업담당 모드에서 사용

```javascript
// 03.sales_mode/01_dashboard/02_dashboard.js

import downloadManager, { DOWNLOAD_TYPES } from '../../06.database/12_download_manager.js';

// 실적 다운로드 버튼 이벤트
document.getElementById('btn-download-kpi').addEventListener('click', async () => {
    await downloadManager.download({
        downloadType: DOWNLOAD_TYPES.SALES_KPI,
        userRole: sessionStorage.getItem('userRole'),
        userName: sessionStorage.getItem('userName'),
        includeSheets: ['영업실적', '거래처별상세'],
        dateRange: {
            start: '2025-09-01',
            end: '2025-09-30'
        },
        format: 'excel'
    });
});
```

#### 관리자 모드에서 사용

```javascript
// 04.admin_mode/01_dashboard/02_dashboard.js

import downloadManager, { DOWNLOAD_TYPES } from '../../06.database/12_download_manager.js';

// 전사 실적 다운로드
document.getElementById('btn-download-company-kpi').addEventListener('click', async () => {
    await downloadManager.download({
        downloadType: DOWNLOAD_TYPES.ADMIN_COMPANY_KPI,
        userRole: 'admin',
        userName: sessionStorage.getItem('userName'),
        includeSheets: ['전사실적', '월별추이', 'Top거래처'],
        dateRange: {
            start: '2025-09-01',
            end: '2025-09-30'
        },
        format: 'excel'
    });
});
```

### 12.2 다운로드 버튼 HTML 예제

#### 영업담당 대시보드

```html
<!-- 03.sales_mode/01_dashboard/01_dashboard.html -->

<div class="dashboard-header glass-panel">
    <h2>📊 나의 영업 대시보드</h2>
    <div class="header-actions">
        <button id="btn-download-kpi" class="glass-button primary">
            <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            <span>실적 다운로드</span>
        </button>
    </div>
</div>
```

#### 관리자 전체거래처

```html
<!-- 04.admin_mode/02_all_companies/01_all_companies.html -->

<div class="action-bar">
    <div class="action-left">
        <input type="text" class="search-input" placeholder="거래처 검색...">
    </div>
    <div class="action-right">
        <button id="btn-export-excel" class="glass-button admin-accent">
            <i class="icon">📥</i>
            <span>엑셀 다운로드</span>
        </button>
        <button id="btn-add-company" class="glass-button admin-primary">
            <i class="icon">➕</i>
            <span>거래처 추가</span>
        </button>
    </div>
</div>

<script type="module">
import downloadManager, { DOWNLOAD_TYPES } from '../../06.database/12_download_manager.js';

// 엑셀 다운로드 버튼
document.getElementById('btn-export-excel').addEventListener('click', async () => {
    await downloadManager.download({
        downloadType: DOWNLOAD_TYPES.ADMIN_ALL_COMPANIES,
        userRole: 'admin',
        userName: sessionStorage.getItem('userName'),
        format: 'excel'
    });
});
</script>
```

### 12.3 진행 상태 커스터마이징

```javascript
import { DownloadProgress } from '../../06.database/13_download_progress.js';

// 커스텀 진행 표시
const progress = new DownloadProgress();

progress.show();
progress.update(0, '데이터베이스 연결 중...');

await new Promise(resolve => setTimeout(resolve, 1000));
progress.update(25, '거래처 정보 수집 중...');

await new Promise(resolve => setTimeout(resolve, 1000));
progress.update(50, '보고서 데이터 수집 중...');

await new Promise(resolve => setTimeout(resolve, 1000));
progress.update(75, '엑셀 파일 생성 중...');

await new Promise(resolve => setTimeout(resolve, 1000));
progress.update(100, '다운로드 완료!');
progress.showSuccess();

setTimeout(() => {
    progress.hide();
}, 2000);
```

### 12.4 에러 처리

```javascript
import downloadManager, { DOWNLOAD_TYPES } from '../../06.database/12_download_manager.js';
import { showToast } from '../../01.common/06_toast.js';

async function handleDownload() {
    try {
        const result = await downloadManager.download({
            downloadType: DOWNLOAD_TYPES.SALES_COMPANIES,
            userRole: sessionStorage.getItem('userRole'),
            userName: sessionStorage.getItem('userName'),
            format: 'excel'
        });
        
        if (result.success) {
            console.log('다운로드 성공');
        } else {
            throw new Error(result.error);
        }
        
    } catch (error) {
        console.error('다운로드 실패:', error);
        showToast('다운로드 중 오류가 발생했습니다: ' + error.message, 'error');
    }
}
```

### 12.5 날짜 범위 선택기 연동

```javascript
// 날짜 범위 선택 UI
const startDateInput = document.getElementById('start-date');
const endDateInput = document.getElementById('end-date');
const downloadBtn = document.getElementById('btn-download');

downloadBtn.addEventListener('click', async () => {
    const dateRange = {
        start: startDateInput.value,
        end: endDateInput.value
    };
    
    if (!dateRange.start || !dateRange.end) {
        showToast('날짜 범위를 선택해주세요', 'warning');
        return;
    }
    
    await downloadManager.download({
        downloadType: DOWNLOAD_TYPES.SALES_REPORTS,
        userRole: sessionStorage.getItem('userRole'),
        userName: sessionStorage.getItem('userName'),
        dateRange: dateRange,
        format: 'excel'
    });
});
```

### 12.6 다중 시트 선택 UI

```html
<div class="download-options-modal glass-panel">
    <h3>📥 다운로드 옵션</h3>
    
    <div class="sheet-selection">
        <label>
            <input type="checkbox" id="include-companies" checked disabled>
            <span>거래처 정보</span>
        </label>
        <label>
            <input type="checkbox" id="include-reports" checked>
            <span>방문보고서</span>
        </label>
        <label>
            <input type="checkbox" id="include-kpi">
            <span>실적 데이터</span>
        </label>
    </div>
    
    <div class="modal-actions">
        <button class="glass-button" onclick="closeModal()">취소</button>
        <button class="glass-button primary" onclick="startDownload()">다운로드</button>
    </div>
</div>

<script>
function startDownload() {
    const includeSheets = [];
    
    if (document.getElementById('include-companies').checked) {
        includeSheets.push('기본정보');
    }
    if (document.getElementById('include-reports').checked) {
        includeSheets.push('방문보고서');
    }
    if (document.getElementById('include-kpi').checked) {
        includeSheets.push('영업실적');
    }
    
    downloadManager.download({
        downloadType: DOWNLOAD_TYPES.SALES_ALL,
        userRole: sessionStorage.getItem('userRole'),
        userName: sessionStorage.getItem('userName'),
        includeSheets: includeSheets,
        format: 'excel'
    });
    
    closeModal();
}
</script>
```

---

## 📝 13. 디버깅 가이드

### 13.1 일반적인 문제 해결

#### 문제: 다운로드 버튼 클릭 시 반응 없음

```javascript
// 콘솔에서 확인
console.log('DownloadManager:', window.downloadManager);
console.log('User Role:', sessionStorage.getItem('userRole'));
console.log('User Name:', sessionStorage.getItem('userName'));

// 이벤트 리스너 확인
const btn = document.getElementById('btn-download');
console.log('Button:', btn);
console.log('Event Listeners:', getEventListeners(btn));
```

#### 문제: 권한 오류

```javascript
// 권한 확인
import { PERMISSION_MAP } from '../../06.database/12_download_manager.js';

const userRole = sessionStorage.getItem('userRole');
const downloadType = 'sales_companies';

const permissions = PERMISSION_MAP[userRole] || [];
console.log('User Permissions:', permissions);
console.log('Has Permission:', permissions.includes(downloadType));
```

#### 문제: 데이터가 비어있음

```javascript
// 데이터 확인
import { openDB } from 'idb';

const db = await openDB('KuwotechSalesDB', 1);
const tx = db.transaction('companies', 'readonly');
const companies = await tx.objectStore('companies').getAll();

console.log('Total Companies:', companies.length);
console.log('Sample Data:', companies[0]);
```

### 13.2 성능 최적화

```javascript
// 대용량 데이터 처리
async function downloadLargeDataset() {
    const CHUNK_SIZE = 1000;
    let offset = 0;
    let allData = [];
    
    while (true) {
        const chunk = await fetchDataChunk(offset, CHUNK_SIZE);
        if (chunk.length === 0) break;
        
        allData = allData.concat(chunk);
        offset += CHUNK_SIZE;
        
        // 진행 상태 업데이트
        const progress = (offset / totalCount) * 100;
        progressUI.update(progress, `${offset}/${totalCount} 처리 중...`);
    }
    
    return allData;
}
```

### 13.3 브라우저 호환성

```javascript
// XLSX 라이브러리 확인
if (typeof XLSX === 'undefined') {
    console.error('XLSX 라이브러리가 로드되지 않았습니다');
    showToast('엑셀 기능을 사용할 수 없습니다', 'error');
    return;
}

// IndexedDB 확인
if (!window.indexedDB) {
    console.error('브라우저가 IndexedDB를 지원하지 않습니다');
    showToast('이 브라우저는 지원되지 않습니다', 'error');
    return;
}
```

---

**문서 끝**

이 문서는 KUWOTECH 영업관리 시스템의 다운로드 시스템 통합 구현을 위한 완전한 가이드입니다.

**작성일**: 2025-09-30  
**최종 수정일**: 2025-09-30  
**작성자**: System  
**버전**: 1.0  
**상태**: ✅ 작성완료
