# 💻 코드 작성 규칙

> **작성일**: 2025-09-26  
> **목적**: 일관되고 유지보수 가능한 코드 작성

---

## 📝 코드 연결성 규칙

### 모듈 간 통합
```javascript
// [통합: 로그인 → 모드 → 데이터]

// 1. 로그인 완료 후
login.js → auth.js → mode 선택

// 2. 모드 진입
sales.html / admin.html 로드

// 3. 데이터 연결
IndexedDB 조회 → 화면 표시
```

### import/export 규칙
```javascript
// [공통 모듈 export]
// 01.common/03_format.js
export function formatNumber(num) {
  return num.toLocaleString('ko-KR');
}

export function formatDate(date) {
  return date.toISOString().split('T')[0];
}

// [다른 파일에서 import]
// 03.sales_mode/01_dashboard/02_dashboard.js
import { formatNumber, formatDate } from '../../01.common/03_format.js';
```

---

## 🏗️ 변수 명명 규칙

### camelCase (일반 변수)
```javascript
const userName = '김영업';
const totalSales = 1234567;
const isActive = true;
```

### UPPER_SNAKE_CASE (상수)
```javascript
const MAX_RETRIES = 3;
const API_ENDPOINT = 'https://api.example.com';
const DEFAULT_TIMEOUT = 5000;
```

### PascalCase (클래스)
```javascript
class KpiCalculator {
  constructor() {}
}

class DataSyncManager {
  constructor() {}
}
```

### kebab-case (파일명)
```
01_my-companies.html
02_report-write.js
03_data-management.css
```

---

## 📦 함수 작성 규칙

### 함수 주석 (JSDoc)
```javascript
/**
 * [기능: KPI 계산]
 * 영업담당자의 KPI를 계산합니다
 * 
 * @param {string} userId - 사용자 ID
 * @param {Object} data - 거래처 데이터
 * @returns {Object} KPI 결과
 */
async function calculateKPI(userId, data) {
  // 구현
}
```

### 비동기 함수
```javascript
// [비동기: 데이터 로드]
async function loadCompanies() {
  try {
    const db = await openDatabase();
    const companies = await db.getAll('companies');
    return companies;
  } catch (error) {
    console.error('[오류] 거래처 로드 실패:', error);
    throw error;
  }
}
```

### 화살표 함수
```javascript
// [이벤트: 버튼 클릭]
button.addEventListener('click', () => {
  console.log('[이벤트] 버튼 클릭됨');
  handleButtonClick();
});

// [배열 처리]
const activeCompanies = companies.filter(c => c.status === '활성');
```

---

## 🔍 주석 규칙

### 섹션 주석
```javascript
// ============================================
// [섹션: 데이터 로드]
// ============================================

async function loadData() {
  // ...
}

// ============================================
// [섹션: 화면 표시]
// ============================================

function renderUI() {
  // ...
}
```

### 기능 주석
```javascript
// [기능: 숫자 포맷팅]
function formatNumber(num) {
  return num.toLocaleString('ko-KR');
}

// [기능: 날짜 포맷팅]
function formatDate(date) {
  return date.toISOString().split('T')[0];
}
```

### 중요 주석
```javascript
// ⚠️ [중요] 기존 데이터 삭제 주의
await db.clear();

// 🔴 [필수] 권한 체크 필요
if (!user.isAdmin) {
  throw new Error('권한 없음');
}

// ✅ [완료] 테스트 완료
const result = await validateData();
```

---

## 🎯 에러 처리

### try-catch 사용
```javascript
// [에러: 데이터베이스 접근]
async function saveData(data) {
  try {
    const db = await openDatabase();
    await db.add('companies', data);
    console.log('[성공] 데이터 저장 완료');
  } catch (error) {
    console.error('[오류] 데이터 저장 실패:', error);
    showErrorMessage('저장에 실패했습니다.');
    throw error;
  }
}
```

### 사용자 친화적 메시지
```javascript
// ❌ 나쁜 예
alert('Error: IndexedDB transaction failed');

// ✅ 좋은 예
showToast('데이터 저장에 실패했습니다. 다시 시도해주세요.', 'error');
```

---

## 🔄 비동기 처리

### async/await 사용
```javascript
// [비동기: 순차 처리]
async function processData() {
  const data1 = await fetchData1();
  const data2 = await fetchData2(data1);
  const result = await processResult(data2);
  return result;
}
```

### Promise.all 사용
```javascript
// [비동기: 병렬 처리]
async function loadAllData() {
  const [companies, reports, employees] = await Promise.all([
    loadCompanies(),
    loadReports(),
    loadEmployees()
  ]);
  
  return { companies, reports, employees };
}
```

---

## 🛡️ 데이터 검증

### 입력 검증
```javascript
// [검증: 사용자 입력]
function validateInput(data) {
  // 필수 필드 체크
  if (!data.companyName) {
    throw new Error('거래처명은 필수입니다.');
  }
  
  // 타입 체크
  if (typeof data.salesAmount !== 'number') {
    throw new Error('매출액은 숫자여야 합니다.');
  }
  
  // 범위 체크
  if (data.salesAmount < 0) {
    throw new Error('매출액은 0 이상이어야 합니다.');
  }
  
  return true;
}
```

---

## 🎨 DOM 조작

### 요소 선택
```javascript
// [DOM: 요소 선택]
const button = document.getElementById('submitBtn');
const modal = document.querySelector('.modal');
const items = document.querySelectorAll('.list-item');
```

### 이벤트 리스너
```javascript
// [이벤트: 버튼 클릭]
button.addEventListener('click', async (event) => {
  event.preventDefault();
  
  // 로딩 표시
  button.disabled = true;
  button.textContent = '처리 중...';
  
  try {
    await processData();
    showToast('처리 완료', 'success');
  } catch (error) {
    showToast('처리 실패', 'error');
  } finally {
    button.disabled = false;
    button.textContent = '제출';
  }
});
```

---

## 📊 데이터 처리

### 배열 메서드
```javascript
// [데이터: 필터링]
const activeCompanies = companies.filter(c => c.status === '활성');

// [데이터: 매핑]
const companyNames = companies.map(c => c.name);

// [데이터: 집계]
const totalSales = companies.reduce((sum, c) => sum + c.sales, 0);

// [데이터: 정렬]
const sorted = companies.sort((a, b) => b.sales - a.sales);
```

### 객체 처리
```javascript
// [데이터: 구조 분해]
const { name, sales, status } = company;

// [데이터: 스프레드]
const updated = { ...company, status: '활성' };

// [데이터: 병합]
const merged = Object.assign({}, defaults, userInput);
```

---

## 🔧 유틸리티 함수

### 디바운스
```javascript
// [유틸: 디바운스]
function debounce(func, delay) {
  let timeout;
  return function(...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), delay);
  };
}

// 사용
const searchInput = document.getElementById('search');
searchInput.addEventListener('input', debounce(handleSearch, 300));
```

### 쓰로틀
```javascript
// [유틸: 쓰로틀]
function throttle(func, limit) {
  let inThrottle;
  return function(...args) {
    if (!inThrottle) {
      func.apply(this, args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

// 사용
window.addEventListener('scroll', throttle(handleScroll, 100));
```

---

## 🗄️ IndexedDB 사용

### 데이터베이스 열기
```javascript
// [DB: 연결]
async function openDatabase() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open('KuwotechSalesDB', 1);
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
    
    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      
      // 스토어 생성
      if (!db.objectStoreNames.contains('companies')) {
        const store = db.createObjectStore('companies', { keyPath: 'keyValue' });
        store.createIndex('internalManager', 'internalManager');
        store.createIndex('businessStatus', 'businessStatus');
      }
    };
  });
}
```

### CRUD 작업
```javascript
// [DB: 생성]
async function createCompany(data) {
  const db = await openDatabase();
  const tx = db.transaction('companies', 'readwrite');
  await tx.objectStore('companies').add(data);
  await tx.complete;
}

// [DB: 조회]
async function getCompany(keyValue) {
  const db = await openDatabase();
  const tx = db.transaction('companies', 'readonly');
  return await tx.objectStore('companies').get(keyValue);
}

// [DB: 수정]
async function updateCompany(data) {
  const db = await openDatabase();
  const tx = db.transaction('companies', 'readwrite');
  await tx.objectStore('companies').put(data);
  await tx.complete;
}

// [DB: 삭제]
async function deleteCompany(keyValue) {
  const db = await openDatabase();
  const tx = db.transaction('companies', 'readwrite');
  await tx.objectStore('companies').delete(keyValue);
  await tx.complete;
}
```

---

## 📋 코드 리뷰 체크리스트

### 기본 체크
- [ ] 주석이 명확한가?
- [ ] 변수명이 직관적인가?
- [ ] 함수가 단일 책임을 가지는가?
- [ ] 에러 처리가 되어 있는가?

### 성능 체크
- [ ] 불필요한 반복문이 없는가?
- [ ] 메모리 누수 가능성은 없는가?
- [ ] 비동기 처리가 적절한가?

### 보안 체크
- [ ] 입력 검증이 되어 있는가?
- [ ] XSS 취약점은 없는가?
- [ ] 민감 정보 노출은 없는가?

---

## 🚀 성능 최적화

### 리플로우/리페인트 최소화
```javascript
// ❌ 나쁜 예 (여러 번 DOM 조작)
for (let i = 0; i < 1000; i++) {
  const div = document.createElement('div');
  div.textContent = i;
  container.appendChild(div);
}

// ✅ 좋은 예 (한 번에 DOM 조작)
const fragment = document.createDocumentFragment();
for (let i = 0; i < 1000; i++) {
  const div = document.createElement('div');
  div.textContent = i;
  fragment.appendChild(div);
}
container.appendChild(fragment);
```

### 이벤트 위임
```javascript
// ❌ 나쁜 예 (각 요소에 리스너)
items.forEach(item => {
  item.addEventListener('click', handleClick);
});

// ✅ 좋은 예 (부모에 한 번만)
container.addEventListener('click', (e) => {
  if (e.target.classList.contains('item')) {
    handleClick(e);
  }
});
```

---

**일관된 코드 스타일로 유지보수성을 높입니다!**
