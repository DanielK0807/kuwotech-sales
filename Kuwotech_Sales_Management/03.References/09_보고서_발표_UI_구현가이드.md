# 보고서 발표 UI 구현 가이드

**프로젝트**: KUWOTECH 영업관리시스템
**작성일**: 2025-10-08
**대상 화면**: 관리자모드 - 보고서 발표
**목적**: 보고서 발표 화면의 구체적인 구현 방법 가이드

---

## 📋 목차

1. [화면 레이아웃 구조](#1-화면-레이아웃-구조)
2. [HTML 구조 설계](#2-html-구조-설계)
3. [CSS 스타일링 가이드](#3-css-스타일링-가이드)
4. [JavaScript 인터랙션](#4-javascript-인터랙션)
5. [컴포넌트별 구현](#5-컴포넌트별-구현)
6. [데이터 처리 로직](#6-데이터-처리-로직)
7. [반응형 디자인](#7-반응형-디자인)
8. [접근성 고려사항](#8-접근성-고려사항)

---

## 1. 화면 레이아웃 구조

### 1-1. 전체 레이아웃 구성도

```
┌─────────────────────────────────────────────────────────────┐
│ Header (고정)                                    [🔄 새로고침]│
│ - 타이틀: 📊 보고서 발표                                    │
├─────────────────────────────────────────────────────────────┤
│ Filter Area (고정)                                          │
│ - 기간 선택: 금주/월간/년간 (라디오 버튼)                  │
│ - 담당부서: 텍스트 입력                                     │
│ - 내부담당자: 텍스트 입력                                   │
│ - 조회하기 버튼                                              │
├─────────────────────────────────────────────────────────────┤
│ Period Display (고정)                                        │
│ - 📅 기간: YYYY년 MM월 DD일 ~ YYYY년 MM월 DD일            │
├─────────────────────────────────────────────────────────────┤
│ Report Table (스크롤 가능)                                   │
│ ┌───────────────────────────────────────────────────────┐   │
│ │ 테이블 헤더 (15개 컬럼)                                │   │
│ ├───────────────────────────────────────────────────────┤   │
│ │ 담당자별 그룹 (아코디언)                               │   │
│ │ ▼ 강민 - 보고서 3건                                   │   │
│ │   ├─ 보고서 1                                         │   │
│ │   ├─ 보고서 2                                         │   │
│ │   ├─ 보고서 3                                         │   │
│ │   └─ 💰 소계                                          │   │
│ │ ▶ 김철수 - 보고서 2건 (접혀있음)                      │   │
│ └───────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│ Summary Area (고정)                                          │
│ - 💰 전체 총합                                              │
│ - 담당자 수, 보고서 수, 수금/매출 합계 및 달성률            │
├─────────────────────────────────────────────────────────────┤
│ Footer (고정)                                                │
│ - CSV 다운로드, 인쇄 버튼                                    │
└─────────────────────────────────────────────────────────────┘
```

### 1-2. 화면 영역 비율

```
┌─────────────────┐
│ Header: 60px    │ (고정)
├─────────────────┤
│ Filter: 120px   │ (고정)
├─────────────────┤
│ Period: 40px    │ (고정)
├─────────────────┤
│                 │
│ Table:          │ (스크롤 가능)
│ calc(100vh -    │
│ 340px)          │
│                 │
├─────────────────┤
│ Summary: 80px   │ (고정)
├─────────────────┤
│ Footer: 40px    │ (고정)
└─────────────────┘
```

---

## 2. HTML 구조 설계

### 2-1. 전체 컨테이너 구조

```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>보고서 발표 - KUWOTECH 영업관리 시스템</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="../../07.styles/00_root.css">
    <link rel="stylesheet" href="../../07.styles/01_variables.css">
    <link rel="stylesheet" href="../../07.styles/02_common.css">
    <link rel="stylesheet" href="../../07.styles/03_glassmorphism.css">
    <link rel="stylesheet" href="../../07.styles/07_theme_colors.css">
    <link rel="stylesheet" href="../../07.styles/04_components.css">
</head>
<body class="theme-admin viewport-3d" data-page-type="report-presentation">

<div class="presentation-container">
    <!-- Header -->
    <header class="page-header bg-layer-1 glass-panel glass-layered glass-shimmer">
        <div class="header-content">
            <div class="header-text">
                <h1 class="text-on-layer-1">📊 보고서 발표</h1>
                <p class="subtitle text-on-layer-1">담당자별 실적 현황을 확인하세요</p>
            </div>
            <button id="btnRefresh" class="btn-refresh glass-button">
                🔄 새로고침
            </button>
        </div>
    </header>

    <!-- Filter Area -->
    <section class="filter-area glass-card glass-3d-element">
        <div class="filter-row">
            <div class="filter-group">
                <label class="filter-label">기간</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="period" value="weekly" checked>
                        <span>금주</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="period" value="monthly">
                        <span>월간</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="period" value="yearly">
                        <span>년간</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-group">
                <label class="filter-label" for="departmentFilter">담당부서</label>
                <input type="text" id="departmentFilter" class="glass-input" placeholder="부서명 입력">
            </div>

            <div class="filter-group">
                <label class="filter-label" for="employeeFilter">내부담당자</label>
                <input type="text" id="employeeFilter" class="glass-input" placeholder="담당자명 입력">
            </div>

            <button id="btnApplyFilter" class="btn-primary glass-button">
                📊 조회하기
            </button>
        </div>
    </section>

    <!-- Period Display -->
    <section class="period-display glass-card">
        <p class="period-text">
            📅 기간: <span id="periodRange">2025년 10월 07일 ~ 2025년 10월 13일</span>
        </p>
    </section>

    <!-- Report Table -->
    <section class="report-table-section glass-card glass-3d-element">
        <div class="table-wrapper">
            <table class="report-table" id="reportTable">
                <thead>
                    <tr>
                        <th>보고서<br>제출일</th>
                        <th>담당<br>부서</th>
                        <th>내부<br>담당</th>
                        <th>거래처명</th>
                        <th>대표이사<br>(치과의사)</th>
                        <th>목표<br>수금금액</th>
                        <th>실제<br>수금금액</th>
                        <th>달성률</th>
                        <th>목표<br>매출금액</th>
                        <th>실제<br>매출금액</th>
                        <th>달성률</th>
                        <th>영업활동<br>(특이사항)</th>
                        <th>이행<br>여부</th>
                        <th>누적<br>매출액</th>
                        <th>누적<br>수금액</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody">
                    <!-- 동적으로 생성 -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Summary Area -->
    <section class="summary-area glass-card glass-3d-element">
        <h3>💰 전체 총합</h3>
        <div class="summary-grid">
            <div class="summary-item">
                <span class="summary-label">담당자:</span>
                <span class="summary-value" id="totalEmployees">0명</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">보고서:</span>
                <span class="summary-value" id="totalReports">0건</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">목표수금:</span>
                <span class="summary-value" id="totalTargetCollection">0원</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">실제수금:</span>
                <span class="summary-value" id="totalActualCollection">0원</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">수금달성률:</span>
                <span class="summary-value" id="collectionRate">0%</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">목표매출:</span>
                <span class="summary-value" id="totalTargetSales">0원</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">실제매출:</span>
                <span class="summary-value" id="totalActualSales">0원</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">매출달성률:</span>
                <span class="summary-value" id="salesRate">0%</span>
            </div>
        </div>
    </section>

    <!-- Footer Actions -->
    <footer class="page-footer">
        <button id="btnDownloadCSV" class="btn-secondary glass-button">
            📥 CSV 다운로드
        </button>
        <button id="btnPrint" class="btn-secondary glass-button">
            🖨️ 인쇄
        </button>
    </footer>
</div>

<script type="module" src="02_report_presentation.js"></script>
</body>
</html>
```

### 2-2. 테이블 행 구조 (담당자별 그룹)

#### 그룹 헤더 행 (접혀있을 때)

```html
<tr class="group-header collapsed" data-employee="강민">
    <td colspan="15" class="group-header-cell">
        <div class="group-header-content">
            <button class="toggle-btn" aria-label="펼치기/접기">▶</button>
            <span class="employee-info">
                <strong>👤 강민</strong> (해외영업팀) - 보고서 3건
            </span>
            <span class="group-summary">
                수금: 93% | 매출: 92%
            </span>
        </div>
    </td>
</tr>
```

#### 그룹 헤더 행 (펼쳐졌을 때)

```html
<tr class="group-header expanded" data-employee="강민">
    <td colspan="15" class="group-header-cell">
        <div class="group-header-content">
            <button class="toggle-btn" aria-label="펼치기/접기">▼</button>
            <span class="employee-info">
                <strong>👤 강민</strong> (해외영업팀) - 보고서 3건
            </span>
            <span class="group-summary">
                수금: 93% | 매출: 92%
            </span>
        </div>
    </td>
</tr>
```

#### 보고서 행 (상세 데이터)

```html
<tr class="report-row" data-employee="강민" style="display: none;">
    <td>2025-10-11</td>
    <td>해외영업팀</td>
    <td>강민</td>
    <td>삼성치과</td>
    <td>김철수</td>
    <td class="amount">5,000,000원</td>
    <td class="amount">4,500,000원</td>
    <td class="rate good">90%</td>
    <td class="amount">10,000,000원</td>
    <td class="amount">9,000,000원</td>
    <td class="rate good">90%</td>
    <td class="activity">임플란트 상담 및 견적서 전달</td>
    <td class="status">
        <span class="badge badge-success">✅ 완료</span>
    </td>
    <td class="amount">50,000,000원</td>
    <td class="amount">45,000,000원</td>
</tr>
```

#### 소계 행

```html
<tr class="subtotal-row" data-employee="강민" style="display: none;">
    <td colspan="5" class="subtotal-label">💰 소계 (강민)</td>
    <td class="amount">10,000,000원</td>
    <td class="amount">9,300,000원</td>
    <td class="rate good">93%</td>
    <td class="amount">24,000,000원</td>
    <td class="amount">22,000,000원</td>
    <td class="rate good">92%</td>
    <td colspan="4"></td>
</tr>
```

---

## 3. CSS 스타일링 가이드

### 3-1. 레이아웃 스타일

```css
/* 메인 컨테이너 */
.presentation-container {
    width: 100%;
    max-width: 1800px;
    margin: 0 auto;
    padding: var(--spacing-xl);
    min-height: 100vh;
}

/* 헤더 */
.page-header {
    position: sticky;
    top: 0;
    z-index: 1000;
    padding: var(--spacing-xl) 0;
    margin-bottom: var(--spacing-2xl);
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-lg);
    width: 95%;
    margin: 0 auto;
}

.header-text h1 {
    font-size: calc(var(--font-3xl) + 2px);
    font-weight: var(--font-weight-bold);
    color: var(--text-on-layer-1);
}

.btn-refresh {
    color: var(--text-on-layer-1);
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    padding: var(--spacing-md) var(--spacing-xl);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-refresh:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}
```

### 3-2. 필터 영역 스타일

```css
/* 필터 영역 */
.filter-area {
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-lg);
}

.filter-row {
    display: flex;
    align-items: flex-end;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-md);
}

.filter-row:last-child {
    margin-bottom: 0;
}

.filter-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.filter-label {
    font-weight: var(--font-weight-medium);
    font-size: var(--font-sm);
    color: var(--text-primary);
}

/* 라디오 버튼 그룹 */
.radio-group {
    display: flex;
    gap: var(--spacing-lg);
}

.radio-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    cursor: pointer;
    font-size: var(--font-md);
}

.radio-label input[type="radio"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.radio-label span {
    user-select: none;
}

/* 입력 필드 */
.glass-input {
    padding: var(--spacing-md);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-md);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    font-size: var(--font-md);
}

.glass-input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* 조회 버튼 */
.btn-primary {
    padding: var(--spacing-md) var(--spacing-2xl);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-size: var(--font-md);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.btn-primary:hover {
    background: var(--color-primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}
```

### 3-3. 기간 표시 스타일

```css
.period-display {
    padding: var(--spacing-md) var(--spacing-xl);
    margin-bottom: var(--spacing-lg);
    text-align: center;
}

.period-text {
    font-size: var(--font-md);
    font-weight: var(--font-weight-medium);
    color: var(--text-primary);
}

.period-text span {
    color: var(--color-primary);
    font-weight: var(--font-weight-bold);
}
```

### 3-4. 테이블 스타일

```css
/* 테이블 섹션 */
.report-table-section {
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
    overflow: hidden;
}

.table-wrapper {
    overflow-x: auto;
    overflow-y: auto;
    max-height: calc(100vh - 450px);
}

/* 테이블 기본 스타일 */
.report-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-sm);
    background: var(--bg-primary);
}

/* 테이블 헤더 */
.report-table thead {
    position: sticky;
    top: 0;
    z-index: 10;
    background: var(--bg-layer-1);
}

.report-table th {
    padding: var(--spacing-md);
    text-align: center;
    font-weight: var(--font-weight-bold);
    color: var(--text-on-layer-1);
    border: 1px solid var(--border-primary);
    white-space: nowrap;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(37, 99, 235, 0.8));
}

/* 테이블 바디 */
.report-table tbody tr {
    transition: background-color 0.2s ease;
}

.report-table tbody tr:hover {
    background: rgba(59, 130, 246, 0.05);
}

.report-table td {
    padding: var(--spacing-md);
    text-align: center;
    border: 1px solid var(--border-primary);
    color: var(--text-primary);
}

/* 그룹 헤더 */
.group-header {
    background: rgba(59, 130, 246, 0.1);
    cursor: pointer;
}

.group-header:hover {
    background: rgba(59, 130, 246, 0.15);
}

.group-header-cell {
    padding: var(--spacing-lg) var(--spacing-md) !important;
}

.group-header-content {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    font-weight: var(--font-weight-medium);
}

.toggle-btn {
    background: none;
    border: none;
    font-size: var(--font-lg);
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-primary);
    transition: transform 0.3s ease;
}

.group-header.expanded .toggle-btn {
    transform: rotate(90deg);
}

.employee-info {
    flex: 1;
    text-align: left;
}

.employee-info strong {
    font-size: var(--font-md);
    color: var(--color-primary);
}

.group-summary {
    font-size: var(--font-sm);
    color: var(--text-secondary);
}

/* 보고서 행 */
.report-row td {
    font-size: var(--font-sm);
}

/* 금액 표시 */
.amount {
    text-align: right !important;
    font-family: 'Courier New', monospace;
    font-weight: var(--font-weight-medium);
}

/* 달성률 표시 */
.rate {
    font-weight: var(--font-weight-bold);
}

.rate.excellent {
    color: #10b981; /* 100% 이상 */
}

.rate.good {
    color: #3b82f6; /* 80-99% */
}

.rate.warning {
    color: #f59e0b; /* 60-79% */
}

.rate.poor {
    color: #ef4444; /* 60% 미만 */
}

/* 영업활동 */
.activity {
    text-align: left !important;
    max-width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* 이행여부 배지 */
.status {
    text-align: center !important;
}

.badge {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: var(--font-xs);
    font-weight: var(--font-weight-medium);
}

.badge-success {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
}

.badge-warning {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.badge-danger {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

/* 소계 행 */
.subtotal-row {
    background: rgba(59, 130, 246, 0.08);
    font-weight: var(--font-weight-bold);
}

.subtotal-label {
    text-align: left !important;
    padding-left: var(--spacing-2xl) !important;
}
```

### 3-5. 요약 영역 스타일

```css
.summary-area {
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-lg);
}

.summary-area h3 {
    font-size: var(--font-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    margin-bottom: var(--spacing-lg);
    text-align: center;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-lg);
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md);
    background: rgba(59, 130, 246, 0.05);
    border-radius: var(--radius-md);
    border-left: 3px solid var(--color-primary);
}

.summary-label {
    font-size: var(--font-sm);
    font-weight: var(--font-weight-medium);
    color: var(--text-secondary);
}

.summary-value {
    font-size: var(--font-lg);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
}
```

### 3-6. 푸터 스타일

```css
.page-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-md);
    padding: var(--spacing-lg);
}

.btn-secondary {
    padding: var(--spacing-md) var(--spacing-xl);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-md);
    font-size: var(--font-md);
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
}
```

---

## 4. JavaScript 인터랙션

### 4-1. 초기화 및 상태 관리

```javascript
import ApiManager from '../../01.common/13_api_manager.js';

// ============================================
// 전역 변수
// ============================================
const apiManager = new ApiManager();

let allReports = [];           // 전체 보고서 데이터
let filteredReports = [];      // 필터링된 보고서
let groupedReports = {};       // 담당자별 그룹화된 데이터
let currentPeriod = 'weekly';  // 현재 선택된 기간
let currentFilters = {
    period: 'weekly',
    department: '',
    employee: ''
};

// ============================================
// 초기화
// ============================================
async function init() {
    console.log('📊 보고서 발표 페이지 초기화...');

    // 이벤트 리스너 등록
    setupEventListeners();

    // 초기 데이터 로드
    await loadReports();
}

function setupEventListeners() {
    // 필터 변경 이벤트
    const periodRadios = document.querySelectorAll('input[name="period"]');
    periodRadios.forEach(radio => {
        radio.addEventListener('change', handlePeriodChange);
    });

    // 조회 버튼
    const btnApplyFilter = document.getElementById('btnApplyFilter');
    btnApplyFilter?.addEventListener('click', handleApplyFilter);

    // 새로고침 버튼
    const btnRefresh = document.getElementById('btnRefresh');
    btnRefresh?.addEventListener('click', handleRefresh);

    // CSV 다운로드
    const btnDownloadCSV = document.getElementById('btnDownloadCSV');
    btnDownloadCSV?.addEventListener('click', handleDownloadCSV);

    // 인쇄
    const btnPrint = document.getElementById('btnPrint');
    btnPrint?.addEventListener('click', handlePrint);
}
```

### 4-2. 데이터 로드

```javascript
/**
 * 보고서 데이터 로드
 */
async function loadReports() {
    try {
        console.log('📋 보고서 데이터 로드 중...');

        // 기간 계산
        const dateRange = calculateDateRange(currentFilters.period);

        // API 호출
        const response = await apiManager.getReports({
            startDate: dateRange.start,
            endDate: dateRange.end
        });

        // 데이터 파싱
        if (response && response.data && Array.isArray(response.data.reports)) {
            allReports = response.data.reports;
        } else {
            allReports = [];
        }

        console.log(`✅ 보고서 ${allReports.length}건 로드 완료`);

        // 필터 적용 및 렌더링
        applyFiltersAndRender();

    } catch (error) {
        console.error('❌ 보고서 로드 실패:', error);
        alert('보고서 데이터를 불러오는데 실패했습니다.');
    }
}

/**
 * 기간 범위 계산
 */
function calculateDateRange(period) {
    const today = new Date();
    let start, end;

    switch (period) {
        case 'weekly':
            // 금주: 이번 주 월요일 ~ 일요일
            start = getMonday(today);
            end = getSunday(today);
            break;

        case 'monthly':
            // 월간: 현재 월 1일 ~ 현재
            start = new Date(today.getFullYear(), today.getMonth(), 1);
            end = today;
            break;

        case 'yearly':
            // 년간: 1월 1일 ~ 현재
            start = new Date(today.getFullYear(), 0, 1);
            end = today;
            break;
    }

    return {
        start: start.toISOString().split('T')[0],
        end: end.toISOString().split('T')[0]
    };
}

function getMonday(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    return new Date(d.setDate(diff));
}

function getSunday(date) {
    const monday = getMonday(date);
    return new Date(monday.getTime() + 6 * 24 * 60 * 60 * 1000);
}
```

### 4-3. 필터링 및 그룹화

```javascript
/**
 * 필터 적용 및 렌더링
 */
function applyFiltersAndRender() {
    // 필터 적용
    filteredReports = allReports.filter(report => {
        if (currentFilters.department && !report.department?.includes(currentFilters.department)) {
            return false;
        }
        if (currentFilters.employee && !report.submittedBy?.includes(currentFilters.employee)) {
            return false;
        }
        return true;
    });

    // 담당자별 그룹화
    groupedReports = groupByEmployee(filteredReports);

    // UI 렌더링
    renderPeriodDisplay();
    renderReportTable();
    renderSummary();
}

/**
 * 담당자별 그룹화
 */
function groupByEmployee(reports) {
    const grouped = {};

    reports.forEach(report => {
        const employee = report.submittedBy;
        if (!grouped[employee]) {
            grouped[employee] = {
                employee: employee,
                department: report.department || '미분류',
                reports: [],
                subtotal: {
                    targetCollection: 0,
                    actualCollection: 0,
                    targetSales: 0,
                    actualSales: 0
                }
            };
        }

        grouped[employee].reports.push(report);
        grouped[employee].subtotal.targetCollection += Number(report.targetCollectionAmount) || 0;
        grouped[employee].subtotal.actualCollection += Number(report.actualCollectionAmount) || 0;
        grouped[employee].subtotal.targetSales += Number(report.targetSalesAmount) || 0;
        grouped[employee].subtotal.actualSales += Number(report.actualSalesAmount) || 0;
    });

    // 달성률 계산
    Object.values(grouped).forEach(group => {
        group.subtotal.collectionRate = calculateRate(
            group.subtotal.actualCollection,
            group.subtotal.targetCollection
        );
        group.subtotal.salesRate = calculateRate(
            group.subtotal.actualSales,
            group.subtotal.targetSales
        );
    });

    return grouped;
}

/**
 * 달성률 계산
 */
function calculateRate(actual, target) {
    if (!target || target === 0) return 0;
    return Math.round((actual / target) * 100);
}
```

### 4-4. 테이블 렌더링

```javascript
/**
 * 테이블 렌더링
 */
function renderReportTable() {
    const tbody = document.getElementById('reportTableBody');
    if (!tbody) return;

    // 빈 상태 체크
    if (Object.keys(groupedReports).length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="15" class="empty-state">
                    <p>📭 조회된 보고서가 없습니다</p>
                </td>
            </tr>
        `;
        return;
    }

    let html = '';

    // 담당자별로 렌더링
    Object.values(groupedReports).forEach(group => {
        // 그룹 헤더
        html += renderGroupHeader(group);

        // 보고서 행들
        group.reports.forEach(report => {
            html += renderReportRow(report, group.employee);
        });

        // 소계 행
        html += renderSubtotalRow(group);
    });

    tbody.innerHTML = html;

    // 토글 이벤트 등록
    attachToggleEvents();
}

/**
 * 그룹 헤더 렌더링
 */
function renderGroupHeader(group) {
    const reportCount = group.reports.length;
    const collectionRate = group.subtotal.collectionRate;
    const salesRate = group.subtotal.salesRate;

    return `
        <tr class="group-header collapsed" data-employee="${group.employee}">
            <td colspan="15" class="group-header-cell">
                <div class="group-header-content">
                    <button class="toggle-btn" aria-label="펼치기/접기">▶</button>
                    <span class="employee-info">
                        <strong>👤 ${group.employee}</strong> (${group.department}) - 보고서 ${reportCount}건
                    </span>
                    <span class="group-summary">
                        수금: ${collectionRate}% | 매출: ${salesRate}%
                    </span>
                </div>
            </td>
        </tr>
    `;
}

/**
 * 보고서 행 렌더링
 */
function renderReportRow(report, employee) {
    const collectionRate = calculateRate(report.actualCollectionAmount, report.targetCollectionAmount);
    const salesRate = calculateRate(report.actualSalesAmount, report.targetSalesAmount);

    return `
        <tr class="report-row" data-employee="${employee}" style="display: none;">
            <td>${formatDate(report.submittedDate)}</td>
            <td>${report.department || '-'}</td>
            <td>${report.submittedBy || '-'}</td>
            <td>${report.companyName || '-'}</td>
            <td>${report.companyManager || '-'}</td>
            <td class="amount">${formatCurrency(report.targetCollectionAmount)}</td>
            <td class="amount">${formatCurrency(report.actualCollectionAmount)}</td>
            <td class="rate ${getRateClass(collectionRate)}">${collectionRate}%</td>
            <td class="amount">${formatCurrency(report.targetSalesAmount)}</td>
            <td class="amount">${formatCurrency(report.actualSalesAmount)}</td>
            <td class="rate ${getRateClass(salesRate)}">${salesRate}%</td>
            <td class="activity" title="${getActivityText(report)}">${getActivityText(report)}</td>
            <td class="status">${getStatusBadge(report)}</td>
            <td class="amount">${formatCurrency(report.accumulatedSales)}</td>
            <td class="amount">${formatCurrency(report.accumulatedCollection)}</td>
        </tr>
    `;
}

/**
 * 소계 행 렌더링
 */
function renderSubtotalRow(group) {
    const subtotal = group.subtotal;

    return `
        <tr class="subtotal-row" data-employee="${group.employee}" style="display: none;">
            <td colspan="5" class="subtotal-label">💰 소계 (${group.employee})</td>
            <td class="amount">${formatCurrency(subtotal.targetCollection)}</td>
            <td class="amount">${formatCurrency(subtotal.actualCollection)}</td>
            <td class="rate ${getRateClass(subtotal.collectionRate)}">${subtotal.collectionRate}%</td>
            <td class="amount">${formatCurrency(subtotal.targetSales)}</td>
            <td class="amount">${formatCurrency(subtotal.actualSales)}</td>
            <td class="rate ${getRateClass(subtotal.salesRate)}">${subtotal.salesRate}%</td>
            <td colspan="4"></td>
        </tr>
    `;
}
```

### 4-5. 토글 기능

```javascript
/**
 * 토글 이벤트 등록
 */
function attachToggleEvents() {
    const groupHeaders = document.querySelectorAll('.group-header');

    groupHeaders.forEach(header => {
        header.addEventListener('click', handleToggleGroup);
    });
}

/**
 * 그룹 토글 핸들러
 */
function handleToggleGroup(event) {
    const header = event.currentTarget;
    const employee = header.dataset.employee;
    const isExpanded = header.classList.contains('expanded');

    // 관련 행들 찾기
    const relatedRows = document.querySelectorAll(`tr[data-employee="${employee}"]:not(.group-header)`);

    if (isExpanded) {
        // 접기
        header.classList.remove('expanded');
        header.classList.add('collapsed');
        relatedRows.forEach(row => {
            row.style.display = 'none';
        });
    } else {
        // 펼치기
        header.classList.remove('collapsed');
        header.classList.add('expanded');
        relatedRows.forEach(row => {
            row.style.display = '';
        });
    }
}
```

### 4-6. 요약 렌더링

```javascript
/**
 * 요약 정보 렌더링
 */
function renderSummary() {
    const employeeCount = Object.keys(groupedReports).length;
    const reportCount = filteredReports.length;

    let totalTargetCollection = 0;
    let totalActualCollection = 0;
    let totalTargetSales = 0;
    let totalActualSales = 0;

    filteredReports.forEach(report => {
        totalTargetCollection += Number(report.targetCollectionAmount) || 0;
        totalActualCollection += Number(report.actualCollectionAmount) || 0;
        totalTargetSales += Number(report.targetSalesAmount) || 0;
        totalActualSales += Number(report.actualSalesAmount) || 0;
    });

    const collectionRate = calculateRate(totalActualCollection, totalTargetCollection);
    const salesRate = calculateRate(totalActualSales, totalTargetSales);

    // UI 업데이트
    document.getElementById('totalEmployees').textContent = `${employeeCount}명`;
    document.getElementById('totalReports').textContent = `${reportCount}건`;
    document.getElementById('totalTargetCollection').textContent = formatCurrency(totalTargetCollection);
    document.getElementById('totalActualCollection').textContent = formatCurrency(totalActualCollection);
    document.getElementById('collectionRate').textContent = `${collectionRate}%`;
    document.getElementById('totalTargetSales').textContent = formatCurrency(totalTargetSales);
    document.getElementById('totalActualSales').textContent = formatCurrency(totalActualSales);
    document.getElementById('salesRate').textContent = `${salesRate}%`;
}
```

---

## 5. 컴포넌트별 구현

### 5-1. 기간 표시 컴포넌트

```javascript
/**
 * 기간 표시 렌더링
 */
function renderPeriodDisplay() {
    const dateRange = calculateDateRange(currentFilters.period);
    const periodText = formatDateRange(dateRange.start, dateRange.end);

    const periodRangeEl = document.getElementById('periodRange');
    if (periodRangeEl) {
        periodRangeEl.textContent = periodText;
    }
}

/**
 * 날짜 범위 포맷팅
 */
function formatDateRange(start, end) {
    const startDate = new Date(start);
    const endDate = new Date(end);

    const startStr = `${startDate.getFullYear()}년 ${startDate.getMonth() + 1}월 ${startDate.getDate()}일`;
    const endStr = `${endDate.getFullYear()}년 ${endDate.getMonth() + 1}월 ${endDate.getDate()}일`;

    return `${startStr} ~ ${endStr}`;
}
```

### 5-2. CSV 다운로드 기능

```javascript
/**
 * CSV 다운로드
 */
function handleDownloadCSV() {
    try {
        const csvData = generateCSVData();
        const blob = new Blob(['\ufeff' + csvData], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = url;
        link.download = `보고서발표_${formatDateForFilename(new Date())}.csv`;
        link.click();

        URL.revokeObjectURL(url);

        console.log('✅ CSV 다운로드 완료');
    } catch (error) {
        console.error('❌ CSV 다운로드 실패:', error);
        alert('CSV 다운로드에 실패했습니다.');
    }
}

/**
 * CSV 데이터 생성
 */
function generateCSVData() {
    const headers = [
        '보고서제출일', '담당부서', '내부담당자', '거래처명', '대표이사',
        '목표수금금액', '실제수금금액', '수금달성률',
        '목표매출금액', '실제매출금액', '매출달성률',
        '영업활동', '이행여부', '누적매출액', '누적수금액'
    ];

    let csv = headers.join(',') + '\n';

    Object.values(groupedReports).forEach(group => {
        group.reports.forEach(report => {
            const row = [
                formatDate(report.submittedDate),
                report.department || '-',
                report.submittedBy || '-',
                report.companyName || '-',
                report.companyManager || '-',
                report.targetCollectionAmount || 0,
                report.actualCollectionAmount || 0,
                calculateRate(report.actualCollectionAmount, report.targetCollectionAmount) + '%',
                report.targetSalesAmount || 0,
                report.actualSalesAmount || 0,
                calculateRate(report.actualSalesAmount, report.targetSalesAmount) + '%',
                `"${getActivityText(report).replace(/"/g, '""')}"`,
                getStatusText(report),
                report.accumulatedSales || 0,
                report.accumulatedCollection || 0
            ];
            csv += row.join(',') + '\n';
        });

        // 소계 행
        const subtotal = group.subtotal;
        const subtotalRow = [
            `소계 (${group.employee})`, '', '', '', '',
            subtotal.targetCollection,
            subtotal.actualCollection,
            subtotal.collectionRate + '%',
            subtotal.targetSales,
            subtotal.actualSales,
            subtotal.salesRate + '%',
            '', '', '', ''
        ];
        csv += subtotalRow.join(',') + '\n';
        csv += '\n'; // 빈 줄
    });

    return csv;
}
```

### 5-3. 인쇄 기능

```javascript
/**
 * 인쇄
 */
function handlePrint() {
    window.print();
}

// 인쇄 스타일 추가 (CSS)
const printStyles = `
@media print {
    .page-header,
    .filter-area,
    .page-footer {
        display: none;
    }

    .report-table-section {
        box-shadow: none;
        border: 1px solid #000;
    }

    .report-table {
        font-size: 10px;
    }

    .report-table th,
    .report-table td {
        padding: 4px;
        border: 1px solid #000;
    }

    .group-header {
        page-break-after: avoid;
    }

    .report-row,
    .subtotal-row {
        display: table-row !important;
    }
}
`;
```

---

## 6. 데이터 처리 로직

### 6-1. 이벤트 핸들러

```javascript
/**
 * 기간 변경 핸들러
 */
function handlePeriodChange(event) {
    currentFilters.period = event.target.value;
    console.log('기간 변경:', currentFilters.period);
}

/**
 * 필터 적용 핸들러
 */
async function handleApplyFilter() {
    // 입력값 가져오기
    currentFilters.department = document.getElementById('departmentFilter')?.value.trim() || '';
    currentFilters.employee = document.getElementById('employeeFilter')?.value.trim() || '';

    console.log('필터 적용:', currentFilters);

    // 데이터 다시 로드
    await loadReports();
}

/**
 * 새로고침 핸들러
 */
async function handleRefresh() {
    console.log('🔄 데이터 새로고침...');
    await loadReports();
}
```

### 6-2. 유틸리티 함수

```javascript
/**
 * 날짜 포맷팅
 */
function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

/**
 * 금액 포맷팅
 */
function formatCurrency(amount) {
    if (!amount || amount === 0) return '-';
    return Number(amount).toLocaleString('ko-KR') + '원';
}

/**
 * 달성률 클래스 반환
 */
function getRateClass(rate) {
    if (rate >= 100) return 'excellent';
    if (rate >= 80) return 'good';
    if (rate >= 60) return 'warning';
    return 'poor';
}

/**
 * 영업활동 텍스트 추출
 */
function getActivityText(report) {
    if (!report.activityNotes) return '-';

    try {
        const activities = JSON.parse(report.activityNotes);
        if (Array.isArray(activities) && activities.length > 0) {
            return activities[0].content || '-';
        }
    } catch (e) {
        // JSON 파싱 실패 시 문자열 그대로 반환
        return report.activityNotes;
    }

    return '-';
}

/**
 * 이행여부 배지 생성
 */
function getStatusBadge(report) {
    // activityStatus 필드 기반으로 판단
    const status = report.activityStatus || 'incomplete';

    switch (status) {
        case 'complete':
            return '<span class="badge badge-success">✅ 완료</span>';
        case 'partial':
            return '<span class="badge badge-warning">⏳ 진행중</span>';
        case 'incomplete':
        default:
            return '<span class="badge badge-danger">❌ 미이행</span>';
    }
}

/**
 * 이행여부 텍스트 (CSV용)
 */
function getStatusText(report) {
    const status = report.activityStatus || 'incomplete';
    switch (status) {
        case 'complete': return '완료';
        case 'partial': return '진행중';
        case 'incomplete':
        default: return '미이행';
    }
}

/**
 * 파일명용 날짜 포맷
 */
function formatDateForFilename(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}${month}${day}`;
}
```

---

## 7. 반응형 디자인

### 7-1. 브레이크포인트

```css
/* 태블릿 (1024px 이하) */
@media (max-width: 1024px) {
    .filter-row {
        flex-direction: column;
        align-items: stretch;
    }

    .filter-group {
        width: 100%;
    }

    .btn-primary {
        width: 100%;
    }

    .summary-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .report-table {
        font-size: var(--font-xs);
    }

    .report-table th,
    .report-table td {
        padding: var(--spacing-sm);
    }
}

/* 모바일 (768px 이하) */
@media (max-width: 768px) {
    .presentation-container {
        padding: var(--spacing-md);
    }

    .header-text h1 {
        font-size: var(--font-xl);
    }

    .summary-grid {
        grid-template-columns: 1fr;
    }

    .table-wrapper {
        max-height: 400px;
    }

    /* 테이블 가로 스크롤 활성화 */
    .report-table {
        min-width: 1200px;
    }
}
```

---

## 8. 접근성 고려사항

### 8-1. ARIA 속성

```html
<!-- 라디오 버튼 그룹 -->
<div class="radio-group" role="radiogroup" aria-labelledby="period-label">
    <label id="period-label" class="sr-only">기간 선택</label>
    <label class="radio-label">
        <input type="radio" name="period" value="weekly" checked aria-checked="true">
        <span>금주</span>
    </label>
</div>

<!-- 토글 버튼 -->
<button class="toggle-btn"
        aria-label="그룹 펼치기/접기"
        aria-expanded="false"
        aria-controls="employee-group-강민">
    ▶
</button>

<!-- 테이블 -->
<table class="report-table" role="table" aria-label="보고서 발표 데이터">
    <thead>
        <tr role="row">
            <th role="columnheader" scope="col">보고서 제출일</th>
            <!-- ... -->
        </tr>
    </thead>
</table>
```

### 8-2. 키보드 네비게이션

```javascript
/**
 * 키보드 이벤트 핸들러
 */
function setupKeyboardNavigation() {
    // 그룹 헤더에 키보드 이벤트 추가
    document.addEventListener('keydown', (event) => {
        if (event.target.classList.contains('group-header')) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                event.target.click();
            }
        }
    });

    // 테이블 행 포커스 관리
    const rows = document.querySelectorAll('.report-row, .group-header');
    rows.forEach(row => {
        row.setAttribute('tabindex', '0');
    });
}
```

### 8-3. 스크린 리더 지원

```css
/* 스크린 리더 전용 텍스트 */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* 포커스 표시 */
*:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
}
```

---

## 9. 구현 체크리스트

### 9-1. HTML 구현

- [ ] 전체 컨테이너 구조
- [ ] 헤더 영역
- [ ] 필터 영역 (라디오 버튼, 입력 필드, 조회 버튼)
- [ ] 기간 표시 영역
- [ ] 테이블 구조 (헤더, 바디)
- [ ] 요약 영역
- [ ] 푸터 영역

### 9-2. CSS 스타일링

- [ ] 레이아웃 스타일
- [ ] 필터 영역 스타일
- [ ] 테이블 스타일
- [ ] 그룹 헤더 스타일
- [ ] 달성률 색상 표시
- [ ] 배지 스타일
- [ ] 요약 영역 스타일
- [ ] 반응형 스타일

### 9-3. JavaScript 기능

- [ ] 초기화 및 이벤트 리스너
- [ ] 데이터 로드 (API 연동)
- [ ] 기간 계산 로직
- [ ] 필터링 로직
- [ ] 담당자별 그룹화
- [ ] 테이블 렌더링
- [ ] 토글 기능
- [ ] 요약 계산 및 렌더링
- [ ] CSV 다운로드
- [ ] 인쇄 기능

### 9-4. 접근성

- [ ] ARIA 속성 추가
- [ ] 키보드 네비게이션
- [ ] 포커스 관리
- [ ] 스크린 리더 지원

---

## 10. 페이지 통합

### 10-1. 파일 구조

```
05.Source/
└── 04.admin_mode/
    └── 04_report_presentation/
        ├── 01_report_presentation.html     (이 가이드의 HTML)
        ├── 02_report_presentation.js       (이 가이드의 JavaScript)
        └── 03_report_presentation.css      (추가 커스텀 스타일)
```

### 10-2. 레이아웃 통합

관리자 레이아웃에 페이지 라우팅 추가:

```javascript
// 02_admin_layout.js
const pageFileMap = {
    // ... 기존 페이지들
    'report-presentation': {
        folder: '04_report_presentation',
        file: '01_report_presentation',
        script: '02_report_presentation.js'
    }
};
```

---

## 부록

### A. 샘플 데이터 구조

```javascript
const sampleReport = {
    reportId: 'uuid-string',
    submittedBy: '강민',
    submittedDate: '2025-10-11',
    department: '해외영업팀',
    companyId: 'company-uuid',
    companyName: '삼성치과',
    companyManager: '김철수',
    targetCollectionAmount: 5000000,
    actualCollectionAmount: 4500000,
    targetSalesAmount: 10000000,
    actualSalesAmount: 9000000,
    activityNotes: '[{"content":"임플란트 상담 및 견적서 전달","companyName":"삼성치과"}]',
    activityStatus: 'complete',
    accumulatedSales: 50000000,
    accumulatedCollection: 45000000
};
```

### B. API 엔드포인트

```javascript
// GET /api/reports
// Query Parameters:
// - startDate: YYYY-MM-DD
// - endDate: YYYY-MM-DD
// - department: 부서명 (옵션)
// - submittedBy: 담당자명 (옵션)

// Response:
{
    success: true,
    data: {
        reports: [/* 보고서 배열 */]
    }
}
```

---

**문서 끝**
