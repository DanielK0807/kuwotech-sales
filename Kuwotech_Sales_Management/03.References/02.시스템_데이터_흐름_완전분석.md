# 📊 KUWOTECH 영업관리 시스템 - 완전 데이터 흐름 분석

> 작성일: 2025-09-26  
> KUWOTECH 영업관리 시스템 전체 데이터 흐름 및 엑셀 관리 전략

---

## 📑 목차

### PART 1: 시스템 개요

1. [데이터베이스 구조](#1-데이터베이스-구조)
2. [전체 데이터 흐름도](#2-전체-데이터-흐름도)

### PART 2: 사이드메뉴별 상세 분석

1. [영업담당 모드 (6개 메뉴)](#3-영업담당-모드)
2. [관리자 모드 (7개 메뉴)](#4-관리자-모드)

### PART 3: 엑셀 관리 전략

1. [엑셀 시트 구조 설계](#5-엑셀-시트-구조)
2. [데이터 동기화 전략](#6-데이터-동기화-전략)
3. [자동화 vs 수동 관리](#7-자동화-vs-수동-관리)

### PART 4: 문제점 및 해결방안

1. [현재 시스템 문제점](#8-현재-시스템-문제점)
2. [해결 방안](#9-해결-방안)
3. [구현 우선순위](#10-구현-우선순위)
1. [데이터베이스 구조](#1-데이터베이스-구조)
2. [전체 데이터 흐름도](#2-전체-데이터-흐름도)

### PART 2: 사이드메뉴별 상세 분석

1. [영업담당 모드 (6개 메뉴)](#영업담당-모드-6개-메뉴)
2. [관리자 모드 (7개 메뉴)](#관리자-모드-7개-메뉴)

### PART 3: 엑셀 관리 전략

1. [엑셀 시트 구조 설계](#엑셀-시트-구조-설계)
2. [데이터 동기화 전략](#데이터-동기화-전략)
3. [자동화 vs 수동 관리](#자동화-vs-수동-관리)

### PART 4: 문제점 및 해결방안

1. [현재 시스템 문제점](#현재-시스템-문제점)
2. [해결 방안](#해결-방안)
3. [구현 우선순위](#구현-우선순위)

### PART 5: 참고 정보

1. [참고 파일 위치](#11-참고-파일-위치)
2. [FAQ](#12-faq)

---

## PART 1: 시스템 개요 및 데이터베이스 구조

## 1. 데이터베이스 구조

### 1-1. IndexedDB 스키마 (KuwotechSalesDB v3)

```javascript
📦 KuwotechSalesDB
 ├── 📁 companies (거래처 정보)
 ├── 📁 employees (직원 정보)
 ├── 📁 reports (실적보고서)
 ├── 📁 changeHistory (변경 이력)
 ├── 📁 kpiCache (KPI 캐시)
 └── 📁 meta (메타 정보)
```javascript

### 1-2. 스토어별 상세 정보

-

#### companies (거래처)

- **Primary Key**: keyValue
- **인덱스**:
  - companyNameERP (거래처명)
  - finalCompanyName (최종거래처명)
  - transactionStatus (거래상태)
  - internalManager (내부담당자)
  - customerRegion (고객사 지역)
  - department (담당부서)
  - createdAt (생성일)
  - updatedAt (수정일)

**데이터 필드** (19개):

  1. KEY VALUE (자동생성)
  2. 거래처명(ERP)
  3. 최종거래처명
  4. 폐업여부
  5. 대표이사 또는 치과의사
  6. 고객사 지역
  7. 거래상태
  8. 담당부서
  9. 판매제품
  10. 내부담당자
  11. 정철웅기여(상.중.하)
  12. 회사기여(상.중.하)
  13. 마지막결제일
  14. 마지막총결재금액
  15. 매출채권잔액
  16. 누적수금액
  17. 누적매출액
  18. 영업활동(특이사항)

-

#### reports (실적보고서)

- **Primary Key**: reportId (autoIncrement)
- **인덱스**:
  - reportType (보고서 유형)
  - submittedBy (작성자)
  - status (상태: 대기/승인/반려)
  - submittedDate (제출일)
  - processedDate (처리일)
  - processedBy (처리자)

**데이터 필드** (12개):

  1. 보고서ID (reportId)
  2. 작성자 (submittedBy)
  3. 제출일 (submittedDate)
  4. 보고서유형 (reportType)
  5. 목표수금금액 (targetCollectionAmount)
  6. 목표매출액 (targetSalesAmount)
  7. 판매목표제품 (targetProducts)
  8. 영업활동(특이사항) (activityNotes)
  9. 상태 (status)
  10. 처리자 (processedBy)
  11. 처리일 (processedDate)
  12. 관리자코멘트 (adminComment)

-

#### employees (직원)

- **Primary Key**: id (autoIncrement)
- **인덱스**:
  - name (이름)
  - role (역할)
  - department (부서)

-

#### changeHistory (변경 이력)

- **Primary Key**: id (autoIncrement)
- **인덱스**:
  - targetStore (대상 스토어)
  - targetId (대상 ID)
  - operation (작업: CREATE/UPDATE/DELETE)
  - userId (변경자)
  - timestamp (변경 시간)

-

#### kpiCache (KPI 캐시)

- **Primary Key**: kpiType
- **인덱스**:
  - userId (사용자 ID)
  - calculatedAt (계산 시간)
  - expiresAt (만료 시간)

-

#### meta (메타 정보)

- **Primary Key**: key
- **데이터**: 시스템 설정, 버전, 백업 정보 등

---

## 2. 전체 데이터 흐름도 및 입력/출력

### 2-1. 입력 흐름

```mermaid
graph TD
    A[1️⃣ 엑셀 업로드<br/>index.html] --> B[영업관리기초자료.xlsx]
    B --> C[ExcelDataLoader.js]
    C --> D[IndexedDB companies ✅]
    D --> E[화면 표시]
    
    F[2️⃣ 거래처 추가<br/>sales.html/admin.html] --> G[CompanyDetailModal]
    G --> H[openAddCompanyModal]
    H --> I[IndexedDB companies ✅]
    I --> J[location.reload]
    
    K[3️⃣ 실적보고서<br/>sales.html] --> L[ReportUI.js]
    L --> M[ReportManager.createReport]
    M --> N[IndexedDB reports ✅]
    N --> O[화면 새로고침]
```text

### 2-2. 출력 흐름 (현재 상태)

```javascript

IndexedDB 데이터
   ↓
   ❌ 다운로드 기능 없음 (구현 필요)
   ↓
   엑셀 파일로 저장 불가

```javascript

---

## PART 2: 사이드메뉴별 상세 분석

## 3. 영업담당 모드

-

### 📊 3-1. 대시보드

-

#### 3-1. 대시보드 기능 개요

- **조회**: ✅ 개인 KPI 실시간 표시
- **입력**: ❌ 없음
- **다운로드**: ✅ 가능 (KPI 데이터)
- **업로드**: ❌ 없음

-

#### 3-1. 대시보드 데이터 흐름

```text
IndexedDB (companies, reports)
  ↓
KPIEngine 계산
  ↓
화면 표시
  ↓
downloadKPIData() → 엑셀 저장
```text

-

#### 3-1. 대시보드 엑셀 저장 정보

- **시트명**: `영업실적_[담당자명]_[날짜]`
- **저장 주기**: 수동 (다운로드 버튼 클릭 시)
- **자동화**: ❌ 수동
- **구현 상태**: ❌ 미구현

---

-

### 📊 3-2. 담당거래처 관리

-

#### 3-2. 담당거래처 관리 기능 개요

- **조회**: ✅ 본인 담당 거래처 목록
- **입력**: ✅ 거래처 추가/수정
- **다운로드**: ✅ 가능 (담당 거래처 데이터)
- **업로드**: ❌ 없음 (관리자만 가능)

-

#### 3-2. 담당거래처 관리 입력 데이터 흐름

```md
거래처 추가 버튼 (addCompanyBtn)
  ↓
CompanyDetailModal (19개 필드 입력)
  ↓
openAddCompanyModal() 함수
  ↓
IndexedDB companies 저장
  ↓
location.reload() (페이지 새로고침)
```text

#### 3-2. 담당거래처 관리 다운로드 데이터 흐름

```md
IndexedDB companies (내 담당만 필터링)
  ↓
downloadMyData() 실행
  ↓
엑셀 파일 생성 및 다운로드
```text

#### 3-2. 담당거래처 관리 버튼 정보

- **버튼 ID**: `addCompanyBtn`
- **현재 동작**: `alert('거래처 추가 기능은 준비 중입니다.')`
- **실제 구현**: `openAddCompanyModal()` 함수 (미연결)
- **위치**: sales.html 215-217번 라인

#### 3-2. 담당거래처 관리 엑셀 저장 정보

- **시트명**: `기본정보` (기존 시트 업데이트)
- **저장 주기**:
  - ⚡ 즉시: 거래처 추가/수정 시 자동
  - 👆 수동: 다운로드 버튼 클릭 시
- **자동화**: ✅ 자동 (실시간 동기화 권장)
- **구현 상태**:
  - 입력: ✅ 구현됨 (미연결)
  - 다운로드: ❌ 미구현

---

### 📝 3-3. 실적보고서 작성

#### 3-3. 실적보고서 작성 기능 개요

- **조회**: ✅ 작성 중인 보고서 목록
- **입력**: ✅ 신규 보고서 작성
- **다운로드**: ✅ 가능 (작성한 보고서)
- **업로드**: ❌ 없음

#### 3-3. 실적보고서 작성 입력 데이터 흐름

```text
신규 작성 버튼
  ↓
ReportUI 모달 (5개 필드 입력)
  ↓
ReportManager.createReport()
  ↓
IndexedDB reports 저장
  ↓
화면 새로고침
```text

#### 입력 항목 (5개 필드)

1. 보고서 유형
2. 목표수금금액
3. 목표매출액
4. 판매목표제품
5. 활동내역

#### 3-3. 실적보고서 작성 엑셀 저장 정보

- **시트명**: `방문보고서_[담당자명]` (신규 시트)
- **저장 주기**:
  - ⚡ 즉시: 보고서 작성 시 자동
  - 👆 수동: 다운로드 버튼 클릭 시
- **자동화**: ✅ 자동 (실시간 동기화 권장)
- **구현 상태**:
  - 입력: ✅ 구현됨
  - 다운로드: ❌ 미구현

---

### ✅ 3-4. 실적보고서 확인

#### 3-4. 실적보고서 확인 기능 개요

- **조회**: ✅ 제출한 보고서 상태 확인
- **입력**: ❌ 없음 (조회만)
- **다운로드**: ✅ 가능 (승인된 보고서)
- **업로드**: ❌ 없음

#### 3-4. 실적보고서 확인 데이터 흐름

```text
IndexedDB reports (본인 작성 + 상태별 필터링)
  ↓
화면 표시 (대기/승인/반려)
  ↓
downloadMyReports() → 엑셀 저장
```text

#### 3-4. 실적보고서 확인 엑셀 저장 정보

- **시트명**: `방문보고서_[담당자명]`
- **저장 주기**: 수동 (다운로드 버튼 클릭 시)
- **자동화**: ❌ 수동
- **구현 상태**: ❌ 미구현

---

### 📥 3-5. 데이터 관리

#### 3-5. 데이터 관리 기능 개요

- **조회**: ✅ 다운로드 가능한 데이터 목록
- **입력**: ❌ 없음
- **다운로드**: ✅ 3가지 데이터 다운로드
- **업로드**: ❌ 없음 (관리자만 가능)

#### 3-5. 데이터 관리 다운로드 항목

##### 1. 개인 실적 다운로드

- **함수**: `downloadMyData()`
- **내용**: 담당 거래처 데이터
- **시트**: `기본정보_[담당자명]`
- **위치**: sales.html 264번 라인

##### 2. 보고서 다운로드

- **함수**: `downloadMyReports()`
- **내용**: 작성한 방문보고서
- **시트**: `방문보고서_[담당자명]`
- **위치**: sales.html 273번 라인

##### 3. KPI 다운로드

- **함수**: `downloadKPIData()`
- **내용**: 개인 KPI 실적
- **시트**: `영업실적_[담당자명]_[날짜]`
- **위치**: sales.html 282번 라인

#### 생성 파일 정보

- **파일명**: `[담당자명]_영업데이터_[날짜].xlsx`
- **시트 구성**:
  - `기본정보_[담당자명]` - 거래처
  - `방문보고서_[담당자명]` - 보고서
  - `영업실적_[담당자명]` - KPI
- **저장 주기**: 수동 (필요 시)
- **자동화**: ❌ 수동
- **구현 상태**: ❌ 모두 미구현

---

### ⚙️ 3-6. 시스템 설정

#### 3-6. 시스템 설정 기능 개요

- **조회**: ✅ 개인 설정 확인
- **입력**: ✅ 프로필 수정
- **다운로드**: ❌ 없음
- **업로드**: ❌ 없음

#### 3-6. 시스템 설정 데이터 흐름

```text
프로필 설정 변경
  ↓
IndexedDB employees 업데이트
  ↓
화면 반영
```text

#### 3-6. 시스템 설정 엑셀 저장 정보

- **시트명**: `직원정보` (관리자가 관리)
- **저장 주기**: ❌ 저장 안 함 (관리자 권한)
- **자동화**: ❌ 없음

---

## 4. 관리자 모드

### 🏠 4-1. 대시보드

#### 4-1. 관리자 대시보드 기능 개요

- **조회**: ✅ 전사 KPI 실시간 표시
- **입력**: ❌ 없음
- **다운로드**: ✅ 가능 (전사 KPI)
- **업로드**: ❌ 없음

#### 4-1. 관리자 대시보드 데이터 흐름

```text
IndexedDB (companies, reports, employees)
  ↓
KPIEngine 전사 계산
  ↓
화면 표시
  ↓
downloadAllKPIData() → 엑셀 저장
```text

#### 4-1. 관리자 대시보드 엑셀 저장 정보

- **시트명**: `전사실적_[날짜]`
- **저장 주기**: 수동 (다운로드 버튼 클릭 시)
- **자동화**: ❌ 수동
- **구현 상태**: ❌ 미구현

---

### 📊 4-2. 전체거래처 관리

#### 4-2. 전체거래처 관리 기능 개요

- **조회**: ✅ 모든 거래처 목록
- **입력**: ✅ 거래처 추가/수정/삭제
- **다운로드**: ✅ 가능 (전체 거래처)
- **업로드**: ❌ 없음 (데이터 관리에서 처리)

#### 4-2. 전체거래처 관리 입력 데이터 흐름

```javascript

거래처 추가 버튼 (addCompanyBtn)
  ↓
CompanyDetailModal (19개 필드)
  ↓
IndexedDB companies 저장
  ↓
화면 새로고침

```javascript

#### 4-2. 전체거래처 관리 다운로드 데이터 흐름

```javascript

IndexedDB companies (전체)
  ↓
downloadAllCompanies() 실행
  ↓
엑셀 파일 생성

```javascript

#### 4-2. 전체거래처 관리 엑셀 저장 정보

- **시트명**: `기본정보` (메인 시트)
- **저장 주기**:
  - ⚡ 즉시: 변경 시 자동 동기화
  - 👆 수동: 다운로드 버튼 클릭 시
- **자동화**: ✅ 자동 (실시간 동기화 권장)
- **구현 상태**:
  - 입력: ✅ 구현됨 (미연결)
  - 다운로드: ❌ 미구현

---

### ✅ 4-3. 실적보고서 확인

#### 4-3. 실적보고서 확인 기능 개요

- **조회**: ✅ 모든 직원의 보고서
- **입력**: ✅ 보고서 승인/반려/코멘트
- **다운로드**: ✅ 가능 (전체 보고서)
- **업로드**: ❌ 없음

#### 4-3. 실적보고서 확인 입력 데이터 흐름

```javascript

보고서 승인/반려 처리
  ↓
IndexedDB reports 상태 업데이트
  (status, processedBy, processedDate, adminComment)
  ↓
화면 새로고침

```javascript

#### 4-3. 실적보고서 확인 다운로드 데이터 흐름

```javascript

IndexedDB reports (전체)
  ↓
downloadAllReports() 실행
  ↓
엑셀 파일 생성

```text

#### 4-3. 실적보고서 확인 엑셀 저장 정보

- **시트명**: `방문보고서_전체` (신규 시트)
- **추가 컬럼**:
  - 작성자 (submittedBy)
  - 제출일 (submittedDate)
  - 승인일 (processedDate)
  - 처리자 (processedBy)
  - 상태 (status)
  - 관리자 코멘트 (adminComment)
- **저장 주기**:
  - ⚡ 즉시: 승인/반려 시 자동
  - 👆 수동: 다운로드 버튼 클릭 시
- **자동화**: ✅ 자동 (실시간 동기화 권장)
- **구현 상태**:
  - 입력: ✅ 구현됨
  - 다운로드: ❌ 미구현

---

### 📈 4-4. 보고서 발표

#### 4-4. 보고서 발표 기능 개요

- **조회**: ✅ 발표 자료 생성
- **입력**: ❌ 없음 (조회 전용)
- **다운로드**: ✅ 가능 (발표 자료)
- **업로드**: ❌ 없음

#### 4-4. 보고서 발표 데이터 흐름

```text

IndexedDB (reports, companies)
  ↓
발표 자료 생성
  ↓
화면 표시
  ↓
downloadPresentation() → PPT/PDF 저장

```text

#### 4-4. 보고서 발표 엑셀 저장 정보

- **시트명**: `발표자료_[날짜]` (선택 사항)
- **저장 주기**: 수동 (필요 시)
- **자동화**: ❌ 수동
- **구현 상태**: ❌ 미구현

---

### 📥 4-5. 데이터 관리 ⭐ 핵심

#### 4-5. 데이터 관리 기능 개요

- **조회**: ✅ 데이터 상태 확인
- **입력**: ❌ 없음
- **다운로드**: ✅ 3가지 데이터 다운로드
- **업로드**: ✅ 엑셀 업로드 (강정환 전용)

#### 4-5-1. 엑셀 업로드 (강정환 전용)

##### 기능

- 원본 엑셀 파일 업로드
- IndexedDB 전체 초기화
- 기본정보 시트 → companies 스토어

##### 처리 흐름

```text

엑셀 파일 선택
  ↓
ExcelDataLoader.js
  ↓
기존 데이터 전체 삭제 (store.clear())
  ↓
새 데이터 저장
  ↓
시스템 재시작

```text

##### 주의사항

- ⚠️ 기존 데이터 모두 삭제됨
- ⚠️ 추가한 거래처/보고서 손실
- ✅ 백업 먼저 필수
- 🔒 강정환 관리자 전용

#### 4-5-2. 엑셀 다운로드

##### 다운로드 항목

##### 1. 전체 데이터 다운로드 (`downloadExcelData()`)

- 모든 거래처
- 모든 보고서
- 모든 직원
- 변경 이력
- 위치: admin.html 349번 라인

##### 2. 백업 실행 (`backupDatabase()`)

- 전체 IndexedDB 백업
- 타임스탬프 포함
- 위치: admin.html 360번 라인

#### 4-5. 데이터 관리 생성 파일 구조

```text

영업관리기초자료_백업_[날짜시간].xlsx
├── 기본정보 (거래처 19개 컬럼)
├── 방문보고서_전체 (모든 보고서)
├── 직원정보 (모든 직원)
├── 변경이력 (시스템 로그)
└── 메타정보 (백업 시간, 버전 등)

```text

#### 4-5. 데이터 관리 엑셀 저장 정보

- **파일명**: `영업관리기초자료_백업_[YYYY-MM-DD_HHMMSS].xlsx`
- **저장 주기**:
  - ⏰ 자동: 매일 자정 (권장)
  - 👆 수동: 다운로드 버튼 클릭 시
- **자동화**: ✅ 자동 + 수동 병행
- **구현 상태**: ❌ 미구현

---

### 👥 4-6. 직원 관리

#### 4-6. 직원 관리 기능 개요

- **조회**: ✅ 전체 직원 목록
- **입력**: ✅ 직원 추가/수정/삭제
- **다운로드**: ✅ 가능 (직원 목록)
- **업로드**: ❌ 없음

#### 4-6. 직원 관리 입력 데이터 흐름

```text

직원 추가/수정 버튼
  ↓
EmployeeModal
  ↓
IndexedDB employees 저장
  ↓
화면 새로고침

```text

#### 4-6. 직원 관리 다운로드 데이터 흐름

```text

IndexedDB employees
  ↓
downloadEmployees() 실행
  ↓
엑셀 파일 생성

```text

#### 4-6. 직원 관리 엑셀 저장 정보

- **시트명**: `직원정보`
- **저장 주기**:
  - ⚡ 즉시: 변경 시 자동
  - 👆 수동: 다운로드 버튼 클릭 시
- **자동화**: ✅ 자동 (실시간 동기화)
- **구현 상태**:
  - 입력: ✅ 구현됨
  - 다운로드: ❌ 미구현

---

### ⚙️ 4-7. 시스템 설정

#### 4-7. 시스템 설정 기능 개요

- **조회**: ✅ 시스템 설정 확인
- **입력**: ✅ 시스템 설정 변경
- **다운로드**: ✅ 설정 백업
- **업로드**: ✅ 설정 복원

#### 4-7. 시스템 설정 데이터 흐름

```text

시스템 설정 변경
  ↓
IndexedDB meta 저장
  ↓
적용

```text

#### 4-7. 시스템 설정 엑셀 저장 정보

- **시트명**: `시스템설정` (선택 사항)
- **저장 주기**: 수동
- **자동화**: ❌ 수동
- **구현 상태**: ❌ 미구현

---

## PART 3: 엑셀 관리 전략 및 시트 구조

## 5. 엑셀 시트 구조

### 5-1. 현재 시트 (기존)

#### `기본정보` 시트 ✅ 존재

- **용도**: 거래처 정보 저장
- **컬럼 수**: 19개
- **Primary Key**: KEY VALUE
- **업데이트**:
  - ⚡ 자동: 거래처 추가/수정 시 (권장)
  - 👆 수동: 다운로드 시
- **구현 상태**:
  - 읽기: ✅ 구현됨
  - 쓰기: ❌ 미구현

#### `직원정보` 시트 (추정) ✅ 존재 가능

- **용도**: 직원 정보 저장
- **업데이트**:
  - ⚡ 자동: 직원 추가/수정 시 (권장)
  - 👆 수동: 다운로드 시
- **구현 상태**:
  - 읽기: ❓ 미확인
  - 쓰기: ❌ 미구현

---

### 5-2. 추가 필요 시트

#### ✅ `방문보고서_전체` (신규 - 필수) 🔴 우선순위 높음

**용도**: 모든 방문보고서 저장

**컬럼 구조** (12개):

1. 보고서ID (reportId)
2. 작성자 (submittedBy)
3. 제출일 (submittedDate)
4. 보고서유형 (reportType)
5. 목표수금금액 (targetCollectionAmount)
6. 목표매출액 (targetSalesAmount)
7. 판매목표제품 (targetProducts)
8. 활동내역 (activityNotes)
9. 상태 (status: 대기/승인/반려)
10. 처리자 (processedBy)
11. 처리일 (processedDate)
12. 관리자코멘트 (adminComment)

**업데이트 시점**:

- ✅ 보고서 작성 시 자동 추가
- ✅ 보고서 승인/반려 시 자동 업데이트
- ✅ 다운로드 시 전체 동기화

**구현 필요도**: 🔴 필수

---

#### 5-2. 변경이력 (신규 - 권장) 🟡 우선순위 중간

**용도**: 시스템 변경 로그 기록

**컬럼 구조** (8개):

1. 이력ID (id)
2. 대상스토어 (targetStore: companies/reports/employees)
3. 대상ID (targetId)
4. 작업유형 (operation: CREATE/UPDATE/DELETE)
5. 변경자 (userId)
6. 변경시간 (timestamp)
7. 변경전데이터 (beforeData)
8. 변경후데이터 (afterData)

**업데이트 시점**:

- ✅ 모든 데이터 변경 시 자동 기록
- ✅ 다운로드 시 전체 동기화

**활용**:

- 감사 추적 (Audit Trail)
- 데이터 복구
- 변경 분석

**구현 필요도**: 🟡 권장

---

#### 5-3. 전사실적 (신규 - 선택) 🟢 우선순위 낮음

**용도**: 관리자 KPI 데이터 저장

**컬럼 구조** (15개):

1. 날짜 (date)
2. 전체거래처수 (totalCompanies)
3. 활성거래처수 (activeCompanies)
4. 신규거래처수 (newCompanies)
5. 휴면거래처수 (inactiveCompanies)
6. 매출액 (totalSales)
7. 수금액 (totalCollection)
8. 채권액 (totalReceivables)
9. 방문횟수 (totalVisits)
10. 보고서수 (totalReports)
11. 영업담당수 (totalSalesReps)
12. 계약건수 (totalContracts)
13. 목표달성률 (achievementRate)
14. 전월대비 (monthOverMonth)
15. 전년대비 (yearOverYear)

**업데이트 시점**:

- ✅ 매일 자정 자동 계산 및 저장
- ✅ 다운로드 시 최신 데이터 동기화

**구현 필요도**: 🟢 선택

---

#### 5-4. 메타정보 (신규 - 선택) 🟢 우선순위 낮음

**용도**: 시스템 메타데이터 저장

**컬럼 구조** (6개):

1. 키 (key)
2. 값 (value)
3. 설명 (description)
4. 생성일 (createdAt)
5. 수정일 (updatedAt)
6. 수정자 (updatedBy)

**저장 데이터**:

- DB 버전
- 마지막 백업 시간
- 마지막 동기화 시간
- 시스템 설정값

**업데이트 시점**:

- ✅ 시스템 설정 변경 시
- ✅ 다운로드 시

**구현 필요도**: 🟢 선택

---

### 6. 데이터 동기화 전략

#### 6-1. 실시간 동기화 (자동) ⚡

##### 실시간 동기화 대상 데이터

1. ✅ **거래처 정보** (`companies`)
   - 트리거: 추가/수정/삭제 시 즉시
   - 동작: → `기본정보` 시트 업데이트
   - 구현: DataSyncManager.syncCompanies()

2. ✅ **방문보고서** (`reports`)
   - 트리거: 작성/승인/반려 시 즉시
   - 동작: → `방문보고서_전체` 시트 업데이트
   - 구현: DataSyncManager.syncReports()

3. ✅ **직원 정보** (`employees`)
   - 트리거: 추가/수정/삭제 시 즉시
   - 동작: → `직원정보` 시트 업데이트
   - 구현: DataSyncManager.syncEmployees()

4. ✅ **변경 이력** (`changeHistory`)
   - 트리거: 모든 변경 시 자동 기록
   - 동작: → `변경이력` 시트 업데이트
   - 구현: ChangeHistoryManager.log()

##### 실시간 동기화 구현 방식

```javascript
class DataSyncManager {
  async syncToExcel(storeName, operation, data) {
    // 1. IndexedDB 변경 감지
    const changeEvent = {
      store: storeName,
      operation: operation, // CREATE, UPDATE, DELETE
      data: data,
      timestamp: new Date()
    };
    
    // 2. 해당 시트 업데이트
    await this.updateExcelSheet(storeName, data);
    
    // 3. 변경 이력 기록
    await this.recordChangeHistory(changeEvent);
    
    // 4. 엑셀 파일 자동 저장
    await this.saveExcelFile();
  }
}
```

##### 실시간 동기화 저장 위치

- **경로**: `./data/영업관리기초자료_실시간.xlsx`
- **백업**: 변경 시마다 버전 관리 (git-style)

---

#### 6-2. 정기 백업 (자동) 🕐

##### 정기 백업 스케줄

**1. 일일 백업** (권장) 🔴

- **시간**: 매일 자정 (00:00)
- **대상**: 전체 데이터
- **파일명**: `영업관리기초자료_백업_[YYYY-MM-DD].xlsx`
- **보관 기간**: 30일
- **구현**: AutoBackupScheduler.dailyBackup()

**2. 주간 백업** (선택) 🟡

- **시간**: 매주 일요일 23:00
- **대상**: 전체 데이터 + 변경이력
- **파일명**: `영업관리기초자료_주간백업_[YYYY-WW].xlsx`
- **보관 기간**: 3개월
- **구현**: AutoBackupScheduler.weeklyBackup()

**3. 월간 백업** (선택) 🟢

- **시간**: 매월 말일 23:00
- **대상**: 전체 데이터 + 통계
- **파일명**: `영업관리기초자료_월간백업_[YYYY-MM].xlsx`
- **보관 기간**: 1년
- **구현**: AutoBackupScheduler.monthlyBackup()

##### 정기 백업 구현 방식

```javascript
class AutoBackupScheduler {
  constructor() {
    this.schedules = {
      daily: '0 0 * * *',      // 매일 자정
      weekly: '0 23 * * 0',    // 일요일 23시
      monthly: '0 23 L * *'    // 월말 23시
    };
  }
  
  async executeBackup(type) {
    const timestamp = new Date().toISOString();
    const filename = this.generateFilename(type, timestamp);
    
    // 1. 전체 데이터 수집
    const data = await this.collectAllData();
    
    // 2. 엑셀 파일 생성
    const workbook = XLSX.utils.book_new();
    
    // 기본정보 시트
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(data.companies), 
      '기본정보'
    );
    
    // 방문보고서 시트
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(data.reports), 
      '방문보고서_전체'
    );
    
    // 직원정보 시트
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(data.employees), 
      '직원정보'
    );
    
    // 변경이력 시트
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(data.changeHistory), 
      '변경이력'
    );
    
    // 3. 파일 저장
    XLSX.writeFile(workbook, filename);
    
    // 4. 백업 로그 기록
    await this.logBackup(type, filename, timestamp);
    
    // 5. 오래된 백업 삭제
    await this.cleanOldBackups(type);
  }
}
```

---

#### 6-3. 수동 백업 👆

##### 수동 백업 관리자 데이터 관리 메뉴

**1. 전체 데이터 다운로드**

- **버튼**: "데이터 다운로드" (`downloadExcelData()`)
- **파일명**: `영업관리기초자료_백업_[날짜시간].xlsx`
- **포함 시트**:
  - ✅ 기본정보
  - ✅ 방문보고서_전체
  - ✅ 직원정보
  - ✅ 변경이력
  - ✅ 메타정보

**2. 백업 실행**

- **버튼**: "백업 실행" (`backupDatabase()`)
- **기능**: 전체 데이터 다운로드 + 로그 기록
- **알림**: 백업 완료 메시지

**3. 백업 복원** (추가 권장)

- **버튼**: "백업 복원" (`restoreDatabase()`)
- **기능**:
  - 백업 파일 선택
  - 데이터 검증
  - IndexedDB 복원
  - 확인 메시지

---

### 7. 자동화 vs 수동 관리

#### 7-1. 자동 처리 (권장) 🤖

##### 자동화할 작업

##### 1. 실시간 동기화 🔴 필수

- **대상**: 거래처, 보고서, 직원
- **시점**: 데이터 변경 즉시
- **방식**:

  ```javascript
  // 변경 감지 → 엑셀 업데이트
  onChange(data) {
    await syncToExcel(data);
  }
  ```

- **장점**:
  - 데이터 손실 방지
  - 항상 최신 상태 유지
  - 사용자 개입 불필요
- **구현 필요도**: 🔴 필수

##### 2. 정기 백업 🔴 필수

- **대상**: 전체 시스템
- **시점**: 매일 자정
- **방식**:

  ```javascript
  // 스케줄러 실행
  cron.schedule('0 0 * * *', async () => {
    await backupAllData();
  });
  ```

- **장점**:
  - 안정적인 백업
  - 복구 지점 확보
  - 관리 부담 감소
- **구현 필요도**: 🔴 필수

##### 3. 변경 이력 기록 🟡 권장

- **대상**: 모든 데이터 변경
- **시점**: 변경 즉시
- **방식**:

  ```javascript
  // 변경 전후 비교 → 로그 저장
  logChange(before, after) {
    await saveChangeHistory({
      before, after, timestamp, user
    });
  }
  ```

- **장점**:
  - 감사 추적 가능
  - 복구 데이터 확보
  - 책임 소재 명확
- **구현 필요도**: 🟡 권장

---

#### 7-2. 수동 처리 (보조) 👤

##### 수동으로 처리할 작업

##### 1. 엑셀 업로드 (관리자만) 🔒

- **위치**: 관리자 > 데이터 관리
- **권한**: 강정환 전용
- **시점**: 필요 시 (긴급 데이터 복구 등)
- **주의사항**:
  - ⚠️ 기존 데이터 삭제
  - ✅ 백업 먼저 필수
  - ✅ 확인 절차 필요

##### 2. 개별 다운로드 (모든 사용자) 📥

- **위치**: 데이터 관리 메뉴
- **시점**: 필요 시
- **대상**:
  - 영업담당: 내 데이터만
  - 관리자: 전체 데이터

##### 3. 수동 백업 (관리자) 💾

- **위치**: 관리자 > 데이터 관리
- **시점**: 중요 작업 전후
- **예시**:
  - 대량 데이터 변경 전
  - 시스템 업데이트 전
  - 연말 결산 전

---

#### 7-3. 권장 전략 🎯

##### 최적 조합

##### 단계 1: 실시간 동기화 (자동) 🔴

```javascript
// 모든 데이터 변경 시 즉시 엑셀 업데이트
class RealtimeSync {
  async onDataChange(store, data) {
    // 1. 엑셀 시트 업데이트
    await updateExcelSheet(store, data);
    
    // 2. 변경 이력 기록
    await recordChange(store, data);
    
    // 3. 파일 저장
    await saveExcelFile();
  }
}
```

**단계 2: 정기 백업 (자동)** 🔴

```javascript
// 매일 자정 전체 백업
class DailyBackup {
  schedule: '0 0 * * *',
  
  async execute() {
    const filename = `backup_${today}.xlsx`;
    await backupAllData(filename);
    await cleanOldBackups(30); // 30일 이상 삭제
  }
}
```

**단계 3: 수동 백업 (보조)** 🟡

```javascript
// 관리자가 필요 시 실행
class ManualBackup {
  async onButtonClick() {
    // 1. 확인 대화상자
    if (!await confirmBackup()) return;
    
    // 2. 백업 실행
    await backupAllData();
    
    // 3. 성공 메시지
    showSuccessMessage();
  }
}
```

---

### 7-4. 데이터 저장 빈도 ⏰

#### ⚡ 실시간 (즉시)

- ✅ 거래처 추가/수정
- ✅ 보고서 작성/승인
- ✅ 직원 정보 변경
- ✅ 변경 이력 기록

#### 🕐 1일 1회

- ✅ 전체 백업 (자정)
- ✅ KPI 계산 결과
- ✅ 통계 데이터

#### 📅 1주 1회

- ✅ 주간 리포트
- ✅ 장기 백업

#### 👆 필요 시

- ✅ 엑셀 업로드
- ✅ 수동 다운로드
- ✅ 긴급 백업

---

<!-- 중복 헤딩 제거: 본문 PART 4 헤딩 삭제 -->

## 8. 현재 시스템 문제점

### 8-1. 데이터 손실 위험 ⚠️

#### ❌ 문제 1: 거래처 추가 시

**시나리오**:

```
1. 사용자가 새 거래처 추가
   ↓
2. IndexedDB에 저장됨 ✅
   ↓
3. 화면에서 확인 가능 ✅
   ↓
4. 하지만 원본 엑셀 파일은 그대로 ❌
   ↓
5. 나중에 엑셀 다시 업로드하면?
   ↓
6. ExcelDataLoader가 기존 데이터 전체 삭제
   ↓
7. 추가했던 거래처 모두 사라짐 ⚠️
```

**영향**:

- 수동으로 추가한 모든 거래처 손실
- 작업 시간 낭비
- 데이터 정합성 문제

#### ❌ 문제 2: 방문보고서 작성 시

**시나리오**:

```
1. 보고서 작성
   ↓
2. IndexedDB에만 저장 ✅
   ↓
3. 엑셀 다운로드 불가 ❌
   ↓
4. 브라우저 캐시 삭제 시
   ↓
5. 모든 보고서 손실 ⚠️
```

**영향**:

- 작성한 보고서 백업 불가
- 다른 PC에서 접근 불가
- 데이터 영구 손실 위험

---

### 8-2. 백업 시스템 부재 💾

#### ❌ IndexedDB의 한계

**문제점**:

- 브라우저 로컬 저장소만 사용
- 브라우저 캐시 삭제 시 모든 데이터 손실
- 다른 PC/브라우저에서 접근 불가
- 데이터 이전 불가
- 자동 백업 없음
- 클라우드 동기화 없음

**위험 상황**:

1. 브라우저 업데이트
2. 시스템 초기화
3. PC 교체
4. 브라우저 변경
5. 캐시 정리

---

### 8-3. 다운로드 기능 미구현 📥

#### ❌ 현재 상태

**UI는 존재하지만 기능 없음**:

1. **내 거래처 데이터 다운로드**
   - 위치: sales.html 264번 라인
   - 버튼: `downloadMyData()`
   - 상태: ❌ 함수 정의 없음

2. **보고서 데이터 다운로드**
   - 위치: sales.html 273번 라인
   - 버튼: `downloadMyReports()`
   - 상태: ❌ 함수 정의 없음

3. **KPI 데이터 다운로드**
   - 위치: sales.html 282번 라인
   - 버튼: `downloadKPIData()`
   - 상태: ❌ 함수 정의 없음

**영향**:

- 사용자가 자신의 데이터를 백업할 수 없음
- 외부 프로그램으로 분석 불가
- 보고서 제출/공유 불가

---

### 8-4. 거래처 추가 버튼 미연결 🔘

#### ❌ 문제

**현재 상태**:

- Navigation 파일에서 `alert()` 사용
- 실제 구현 함수는 존재하지만 연결 안 됨
- 기능 사용 불가

**코드 위치**:

- Navigation: alert 메시지만 표시
- sales.html 685-763번: 실제 구현 (`openAddCompanyModal()`)

**영향**:

- 거래처 추가 기능 사용 불가
- 사용자 불만

---

## 9. 해결 방안

### 9-1. 방법 1: 엑셀 다운로드 기능 구현 ⭐ 추천

#### 🎯 목표

IndexedDB 데이터를 엑셀 파일로 내보내기

#### 📋 구현 필요한 함수들

#### 1. 거래처 데이터 다운로드

```javascript
async function downloadMyData() {
  // 1. IndexedDB companies 스토어 읽기
  const companies = await getAllCompanies(currentUser);
  
  // 2. JSON → Excel 변환
  const worksheet = XLSX.utils.json_to_sheet(companies);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, '기본정보');
  
  // 3. 파일 다운로드
  const filename = `${currentUser}_거래처_${today}.xlsx`;
  XLSX.writeFile(workbook, filename);
}
```

#### 2. 보고서 데이터 다운로드

```javascript
async function downloadMyReports() {
  // 1. IndexedDB reports 스토어 읽기
  const reports = await getAllReports(currentUser);
  
  // 2. JSON → Excel 변환
  const worksheet = XLSX.utils.json_to_sheet(reports);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, '방문보고서');
  
  // 3. 파일 다운로드
  const filename = `${currentUser}_보고서_${today}.xlsx`;
  XLSX.writeFile(workbook, filename);
}
```

#### 3. KPI 데이터 다운로드

```javascript
async function downloadKPIData() {
  // 1. KPI 계산
  const kpiData = await calculateKPI(currentUser);
  
  // 2. JSON → Excel 변환
  const worksheet = XLSX.utils.json_to_sheet([kpiData]);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'KPI실적');
  
  // 3. 파일 다운로드
  const filename = `${currentUser}_KPI_${today}.xlsx`;
  XLSX.writeFile(workbook, filename);
}
```

#### ✅ 장점

- 데이터 백업 가능
- 다른 시스템과 연동 가능
- 원본 엑셀 형식 유지
- 다른 PC로 이동 가능
- 외부 프로그램에서 분석 가능

#### 📊 구현 난이도

- **난이도**: 중
- **예상 시간**: 4-6시간
- **우선순위**: 🔴 높음

---

### 9-2. 방법 2: 엑셀 업로드 방식 개선

#### 🎯 목표

기존 데이터 보존하면서 병합

#### 📋 현재 방식 (문제)

```javascript
// ExcelDataLoader.js
async saveToIndexedDB(jsonData) {
  // 기존 데이터 전체 삭제 ❌
  const clearRequest = store.clear();
  
  // 새 데이터 저장
  jsonData.forEach(row => {
    store.add(company);
  });
}
```

#### 📋 개선 방식

```javascript
async saveToIndexedDB(jsonData, mode = 'replace') {
  if (mode === 'replace') {
    // 기존: 전체 삭제 후 저장
    await store.clear();
    await addAllData(jsonData);
    
  } else if (mode === 'merge') {
    // 신규: 중복 체크 후 병합
    for (const row of jsonData) {
      const existing = await store.get(row.keyValue);
      
      if (existing) {
        // 중복 시: 업데이트
        await store.put({...existing, ...row});
      } else {
        // 신규 시: 추가
        await store.add(row);
      }
    }
  }
}
```

#### ✅ 장점

- 추가한 데이터 보존
- 데이터 손실 방지
- 유연한 데이터 관리

#### ⚠️ 주의사항

- 중복 데이터 처리 로직 필요
- KEY VALUE 충돌 해결 필요
- 사용자 선택 UI 추가

#### 📊 구현 난이도

- **난이도**: 중
- **예상 시간**: 3-4시간
- **우선순위**: 🟡 중간

---

### 9-3. 방법 3: 실시간 동기화 시스템

#### 🎯 목표

IndexedDB 변경 시 즉시 엑셀 파일 업데이트

#### 📋 구현 방식

```javascript
class DataSyncManager {
  constructor() {
    this.excelFilePath = './data/영업관리기초자료_실시간.xlsx';
    this.observers = [];
  }
  
  // 데이터 변경 감지
  async onDataChange(store, operation, data) {
    // 1. 변경 이력 기록
    await this.recordChange(store, operation, data);
    
    // 2. 엑셀 파일 읽기
    const workbook = await this.readExcelFile();
    
    // 3. 해당 시트 업데이트
    await this.updateSheet(workbook, store, data);
    
    // 4. 파일 저장
    await this.saveExcelFile(workbook);
    
    // 5. 옵저버 알림
    this.notifyObservers(store, operation, data);
  }
  
  // 거래처 동기화
  async syncCompanies(company, operation) {
    const workbook = await this.readExcelFile();
    const sheet = workbook.Sheets['기본정보'];
    const data = XLSX.utils.sheet_to_json(sheet);
    
    if (operation === 'CREATE') {
      data.push(company);
    } else if (operation === 'UPDATE') {
      const index = data.findIndex(c => c.keyValue === company.keyValue);
      data[index] = company;
    } else if (operation === 'DELETE') {
      const index = data.findIndex(c => c.keyValue === company.keyValue);
      data.splice(index, 1);
    }
    
    const newSheet = XLSX.utils.json_to_sheet(data);
    workbook.Sheets['기본정보'] = newSheet;
    
    await this.saveExcelFile(workbook);
  }
}
```

#### ✅ 장점

- IndexedDB와 엑셀 완전 동기화
- 실시간 데이터 일관성
- 데이터 손실 위험 제거
- 자동 백업

#### ⚠️ 주의사항

- 파일 시스템 접근 필요 (Node.js 환경)
- 브라우저에서는 제한적
- 성능 고려 필요

#### 📊 구현 난이도

- **난이도**: 높음
- **예상 시간**: 8-12시간
- **우선순위**: 🟡 중간

---

### 9-4. 방법 4: 자동 백업 시스템

#### 🎯 목표

정기적 자동 백업으로 데이터 보호

#### 📋 구현 방식

```javascript
class AutoBackupManager {
  constructor() {
    this.backupInterval = 24 * 60 * 60 * 1000; // 24시간
    this.lastBackup = localStorage.getItem('lastBackup');
  }
  
  async checkAndBackup() {
    const now = Date.now();
    const lastBackupTime = parseInt(this.lastBackup || 0);
    
    if (now - lastBackupTime >= this.backupInterval) {
      await this.performBackup();
      localStorage.setItem('lastBackup', now.toString());
    }
  }
  
  async performBackup() {
    // 1. 모든 데이터 수집
    const companies = await getAllCompanies();
    const reports = await getAllReports();
    const employees = await getAllEmployees();
    const changeHistory = await getAllChangeHistory();
    
    // 2. 엑셀 파일 생성
    const workbook = XLSX.utils.book_new();
    
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(companies), 
      '기본정보'
    );
    
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(reports), 
      '방문보고서_전체'
    );
    
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(employees), 
      '직원정보'
    );
    
    XLSX.utils.book_append_sheet(
      workbook, 
      XLSX.utils.json_to_sheet(changeHistory), 
      '변경이력'
    );
    
    // 3. 파일 다운로드
    const filename = `영업관리기초자료_자동백업_${today}.xlsx`;
    XLSX.writeFile(workbook, filename);
    
    // 4. 백업 알림
    showNotification('자동 백업이 완료되었습니다.');
  }
  
  // 페이지 로드 시 체크
  init() {
    this.checkAndBackup();
    setInterval(() => this.checkAndBackup(), 60 * 60 * 1000); // 1시간마다 체크
  }
}

// 시스템 시작 시 초기화
const autoBackup = new AutoBackupManager();
autoBackup.init();
```

#### ✅ 장점

- 자동 백업으로 데이터 보호
- 사용자 개입 최소화
- 정기적 백업 보장

#### 📊 구현 난이도

- **난이도**: 중
- **예상 시간**: 4-6시간
- **우선순위**: 🟢 낮음 (다운로드 기능 구현 후)

---

### 9-5. 방법 5: 거래처 추가 버튼 연결

#### 🎯 목표

기존 구현된 함수와 버튼 연결

#### 📋 현재 문제

```javascript
// Navigation 파일 (현재)
const addCompanyBtn = document.getElementById('addCompanyBtn');
if (addCompanyBtn) {
  addCompanyBtn.addEventListener('click', () => {
    alert('거래처 추가 기능은 준비 중입니다.'); // ❌
  });
}
```

#### 📋 해결 방안

```javascript
// Navigation 파일 (수정)
const addCompanyBtn = document.getElementById('addCompanyBtn');
if (addCompanyBtn) {
  addCompanyBtn.addEventListener('click', () => {
    if (typeof openAddCompanyModal === 'function') {
      openAddCompanyModal(); // ✅ 실제 함수 호출
    } else {
      console.error('openAddCompanyModal 함수를 찾을 수 없습니다.');
    }
  });
}
```

#### 추가 개선사항

```javascript
// Alert → 토스트 알림 변경
// 전체 새로고침 → 부분 새로고침

async function openAddCompanyModal() {
  // ... 기존 코드 ...
  
  // 저장 성공 시
  onSave: async (data) => {
    try {
      await saveCompany(data);
      
      // Alert 대신 토스트 알림
      showToast('거래처가 성공적으로 추가되었습니다.', 'success');
      
      // 전체 새로고침 대신 테이블만 새로고침
      await refreshCompanyTable();
      
    } catch (error) {
      showToast('거래처 추가에 실패했습니다: ' + error.message, 'error');
    }
  }
}
```

#### ✅ 장점

- 즉시 기능 사용 가능
- 사용자 경험 개선
- 코드 재사용

#### 📊 구현 난이도

- **난이도**: 낮음
- **예상 시간**: 1-2시간
- **우선순위**: 🔴 높음

---

## 10. 구현 우선순위

### 🔴 1순위: 핵심 기능 구현 (즉시)

**1-1. 거래처 추가 버튼 연결** ⏱️ 1-2시간

- Navigation 파일 수정
- openAddCompanyModal() 연결
- Alert → 토스트 변경
- 전체 → 부분 새로고침

**1-2. 엑셀 다운로드 기능** ⏱️ 4-6시간

- downloadMyData() 구현
- downloadMyReports() 구현
- downloadKPIData() 구현
- 관리자용 downloadExcelData() 구현

**1-3. 방문보고서 시트 추가** ⏱️ 2-3시간

- `방문보고서_전체` 시트 생성
- 12개 컬럼 매핑
- 다운로드 시 포함

**예상 총 시간**: 7-11시간

---

### 🟡 2순위: 데이터 보호 (1주일 내)

**2-1. 실시간 동기화** ⏱️ 8-12시간

- DataSyncManager 클래스
- 거래처 변경 시 엑셀 업데이트
- 보고서 작성 시 엑셀 업데이트
- 직원 변경 시 엑셀 업데이트

**2-2. 자동 백업 시스템** ⏱️ 4-6시간

- AutoBackupScheduler 클래스
- 매일 자정 백업
- 오래된 백업 삭제
- 백업 알림

**2-3. 업로드 방식 개선** ⏱️ 3-4시간

- 데이터 병합 옵션
- 중복 처리 로직
- 사용자 선택 UI

**예상 총 시간**: 15-22시간

---

### 🟢 3순위: 고급 기능 (1개월 내)

**3-1. 변경 이력 시스템** ⏱️ 6-8시간

- ChangeHistoryManager 클래스
- 모든 변경 자동 기록
- `변경이력` 시트 생성
- 감사 추적 UI

**3-2. 백업 복원 기능** ⏱️ 4-6시간

- 백업 파일 선택
- 데이터 검증
- IndexedDB 복원
- 확인 절차

**3-3. 전사실적 시트** ⏱️ 4-6시간

- KPI 데이터 수집
- 일일 자동 계산
- `전사실적` 시트 생성
- 통계 차트

**예상 총 시간**: 14-20시간

---

### 🔵 4순위: 최적화 (장기)

#### 4-1. 성능 개선

- 대용량 데이터 처리
- 병렬 처리
- 캐싱 전략

#### 4-2. UI/UX 개선

- 진행 상태 표시
- 에러 메시지 개선
- 사용성 테스트

#### 4-3. 클라우드 동기화

- 서버 연동
- 실시간 협업
- 버전 관리

---

## 10-1. 단계별 구현 로드맵

### Phase 1: 기본 기능 (1주) 🔴

```
Week 1
├── Day 1-2: 거래처 추가 버튼 연결
├── Day 3-4: 다운로드 함수 구현 (3개)
└── Day 5-7: 방문보고서 시트 추가 및 테스트
```

### Phase 2: 데이터 보호 (2-3주) 🟡

```
Week 2-3
├── Week 2: 실시간 동기화 구현
├── Week 3: 자동 백업 시스템
└── Week 3: 업로드 방식 개선
```

### Phase 3: 고급 기능 (4주) 🟢

```
Week 4
├── Day 1-3: 변경 이력 시스템
├── Day 4-5: 백업 복원 기능
└── Day 6-7: 전사실적 시트
```

### Phase 4: 최적화 (지속적) 🔵

```
Ongoing
├── 성능 모니터링
├── 사용자 피드백 반영
└── 기능 개선
```

---

<!-- 중복 헤딩 제거: 본문 PART 5 헤딩 삭제 -->

### 11. 참고 파일 위치

### 11-1. 데이터베이스 관련

```
js/database/
├── DatabaseSchema.js      - 스키마 정의
├── CrudManager.js         - CRUD 작업
├── ExcelProcessor.js      - 엑셀 처리
├── ExcelProcessorRefactored.js
└── index.js               - 통합 관리
```

### 11-2. 데이터 로드

```
js/utils/
├── ExcelDataLoader.js     - 엑셀 → IndexedDB
├── excelAnalyzer.js       - 엑셀 분석
└── excelCommonUtils.js    - 공통 유틸
```

### 11-3. UI 모듈

```
js/components/
└── CompanyDetailModal.js  - 거래처 모달

js/reports/
├── ReportUI.js           - 보고서 UI
└── ReportManager.js      - 보고서 관리
```

### 11-4. 페이지

```
index.html  - 로그인/엑셀 업로드
sales.html  - 영업담당 모드
admin.html  - 관리자 모드
```

### 11-5. 데이터 파일

```
data/
└── 영업관리기초자료.xlsx  - 원본 엑셀
```

---

## 12. FAQ

### Q1: 거래처를 추가하면 어디에 저장되나요?

**A**: IndexedDB의 `companies` 스토어에만 저장됩니다. 원본 엑셀 파일에는 저장되지 않습니다. 향후 실시간 동기화 기능 구현 시 엑셀 파일에도 자동 저장될 예정입니다.

### Q2: 다른 PC에서 데이터를 볼 수 있나요?

**A**: 현재는 불가능합니다. IndexedDB는 브라우저 로컬 저장소이므로 다른 PC에서는 접근할 수 없습니다. 다운로드 기능 구현 후 엑셀 파일로 내보내서 다른 PC에서 업로드하는 방식으로 가능해집니다.

### Q3: 브라우저 캐시를 삭제하면 어떻게 되나요?

**A**: 모든 데이터가 손실됩니다. 현재는 엑셀 다운로드 기능이 없어 복구가 불가능합니다. 다운로드 기능 구현 후에는 정기적으로 백업하여 데이터를 보호할 수 있습니다.

### Q4: 데이터 백업은 어떻게 하나요?

**A**:

- **현재**: 백업 기능이 없습니다.
- **구현 예정**:
  1. 수동 백업: 데이터 관리 메뉴에서 다운로드 버튼
  2. 자동 백업: 매일 자정 자동 백업

### Q5: 엑셀을 다시 업로드하면 추가한 거래처는?

**A**: 사라집니다. `ExcelDataLoader`가 기존 데이터를 전체 삭제(`store.clear()`)하고 새로 저장하기 때문입니다. 향후 데이터 병합 옵션 추가 예정입니다.

### Q6: 방문보고서는 엑셀에 어떻게 저장되나요?

**A**:

- **현재**: 저장 안 됨 (IndexedDB에만 존재)
- **구현 예정**: `방문보고서_전체` 시트에 자동 저장

### Q7: 실시간 동기화는 언제 구현되나요?

**A**: Phase 2 (2-3주차)에 구현 예정입니다. 우선 다운로드 기능(Phase 1)을 먼저 구현합니다.

### Q8: 자동 백업은 어떻게 동작하나요?

**A**:

- 매일 자정에 자동 실행
- 전체 데이터를 엑셀 파일로 저장
- 30일 이상 된 백업은 자동 삭제
- 백업 완료 시 알림 표시

### Q9: 여러 사용자가 동시에 사용할 수 있나요?

**A**:

- **현재**: 각자의 브라우저에 데이터 저장 (공유 안 됨)
- **향후**: 서버 동기화 기능 구현 시 가능

### Q10: 어떤 브라우저를 사용해야 하나요?

**A**: IndexedDB를 지원하는 모든 최신 브라우저:

- Chrome (권장)
- Edge
- Firefox
- Safari

---

## 13. 요약표

### 13-1. 메뉴별 기능 요약

| 메뉴 | 입력 | 다운로드 | 업로드 | 엑셀 시트 | 저장 주기 | 자동화 | 구현 상태 |
|------|------|----------|--------|-----------|-----------|--------|-----------|
| **영업: 대시보드** | ❌ | ✅ KPI | ❌ | 영업실적_[담당자] | 수동 | ❌ | ❌ |
| **영업: 담당거래처** | ✅ | ✅ | ❌ | 기본정보 | 즉시 | ✅ | 부분 |
| **영업: 보고서작성** | ✅ | ✅ | ❌ | 방문보고서_[담당자] | 즉시 | ✅ | 부분 |
| **영업: 보고서확인** | ❌ | ✅ | ❌ | 방문보고서_[담당자] | 수동 | ❌ | ❌ |
| **영업: 데이터관리** | ❌ | ✅ 3종 | ❌ | 여러 시트 | 수동 | ❌ | ❌ |
| **영업: 시스템설정** | ✅ | ❌ | ❌ | 직원정보 | - | - | ✅ |
| **관리자: 대시보드** | ❌ | ✅ 전사KPI | ❌ | 전사실적 | 수동 | ❌ | ❌ |
| **관리자: 전체거래처** | ✅ | ✅ | ❌ | 기본정보 | 즉시 | ✅ | 부분 |
| **관리자: 보고서확인** | ✅ 승인 | ✅ | ❌ | 방문보고서_전체 | 즉시 | ✅ | 부분 |
| **관리자: 보고서발표** | ❌ | ✅ PPT | ❌ | 발표자료 | 수동 | ❌ | ❌ |
| **관리자: 데이터관리** | ❌ | ✅ 전체 | ✅ | 모든 시트 | 자동+수동 | ✅ | ❌ |
| **관리자: 직원관리** | ✅ | ✅ | ❌ | 직원정보 | 즉시 | ✅ | 부분 |
| **관리자: 시스템설정** | ✅ | ✅ | ✅ | 시스템설정 | 수동 | ❌ | ❌ |

### 13-2. 엑셀 시트 요약

| 시트명 | 상태 | 컬럼 수 | 자동 업데이트 | 우선순위 |
|--------|------|---------|--------------|----------|
| **기본정보** | ✅ 존재 | 19 | ✅ 권장 | 🔴 필수 |
| **방문보고서_전체** | ❌ 신규 | 12 | ✅ 권장 | 🔴 필수 |
| **직원정보** | ✅ 추정 | ? | ✅ 권장 | 🔴 필수 |
| **변경이력** | ❌ 신규 | 8 | ✅ 자동 | 🟡 권장 |
| **전사실적** | ❌ 신규 | 15 | ⏰ 일 1회 | 🟢 선택 |
| **메타정보** | ❌ 신규 | 6 | 👆 수동 | 🟢 선택 |

### 13-3. 구현 우선순위 요약

| 순위 | 항목 | 시간 | 기간 | 상태 |
|------|------|------|------|------|
| 🔴 1순위 | 거래처 추가 버튼 연결 | 1-2h | 즉시 | ❌ |
| 🔴 1순위 | 엑셀 다운로드 기능 | 4-6h | 즉시 | ❌ |
| 🔴 1순위 | 방문보고서 시트 추가 | 2-3h | 즉시 | ❌ |
| 🟡 2순위 | 실시간 동기화 | 8-12h | 1-2주 | ❌ |
| 🟡 2순위 | 자동 백업 시스템 | 4-6h | 1-2주 | ❌ |
| 🟡 2순위 | 업로드 방식 개선 | 3-4h | 1-2주 | ❌ |
| 🟢 3순위 | 변경 이력 시스템 | 6-8h | 3-4주 | ❌ |
| 🟢 3순위 | 백업 복원 기능 | 4-6h | 3-4주 | ❌ |
| 🟢 3순위 | 전사실적 시트 | 4-6h | 3-4주 | ❌ |

---

**문서 작성**: 2025-09-26  
**작성자**: Claude AI  
**버전**: 2.0 (통합판)  
**다음 업데이트**: 구현 진행 상황에 따라 수정
